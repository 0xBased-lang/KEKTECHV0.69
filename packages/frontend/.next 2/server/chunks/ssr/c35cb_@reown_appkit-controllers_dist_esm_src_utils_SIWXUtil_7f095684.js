module.exports=[390608,794380,104772,a=>{"use strict";a.s(["SIWXUtil",()=>h6],390608),a.s(["Core",()=>fN,"EVENT_CLIENT_AUTHENTICATE_ERRORS",()=>dz,"EVENT_CLIENT_AUTHENTICATE_TRACES",()=>dy,"EVENT_CLIENT_PAIRING_ERRORS",()=>dv,"EVENT_CLIENT_PAIRING_TRACES",()=>du,"EVENT_CLIENT_SESSION_ERRORS",()=>dx,"EVENT_CLIENT_SESSION_TRACES",()=>dw,"EXPIRER_EVENTS",()=>dp,"PAIRING_EVENTS",()=>dm,"RELAYER_DEFAULT_PROTOCOL",()=>dc,"RELAYER_EVENTS",()=>de,"Store",()=>fh,"TRANSPORT_TYPES",()=>dh,"VERIFY_SERVER",()=>dr],104772);var b=a.i(427699),c=a.i(634325),d=a.i(267479),e=a.i(156907),f=a.i(459815);a.i(730729);var g=a.i(345652),h=Object.defineProperty,i=(a,b,c)=>((a,b,c)=>b in a?h(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class j extends g.IEvents{constructor(a){super(),this.opts=a,i(this,"protocol","wc"),i(this,"version",2)}}var k=Object.defineProperty;class l extends g.IEvents{constructor(a,b){super(),this.core=a,this.logger=b,((a,b,c)=>((a,b,c)=>b in a?k(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c))(this,"records",new Map)}}class m{constructor(a,b){this.logger=a,this.core=b}}class n extends g.IEvents{constructor(a,b){super(),this.relayer=a,this.logger=b}}class o extends g.IEvents{constructor(a){super()}}class p{constructor(a,b,c,d){this.core=a,this.logger=b,this.name=c}}class q extends g.IEvents{constructor(a,b){super(),this.relayer=a,this.logger=b}}class r extends g.IEvents{constructor(a,b){super(),this.core=a,this.logger=b}}class s{constructor(a,b,c){this.core=a,this.logger=b,this.store=c}}class t{constructor(a,b){this.projectId=a,this.logger=b}}class u{constructor(a,b,c){this.core=a,this.logger=b,this.telemetryEnabled=c}}b.default,b.EventEmitter;var v=a.i(873714),w=a.i(7456),x=a.i(600444),y=a.i(921836),z=a.i(551979),A=a.i(177359);a.s(["keccak_256",()=>T],794380);var B=a.i(137470);let C=BigInt(0x100000000-1),D=BigInt(32);var E=a.i(653757);let F=[],G=[],H=[],I=BigInt(0),J=BigInt(1),K=BigInt(2),L=BigInt(7),M=BigInt(256),N=BigInt(113);for(let a=0,b=J,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],F.push(2*(5*d+c)),G.push((a+1)*(a+2)/2%64);let e=I;for(let a=0;a<7;a++)(b=(b<<J^(b>>L)*N)%M)&K&&(e^=J<<(J<<BigInt(a))-J);H.push(e)}let[O,P]=function(a,b=!1){let c=new Uint32Array(a.length),d=new Uint32Array(a.length);for(let e=0;e<a.length;e++){let{h:f,l:g}=function(a,b=!1){return b?{h:Number(a&C),l:Number(a>>D&C)}:{h:0|Number(a>>D&C),l:0|Number(a&C)}}(a[e],b);[c[e],d[e]]=[f,g]}return[c,d]}(H,!0),Q=(a,b,c)=>c>32?((a,b,c)=>b<<c-32|a>>>64-c)(a,b,c):((a,b,c)=>a<<c|b>>>32-c)(a,b,c),R=(a,b,c)=>c>32?((a,b,c)=>a<<c-32|b>>>64-c)(a,b,c):((a,b,c)=>b<<c|a>>>32-c)(a,b,c);class S extends E.Hash{constructor(a,b,c,d=!1,e=24){if(super(),this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,B.anumber)(c),0>=this.blockLen||this.blockLen>=200)throw Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,E.u32)(this.state)}keccak(){E.isLE||(0,E.byteSwap32)(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=Q(f,g,1)^c[d],i=R(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=G[c],f=Q(b,e,d),g=R(b,e,d),h=F[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=O[d],a[1]^=P[d]}c.fill(0)}(this.state32,this.rounds),E.isLE||(0,E.byteSwap32)(this.state32),this.posOut=0,this.pos=0}update(a){(0,B.aexists)(this);let{blockLen:b,state:c}=this,d=(a=(0,E.toBytes)(a)).length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){(0,B.aexists)(this,!1),(0,B.abytes)(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return(0,B.anumber)(a),this.xofInto(new Uint8Array(a))}digestInto(a){if((0,B.aoutput)(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new S(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let T=(0,E.wrapConstructor)(()=>new S(136,1,32));a.i(403083),a.i(354033);var U=a.i(264153),V=a.i(440237),W=a.i(587585),X=a.i(457819);Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;let Y={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};function Z(){return"u">typeof process&&"u">typeof process.versions&&"u">typeof process.versions.node}function $(){return!(0,z.getDocument)()&&!!(0,z.getNavigator)()&&"ReactNative"===navigator.product}function _(){return!Z()&&!!(0,z.getNavigator)()&&!!(0,z.getDocument)()}function aa(){return $()?Y.reactNative:Z()?Y.node:_()?Y.browser:Y.unknown}function ab(){var b;try{return $()&&"u">typeof(null==a.g?void 0:a.g.Application)?null==(b=a.g.Application)?void 0:b.applicationId:void 0}catch{return}}function ac(b,c,d){let e=function(){if(aa()===Y.reactNative&&"u">typeof(null==a.g?void 0:a.g.Platform)){let{OS:b,Version:c}=a.g.Platform;return[b,c].join("-")}let b=(0,y.detect)();if(null===b)return"unknown";let c=b.os?b.os.replace(" ","").toLowerCase():"unknown";return"browser"===b.type?[c,b.name,b.version].join("-"):[c,b.version].join("-")}(),f=function(){var a;let b=aa();return b===Y.browser?[b,(null==(a=(0,z.getLocation)())?void 0:a.host)||"unknown"].join(":"):b}();return[[b,c].join("-"),["js",d].join("-"),e,f].join("/")}function ad(a){return Object.fromEntries(a.entries())}function ae(a){return new Map(Object.entries(a))}function af(a,b,c){return new Promise(async(d,e)=>{let f=setTimeout(()=>e(Error(c)),b);try{let b=await a;d(b)}catch(a){e(a)}clearTimeout(f)})}function ag(a,b){if("string"==typeof b&&b.startsWith(`${a}:`))return b;if("topic"===a.toLowerCase()){if("string"!=typeof b)throw Error('Value must be "string" for expirer target type: topic');return`topic:${b}`}if("id"===a.toLowerCase()){if("number"!=typeof b)throw Error('Value must be "number" for expirer target type: id');return`id:${b}`}throw Error(`Unknown expirer target type: ${a}`)}function ah(a,b){return(0,v.fromMiliseconds)((b||Date.now())+(0,v.toMiliseconds)(a))}function ai(a){return Date.now()>=(0,v.toMiliseconds)(a)}function aj(a,b){return`${a}${b?`:${b}`:""}`}function ak(){return"u">typeof crypto&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}function al(){return"u">typeof process&&"true"===process.env.IS_VITEST}function am(a){return Buffer.from(a,"base64").toString("utf-8")}function an(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function ao(a,...b){if(!(a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function ap(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.wrapConstructor");an(a.outputLen),an(a.blockLen)}function aq(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function ar(a,b){ao(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}let as=BigInt(0x100000000-1),at=BigInt(32),au="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function av(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function aw(a,b){return a<<32-b|a>>>b}let ax=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function ay(a){for(let c=0;c<a.length;c++){var b;a[c]=(b=a[c])<<24&0xff000000|b<<8&0xff0000|b>>>8&65280|b>>>24&255}}function az(a){return"string"==typeof a&&(a=function(a){if("string"!=typeof a)throw Error("utf8ToBytes expected string, got "+typeof a);return new Uint8Array(new TextEncoder().encode(a))}(a)),ao(a),a}class aA{clone(){return this._cloneInto()}}function aB(a){let b=b=>a().update(az(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function aC(a=32){if(au&&"function"==typeof au.getRandomValues)return au.getRandomValues(new Uint8Array(a));if(au&&"function"==typeof au.randomBytes)return au.randomBytes(a);throw Error("crypto.getRandomValues must be defined")}let aD=[],aE=[],aF=[],aG=BigInt(0),aH=BigInt(1),aI=BigInt(2),aJ=BigInt(7),aK=BigInt(256),aL=BigInt(113);for(let a=0,b=aH,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],aD.push(2*(5*d+c)),aE.push((a+1)*(a+2)/2%64);let e=aG;for(let a=0;a<7;a++)(b=(b<<aH^(b>>aJ)*aL)%aK)&aI&&(e^=aH<<(aH<<BigInt(a))-aH);aF.push(e)}let[aM,aN]=function(a,b=!1){let c=new Uint32Array(a.length),d=new Uint32Array(a.length);for(let e=0;e<a.length;e++){let{h:f,l:g}=function(a,b=!1){return b?{h:Number(a&as),l:Number(a>>at&as)}:{h:0|Number(a>>at&as),l:0|Number(a&as)}}(a[e],b);[c[e],d[e]]=[f,g]}return[c,d]}(aF,!0),aO=(a,b,c)=>c>32?((a,b,c)=>b<<c-32|a>>>64-c)(a,b,c):((a,b,c)=>a<<c|b>>>32-c)(a,b,c),aP=(a,b,c)=>c>32?((a,b,c)=>a<<c-32|b>>>64-c)(a,b,c):((a,b,c)=>b<<c|a>>>32-c)(a,b,c);class aQ extends aA{constructor(a,b,c,d=!1,e=24){if(super(),this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,an(c),0>=this.blockLen||this.blockLen>=200)throw Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=function(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}(this.state)}keccak(){ax||ay(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=aO(f,g,1)^c[d],i=aP(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=aE[c],f=aO(b,e,d),g=aP(b,e,d),h=aD[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=aM[d],a[1]^=aN[d]}c.fill(0)}(this.state32,this.rounds),ax||ay(this.state32),this.posOut=0,this.pos=0}update(a){aq(this);let{blockLen:b,state:c}=this,d=(a=az(a)).length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){aq(this,!1),ao(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return an(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(ar(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new aQ(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}function aR(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function aS(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function aT(a,...b){if(!aS(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function aU(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function aV(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}aB(()=>new aQ(136,1,32)),Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;let aW=a=>new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4));if(68!==new Uint8Array(new Uint32Array([0x11223344]).buffer)[0])throw Error("Non little-endian hardware is not supported");function aX(a){if("string"==typeof a)a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a);else if(aS(a))a=a$(a);else throw Error("Uint8Array expected, got "+typeof a);return a}function aY(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error("invalid output length, expected "+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function aZ(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function a$(a){return Uint8Array.from(a)}function a_(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let a0=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),a1=a0("expand 16-byte k"),a2=a0("expand 32-byte k"),a3=aW(a1),a4=aW(a2);function a5(a,b){return a<<b|a>>>32-b}function a6(a){return a.byteOffset%4==0}let a7=0x100000000-1,a8=new Uint32Array,a9=(a,b)=>255&a[b++]|(255&a[b++])<<8;class ba{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,aT(a=aX(a),32);let b=a9(a,0),c=a9(a,2),d=a9(a,4),e=a9(a,6),f=a9(a,8),g=a9(a,10),h=a9(a,12),i=a9(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=a9(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=a9(a,b+0),q=a9(a,b+2),r=a9(a,b+4),s=a9(a,b+6),t=a9(a,b+8),u=a9(a,b+10),v=a9(a,b+12),w=a9(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;a_(c)}update(a){aU(this);let{buffer:b,blockLen:c}=this,d=(a=aX(a)).length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){a_(this.h,this.r,this.buffer,this.pad)}digestInto(a){aU(this),function(a,b){aT(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,h:c}=this,{pos:d}=this;if(d){for(b[d++]=1;d<16;d++)b[d]=0;this.process(b,0,!0)}this.finalize();let e=0;for(let b=0;b<8;b++)a[e++]=c[b]>>>0,a[e++]=c[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let bb=function(a){let b=(b,c)=>a(c).update(aX(b)).digest(),c=a(new Uint8Array(32));return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=b=>a(b),b}(a=>new ba(a)),bc=function(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return aR(e),aR(g),aV(f),aV(c),(b,h,i,j,k=0)=>{aT(b),aT(h),aT(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),aT(j),aR(k),k<0||k>=a7)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],n=b.length,o,p;if(32===n)m.push(o=a$(b)),p=a4;else if(16===n&&c)(o=new Uint8Array(32)).set(b),o.set(b,16),p=a3,m.push(o);else throw Error(`arx: invalid 32-byte key, got length=${n}`);a6(h)||m.push(h=a$(h));let q=aW(o);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(p,q,aW(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=aW(j),l=a6(e)&&a6(f),m=l?aW(e):a8,n=l?aW(f):a8;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=a7)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,p,q,aW(h),i,j,k,g),a_(...m),j}}(function(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=a5(H^(v=v+z|0),16))|0,v=v+(z=a5(z^D,12))|0,D=D+(H=a5(H^v,8))|0,z=a5(z^D,7),E=E+(I=a5(I^(w=w+A|0),16))|0,w=w+(A=a5(A^E,12))|0,E=E+(I=a5(I^w,8))|0,A=a5(A^E,7),F=F+(J=a5(J^(x=x+B|0),16))|0,x=x+(B=a5(B^F,12))|0,F=F+(J=a5(J^x,8))|0,B=a5(B^F,7),G=G+(K=a5(K^(y=y+C|0),16))|0,y=y+(C=a5(C^G,12))|0,G=G+(K=a5(K^y,8))|0,C=a5(C^G,7),F=F+(K=a5(K^(v=v+A|0),16))|0,v=v+(A=a5(A^F,12))|0,F=F+(K=a5(K^v,8))|0,A=a5(A^F,7),G=G+(H=a5(H^(w=w+B|0),16))|0,w=w+(B=a5(B^G,12))|0,G=G+(H=a5(H^w,8))|0,B=a5(B^G,7),D=D+(I=a5(I^(x=x+C|0),16))|0,x=x+(C=a5(C^D,12))|0,D=D+(I=a5(I^x,8))|0,C=a5(C^D,7),E=E+(J=a5(J^(y=y+z|0),16))|0,y=y+(z=a5(z^E,12))|0,E=E+(J=a5(J^y,8))|0,z=a5(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),bd=new Uint8Array(16),be=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(bd.subarray(c))},bf=new Uint8Array(32);function bg(a,b,c,d,e){let f=a(b,c,bf),g=bb.create(f);e&&be(g,e),be(g,d);let h=new Uint8Array(16),i=new DataView(h.buffer,h.byteOffset,h.byteLength);aZ(i,0,BigInt(e?e.length:0),!0),aZ(i,8,BigInt(d.length),!0),g.update(h);let j=g.digest();return a_(f,h),j}let bh=((a,b)=>{function c(d,...e){if(aT(d),void 0!==a.nonceLength){let b=e[0];if(!b)throw Error("nonce / iv required");a.varSizeNonce?aT(b):aT(b,a.nonceLength)}let f=a.tagLength;f&&void 0!==e[1]&&aT(e[1]);let g=b(d,...e),h=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");aT(b)}},i=!1;return{encrypt(a,b){if(i)throw Error("cannot encrypt() twice with same key + nonce");return i=!0,aT(a),h(g.encrypt.length,b),g.encrypt(a,b)},decrypt(a,b){if(aT(a),f&&a.length<f)throw Error("invalid ciphertext length: smaller than tagLength="+f);return h(g.decrypt.length,b),g.decrypt(a,b)}}}return Object.assign(c,a),c})({blockSize:64,nonceLength:12,tagLength:16},(a=>(b,c,d)=>({encrypt(e,f){let g=e.length;(f=aY(g+16,f,!1)).set(e);let h=f.subarray(0,-16);a(b,c,h,h,1);let i=bg(a,b,c,h,d);return f.set(i,g),a_(i),f},decrypt(e,f){f=aY(e.length-16,f,!1);let g=e.subarray(0,-16),h=e.subarray(-16),i=bg(a,b,c,g,d);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(h,i))throw Error("invalid tag");return f.set(e.subarray(0,-16)),a(b,c,f,f,1),a_(i),f}}))(bc));class bi extends aA{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,ap(a);let c=az(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),e.fill(0)}update(a){return aq(this),this.iHash.update(a),this}digestInto(a){aq(this),ao(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let bj=(a,b,c)=>new bi(a,b).update(c).digest();bj.create=(a,b)=>new bi(a,b);let bk=new Uint8Array([0]),bl=new Uint8Array;class bm extends aA{constructor(a,b,c,d){super(),this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(a),this.view=av(this.buffer)}update(a){aq(this);let{view:b,buffer:c,blockLen:d}=this,e=(a=az(a)).length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=av(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){aq(this),ar(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,this.buffer.subarray(f).fill(0),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=av(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.length=d,a.pos=g,a.finished=e,a.destroyed=f,d%b&&a.buffer.set(c),a}}let bn=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),bo=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),bp=new Uint32Array(64);class bq extends bm{constructor(){super(64,32,8,!1),this.A=0|bo[0],this.B=0|bo[1],this.C=0|bo[2],this.D=0|bo[3],this.E=0|bo[4],this.F=0|bo[5],this.G=0|bo[6],this.H=0|bo[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)bp[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=bp[a-15],c=bp[a-2],d=aw(b,7)^aw(b,18)^b>>>3,e=aw(c,17)^aw(c,19)^c>>>10;bp[a]=e+bp[a-7]+d+bp[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(aw(g,6)^aw(g,11)^aw(g,25))+((k=g)&h^~k&i)+bn[a]+bp[a]|0,o=(aw(c,2)^aw(c,13)^aw(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){bp.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}let br=aB(()=>new bq),bs=BigInt(0),bt=BigInt(1),bu=BigInt(2);function bv(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function bw(a){if(!bv(a))throw Error("Uint8Array expected")}function bx(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}let by=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function bz(a){bw(a);let b="";for(let c=0;c<a.length;c++)b+=by[a[c]];return b}function bA(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function bB(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?bs:BigInt("0x"+a)}let bC={_0:48,_9:57,A:65,F:70,a:97,f:102};function bD(a){return a>=bC._0&&a<=bC._9?a-bC._0:a>=bC.A&&a<=bC.F?a-(bC.A-10):a>=bC.a&&a<=bC.f?a-(bC.a-10):void 0}function bE(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=bD(a.charCodeAt(e)),f=bD(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function bF(a){return bB(bz(a))}function bG(a){return bw(a),bB(bz(Uint8Array.from(a).reverse()))}function bH(a,b){return bE(a.toString(16).padStart(2*b,"0"))}function bI(a,b){return bH(a,b).reverse()}function bJ(a,b,c){let d;if("string"==typeof b)try{d=bE(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(bv(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function bK(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];bw(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let bL=a=>"bigint"==typeof a&&bs<=a;function bM(a,b,c){return bL(a)&&bL(b)&&bL(c)&&b<=a&&a<c}function bN(a,b,c,d){if(!bM(b,c,d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}function bO(a){let b;for(b=0;a>bs;a>>=bt,b+=1);return b}let bP=a=>(bu<<BigInt(a-1))-bt,bQ=a=>new Uint8Array(a),bR=a=>Uint8Array.from(a);function bS(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=bQ(a),e=bQ(a),f=0,g=()=>{d.fill(1),e.fill(0),f=0},h=(...a)=>c(e,d,...a),i=(a=bQ())=>{e=h(bR([0]),a),d=h(),0!==a.length&&(e=h(bR([1]),a),d=h())},j=()=>{if(f++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(d=h()).slice();c.push(b),a+=d.length}return bK(...c)};return(a,b)=>{let c;for(g(),i(a);!(c=b(j()));)i();return g(),c}}let bT={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||bv(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function bU(a,b,c={}){let d=(b,c,d)=>{let e=bT[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if(!(d&&void 0===f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function bV(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}var bW=Object.freeze({__proto__:null,isBytes:bv,abytes:bw,abool:bx,bytesToHex:bz,numberToHexUnpadded:bA,hexToNumber:bB,hexToBytes:bE,bytesToNumberBE:bF,bytesToNumberLE:bG,numberToBytesBE:bH,numberToBytesLE:bI,numberToVarBytesBE:function(a){return bE(bA(a))},ensureBytes:bJ,concatBytes:bK,equalBytes:function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c},utf8ToBytes:function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))},inRange:bM,aInRange:bN,bitLen:bO,bitGet:function(a,b){return a>>BigInt(b)&bt},bitSet:function(a,b,c){return a|(c?bt:bs)<<BigInt(b)},bitMask:bP,createHmacDrbg:bS,validateObject:bU,notImplemented:()=>{throw Error("not implemented")},memoized:bV});let bX=BigInt(0),bY=BigInt(1),bZ=BigInt(2),b$=BigInt(3),b_=BigInt(4),b0=BigInt(5),b1=BigInt(8);function b2(a,b){let c=a%b;return c>=bX?c:b+c}function b3(a,b,c){if(b<bX)throw Error("invalid exponent, negatives unsupported");if(c<=bX)throw Error("invalid modulus");if(c===bY)return bX;let d=bY;for(;b>bX;)b&bY&&(d=d*a%c),a=a*a%c,b>>=bY;return d}function b4(a,b,c){let d=a;for(;b-- >bX;)d*=d,d%=c;return d}function b5(a,b){if(a===bX)throw Error("invert: expected non-zero number");if(b<=bX)throw Error("invert: expected positive modulus, got "+b);let c=b2(a,b),d=b,e=bX,f=bY;for(;c!==bX;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==bY)throw Error("invert: does not exist");return b2(e,b)}let b6=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function b7(a,b){let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function b8(a,b,c=!1,d={}){let e;if(a<=bX)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=b7(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:bP(f),ZERO:bX,ONE:bY,create:b=>b2(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return bX<=b&&b<a},is0:a=>a===bX,isOdd:a=>(a&bY)===bY,neg:b=>b2(-b,a),eql:(a,b)=>a===b,sqr:b=>b2(b*b,a),add:(b,c)=>b2(b+c,a),sub:(b,c)=>b2(b-c,a),mul:(b,c)=>b2(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<bX)throw Error("invalid exponent, negatives unsupported");if(c===bX)return a.ONE;if(c===bY)return b;let d=a.ONE,e=b;for(;c>bX;)c&bY&&(d=a.mul(d,e)),e=a.sqr(e),c>>=bY;return d})(h,a,b),div:(b,c)=>b2(b*b5(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>b5(b,a),sqrt:d.sqrt||(b=>(e||(e=function(a){if(a%b_===b$){let b=(a+bY)/b_;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}if(a%b1===b0){let b=(a-b0)/b1;return function(a,c){let d=a.mul(c,bZ),e=a.pow(d,b),f=a.mul(c,e),g=a.mul(a.mul(f,bZ),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),c))throw Error("Cannot find square root");return h}}return function(a){let b,c,d,e=(a-bY)/bZ;for(b=a-bY,c=0;b%bZ===bX;b/=bZ,c++);for(d=bZ;d<a&&b3(d,e,a)!==a-bY;d++)if(d>1e3)throw Error("Cannot find square root: likely non-prime P");if(1===c){let b=(a+bY)/b_;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}let f=(b+bY)/bZ;return function(a,g){if(a.pow(g,e)===a.neg(a.ONE))throw Error("Cannot find square root");let h=c,i=a.pow(a.mul(a.ONE,d),b),j=a.pow(g,f),k=a.pow(g,b);for(;!a.eql(k,a.ONE);){if(a.eql(k,a.ZERO))return a.ZERO;let b=1;for(let c=a.sqr(k);b<h&&!a.eql(c,a.ONE);b++)c=a.sqr(c);let c=a.pow(i,bY<<BigInt(h-b-1));i=a.sqr(c),j=a.mul(j,c),k=a.mul(k,i),h=b}return j}}(a)}(a)),e(h,b))),invertBatch:a=>(function(a,b){let c=Array(b.length),d=b.reduce((b,d,e)=>a.is0(d)?b:(c[e]=b,a.mul(b,d)),a.ONE),e=a.inv(d);return b.reduceRight((b,d,e)=>a.is0(d)?b:(c[e]=a.mul(b,c[e]),a.mul(b,d)),e),c})(h,a),cmov:(a,b,c)=>c?b:a,toBytes:a=>c?bI(a,g):bH(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?bG(a):bF(a)}});return Object.freeze(h)}function b9(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function ca(a){let b=b9(a);return b+Math.ceil(b/2)}let cb=BigInt(0),cc=BigInt(1);function cd(a,b){let c=b.negate();return a?c:b}function ce(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function cf(a,b){return ce(a,b),{windows:Math.ceil(b/a)+1,windowSize:2**(a-1)}}let cg=new WeakMap,ch=new WeakMap;function ci(a){return ch.get(a)||1}function cj(a){return bU(a.Fp,b6.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),bU(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...b7(a.n,a.nBitLength),...a,p:a.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);let ck=BigInt(0),cl=BigInt(1),cm=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);let cn=BigInt(1),co=BigInt(2),cp=BigInt(3),cq=BigInt(5);BigInt(8);let cr=function(a){let b=(bU(a,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...a})),{P:c}=b,d=a=>b2(a,c),e=b.montgomeryBits,f=Math.ceil(e/8),g=b.nByteLength,h=b.adjustScalarBytes||(a=>a),i=b.powPminus2||(a=>b3(a,c-BigInt(2),c));function j(a,b,c){let e=d(a*(b-c));return[b=d(b-e),c=d(c+e)]}let k=(b.a-BigInt(2))/BigInt(4);function l(a,b){let l=function(a,b){bN("u",a,ck,c),bN("scalar",b,ck,c);let f=cl,g=ck,h=a,l=cl,m=ck,n;for(let c=BigInt(e-1);c>=ck;c--){let e=b>>c&cl;m^=e,f=(n=j(m,f,h))[0],h=n[1],g=(n=j(m,g,l))[0],l=n[1],m=e;let i=f+g,o=d(i*i),p=f-g,q=d(p*p),r=o-q,s=h+l,t=d((h-l)*i),u=d(s*p),v=t+u,w=t-u;h=d(v*v),l=d(a*d(w*w)),f=d(o*q),g=d(r*(o+d(k*r)))}return f=(n=j(m,f,h))[0],h=n[1],g=(n=j(m,g,l))[0],l=n[1],d(f*i(g))}(function(a){let b=bJ("u coordinate",a,f);return 32===g&&(b[31]&=127),bG(b)}(b),function(a){let b=bJ("scalar",a),c=b.length;if(c!==f&&c!==g)throw Error("invalid scalar, expected "+(""+f+" or ")+g+" bytes, got "+c);return bG(h(b))}(a));if(l===ck)throw Error("invalid private or public key received");return bI(d(l),f)}let m=bI(d(b.Gu),f);function n(a){return l(a,m)}return{scalarMult:l,scalarMultBase:n,getSharedSecret:(a,b)=>l(a,b),getPublicKey:a=>n(a),utils:{randomPrivateKey:()=>b.randomBytes(b.nByteLength)},GuBytes:m}}({P:cm,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:a=>{let{pow_p_5_8:b,b2:c}=function(a){let b=BigInt(10),c=BigInt(20),d=BigInt(40),e=BigInt(80),f=a*a%cm*a%cm,g=b4(f,co,cm)*f%cm,h=b4(g,cn,cm)*a%cm,i=b4(h,cq,cm)*h%cm,j=b4(i,b,cm)*i%cm,k=b4(j,c,cm)*j%cm,l=b4(k,d,cm)*k%cm,m=b4(l,e,cm)*l%cm,n=b4(m,e,cm)*l%cm,o=b4(n,b,cm)*i%cm;return{pow_p_5_8:b4(o,co,cm)*a%cm,b2:f}}(a);return b2(b4(b,cp,cm)*c,cm)},adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a},randomBytes:aC});function cs(a){void 0!==a.lowS&&bx("lowS",a.lowS),void 0!==a.prehash&&bx("prehash",a.prehash)}let{bytesToNumberBE:ct,hexToBytes:cu}=bW,cv={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=cv;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=bA(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?bA(e.length/2|128):"";return bA(a)+f+e+b},decode(a,b){let{Err:c}=cv,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=cv;if(a<cw)throw new b("integer: negative integers are not allowed");let c=bA(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=cv;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return ct(a)}},toSig(a){let{Err:b,_int:c,_tlv:d}=cv,e="string"==typeof a?cu(a):a;bw(e);let{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=cv,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},cw=BigInt(0),cx=BigInt(1);BigInt(2);let cy=BigInt(3);BigInt(4);let cz=b8(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),cA=function(a,b){let c=b=>(function(a){let b=function(a){let b=cj(a);return bU(b,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...b})}(a),{Fp:c,n:d}=b,e=c.BYTES+1,f=2*c.BYTES+1;function g(a){return b2(a,d)}let{ProjectivePoint:h,normPrivateKeyToScalar:i,weierstrassEquation:j,isWithinCurveOrder:k}=function(a){var b;let c=function(a){let b=cj(a);bU(b,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:c,Fp:d,a:e}=b;if(c){if(!d.eql(e,d.ZERO))throw Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof c||"bigint"!=typeof c.beta||"function"!=typeof c.splitScalar)throw Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...b})}(a),{Fp:d}=c,e=b8(c.n,c.nBitLength),f=c.toBytes||((a,b,c)=>{let e=b.toAffine();return bK(Uint8Array.from([4]),d.toBytes(e.x),d.toBytes(e.y))}),g=c.fromBytes||(a=>{let b=a.subarray(1);return{x:d.fromBytes(b.subarray(0,d.BYTES)),y:d.fromBytes(b.subarray(d.BYTES,2*d.BYTES))}});function h(a){let{a:b,b:e}=c,f=d.sqr(a),g=d.mul(f,a);return d.add(d.add(g,d.mul(a,b)),e)}if(!d.eql(d.sqr(c.Gy),h(c.Gx)))throw Error("bad generator point: equation left != right");function i(a){let b,{allowedPrivateKeyLengths:d,nByteLength:e,wrapPrivateKey:f,n:g}=c;if(d&&"bigint"!=typeof a){if(bv(a)&&(a=bz(a)),"string"!=typeof a||!d.includes(a.length))throw Error("invalid private key");a=a.padStart(2*e,"0")}try{b="bigint"==typeof a?a:bF(bJ("private key",a,e))}catch{throw Error("invalid private key, expected hex or "+e+" bytes, got "+typeof a)}return f&&(b=b2(b,g)),bN("private key",b,cx,g),b}function j(a){if(!(a instanceof m))throw Error("ProjectivePoint expected")}let k=bV((a,b)=>{let{px:c,py:e,pz:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),l=bV(a=>{if(a.is0()){if(c.allowInfinityPoint&&!d.is0(a.py))return;throw Error("bad point: ZERO")}let{x:b,y:e}=a.toAffine();if(!d.isValid(b)||!d.isValid(e))throw Error("bad point: x or y not FE");let f=d.sqr(e),g=h(b);if(!d.eql(f,g))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class m{constructor(a,b,c){if(this.px=a,this.py=b,this.pz=c,null==a||!d.isValid(a))throw Error("x required");if(null==b||!d.isValid(b))throw Error("y required");if(null==c||!d.isValid(c))throw Error("z required");Object.freeze(this)}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof m)throw Error("projective point not allowed");let e=a=>d.eql(a,d.ZERO);return e(b)&&e(c)?m.ZERO:new m(b,c,d.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(a){let b=d.invertBatch(a.map(a=>a.pz));return a.map((a,c)=>a.toAffine(b[c])).map(m.fromAffine)}static fromHex(a){let b=m.fromAffine(g(bJ("pointHex",a)));return b.assertValidity(),b}static fromPrivateKey(a){return m.BASE.multiply(i(a))}static msm(a,b){return function(a,b,c,d){if(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})}(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b),c.length!==d.length)throw Error("arrays of points and scalars must have equal length");let e=a.ZERO,f=bO(BigInt(c.length)),g=f>12?f-3:f>4?f-2:f?2:1,h=(1<<g)-1,i=Array(h+1).fill(e),j=Math.floor((b.BITS-1)/g)*g,k=e;for(let a=j;a>=0;a-=g){i.fill(e);for(let b=0;b<d.length;b++){let e=Number(d[b]>>BigInt(a)&BigInt(h));i[e]=i[e].add(c[b])}let b=e;for(let a=i.length-1,c=e;a>0;a--)c=c.add(i[a]),b=b.add(c);if(k=k.add(b),0!==a)for(let a=0;a<g;a++)k=k.double()}return k}(m,e,a,b)}_setWindowSize(a){o.setWindowSize(this,a)}assertValidity(){l(this)}hasEvenY(){let{y:a}=this.toAffine();if(d.isOdd)return!d.isOdd(a);throw Error("Field doesn't support isOdd")}equals(a){j(a);let{px:b,py:c,pz:e}=this,{px:f,py:g,pz:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),k=d.eql(d.mul(c,h),d.mul(g,e));return i&&k}negate(){return new m(this.px,d.neg(this.py),this.pz)}double(){let{a:a,b:b}=c,e=d.mul(b,cy),{px:f,py:g,pz:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(f,f),n=d.mul(g,g),o=d.mul(h,h),p=d.mul(f,g);return p=d.add(p,p),k=d.mul(f,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(e,o),j=d.add(i,j),i=d.sub(n,j),j=d.add(n,j),j=d.mul(i,j),i=d.mul(p,i),k=d.mul(e,k),o=d.mul(a,o),p=d.sub(l,o),p=d.mul(a,p),p=d.add(p,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,o),l=d.mul(l,p),j=d.add(j,l),o=d.mul(g,h),o=d.add(o,o),l=d.mul(o,p),i=d.sub(i,l),k=d.mul(o,n),k=d.add(k,k),new m(i,j,k=d.add(k,k))}add(a){j(a);let{px:b,py:e,pz:f}=this,{px:g,py:h,pz:i}=a,k=d.ZERO,l=d.ZERO,n=d.ZERO,o=c.a,p=d.mul(c.b,cy),q=d.mul(b,g),r=d.mul(e,h),s=d.mul(f,i),t=d.add(b,e),u=d.add(g,h);t=d.mul(t,u),u=d.add(q,r),t=d.sub(t,u),u=d.add(b,f);let v=d.add(g,i);return u=d.mul(u,v),v=d.add(q,s),u=d.sub(u,v),v=d.add(e,f),k=d.add(h,i),v=d.mul(v,k),k=d.add(r,s),v=d.sub(v,k),n=d.mul(o,u),k=d.mul(p,s),n=d.add(k,n),k=d.sub(r,n),n=d.add(r,n),l=d.mul(k,n),r=d.add(q,q),r=d.add(r,q),s=d.mul(o,s),u=d.mul(p,u),r=d.add(r,s),s=d.sub(q,s),s=d.mul(o,s),u=d.add(u,s),q=d.mul(r,u),l=d.add(l,q),q=d.mul(v,u),k=d.mul(t,k),k=d.sub(k,q),q=d.mul(t,r),n=d.mul(v,n),new m(k,l,n=d.add(n,q))}subtract(a){return this.add(a.negate())}is0(){return this.equals(m.ZERO)}wNAF(a){return o.wNAFCached(this,a,m.normalizeZ)}multiplyUnsafe(a){let{endo:b,n:e}=c;bN("scalar",a,cw,e);let f=m.ZERO;if(a===cw)return f;if(this.is0()||a===cx)return this;if(!b||o.hasPrecomputes(this))return o.wNAFCachedUnsafe(this,a,m.normalizeZ);let{k1neg:g,k1:h,k2neg:i,k2:j}=b.splitScalar(a),k=f,l=f,n=this;for(;h>cw||j>cw;)h&cx&&(k=k.add(n)),j&cx&&(l=l.add(n)),n=n.double(),h>>=cx,j>>=cx;return g&&(k=k.negate()),i&&(l=l.negate()),l=new m(d.mul(l.px,b.beta),l.py,l.pz),k.add(l)}multiply(a){let b,e,{endo:f,n:g}=c;if(bN("scalar",a,cx,g),f){let{k1neg:c,k1:g,k2neg:h,k2:i}=f.splitScalar(a),{p:j,f:k}=this.wNAF(g),{p:l,f:n}=this.wNAF(i);j=o.constTimeNegate(c,j),l=o.constTimeNegate(h,l),l=new m(d.mul(l.px,f.beta),l.py,l.pz),b=j.add(l),e=k.add(n)}else{let{p:c,f:d}=this.wNAF(a);b=c,e=d}return m.normalizeZ([b,e])[0]}multiplyAndAddUnsafe(a,b,c){let d=m.BASE,e=(a,b)=>b!==cw&&b!==cx&&a.equals(d)?a.multiply(b):a.multiplyUnsafe(b),f=e(this,b).add(e(a,c));return f.is0()?void 0:f}toAffine(a){return k(this,a)}isTorsionFree(){let{h:a,isTorsionFree:b}=c;if(a===cx)return!0;if(b)return b(m,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:a,clearCofactor:b}=c;return a===cx?this:b?b(m,this):this.multiplyUnsafe(c.h)}toRawBytes(a=!0){return bx("isCompressed",a),this.assertValidity(),f(m,this,a)}toHex(a=!0){return bx("isCompressed",a),bz(this.toRawBytes(a))}}m.BASE=new m(c.Gx,c.Gy,d.ONE),m.ZERO=new m(d.ZERO,d.ONE,d.ZERO);let n=c.nBitLength,o=(b=c.endo?Math.ceil(n/2):n,{constTimeNegate:cd,hasPrecomputes:a=>1!==ci(a),unsafeLadder(a,b,c=m.ZERO){let d=a;for(;b>cb;)b&cc&&(c=c.add(d)),d=d.double(),b>>=cc;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=cf(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let{windows:e,windowSize:f}=cf(a,b),g=m.ZERO,h=m.BASE,i=BigInt(2**a-1),j=2**a,k=BigInt(a);for(let a=0;a<e;a++){let b=a*f,e=Number(d&i);d>>=k,e>f&&(e-=j,d+=cc);let l=b+Math.abs(e)-1,m=a%2!=0,n=e<0;0===e?h=h.add(cd(m,c[b])):g=g.add(cd(n,c[l]))}return{p:g,f:h}},wNAFUnsafe(a,c,d,e=m.ZERO){let{windows:f,windowSize:g}=cf(a,b),h=BigInt(2**a-1),i=2**a,j=BigInt(a);for(let a=0;a<f;a++){let b=a*g;if(d===cb)break;let f=Number(d&h);if(d>>=j,f>g&&(f-=i,d+=cc),0===f)continue;let k=c[b+Math.abs(f)-1];f<0&&(k=k.negate()),e=e.add(k)}return e},getPrecomputes(a,b,c){let d=cg.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&cg.set(b,c(d))),d},wNAFCached(a,b,c){let d=ci(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=ci(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){ce(c,b),ch.set(a,c),cg.delete(a)}});return{CURVE:c,ProjectivePoint:m,normPrivateKeyToScalar:i,weierstrassEquation:h,isWithinCurveOrder:function(a){return bM(a,cx,c.n)}}}({...b,toBytes(a,b,d){let e=b.toAffine(),f=c.toBytes(e.x);return bx("isCompressed",d),d?bK(Uint8Array.from([b.hasEvenY()?2:3]),f):bK(Uint8Array.from([4]),f,c.toBytes(e.y))},fromBytes(a){let b=a.length,d=a[0],g=a.subarray(1);if(b===e&&(2===d||3===d)){let a,b=bF(g);if(!bM(b,cx,c.ORDER))throw Error("Point is not on curve");let e=j(b);try{a=c.sqrt(e)}catch(a){throw Error("Point is not on curve"+(a instanceof Error?": "+a.message:""))}return(1&d)==1!=((a&cx)===cx)&&(a=c.neg(a)),{x:b,y:a}}if(b===f&&4===d)return{x:c.fromBytes(g.subarray(0,c.BYTES)),y:c.fromBytes(g.subarray(c.BYTES,2*c.BYTES))};throw Error("invalid Point, expected length of "+e+", or uncompressed "+f+", got "+b)}}),l=a=>bz(bH(a,b.nByteLength)),m=(a,b,c)=>bF(a.slice(b,c));class n{constructor(a,b,c){this.r=a,this.s=b,this.recovery=c,this.assertValidity()}static fromCompact(a){let c=b.nByteLength;return new n(m(a=bJ("compactSignature",a,2*c),0,c),m(a,c,2*c))}static fromDER(a){let{r:b,s:c}=cv.toSig(bJ("DER",a));return new n(b,c)}assertValidity(){bN("r",this.r,cx,d),bN("s",this.s,cx,d)}addRecoveryBit(a){return new n(this.r,this.s,a)}recoverPublicKey(a){let{r:e,s:f,recovery:i}=this,j=q(bJ("msgHash",a));if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");let k=2===i||3===i?e+b.n:e;if(k>=c.ORDER)throw Error("recovery id 2 or 3 invalid");let m=(1&i)==0?"02":"03",n=h.fromHex(m+l(k)),o=b5(k,d),p=g(-j*o),r=g(f*o),s=h.BASE.multiplyAndAddUnsafe(n,p,r);if(!s)throw Error("point at infinify");return s.assertValidity(),s}hasHighS(){return this.s>d>>cx}normalizeS(){return this.hasHighS()?new n(this.r,g(-this.s),this.recovery):this}toDERRawBytes(){return bE(this.toDERHex())}toDERHex(){return cv.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return bE(this.toCompactHex())}toCompactHex(){return l(this.r)+l(this.s)}}function o(a){let b=bv(a),c="string"==typeof a,d=(b||c)&&a.length;return b?d===e||d===f:c?d===2*e||d===2*f:a instanceof h}let p=b.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let c=bF(a),d=8*a.length-b.nBitLength;return d>0?c>>BigInt(d):c},q=b.bits2int_modN||function(a){return g(p(a))},r=bP(b.nBitLength);function s(a){return bN("num < 2^"+b.nBitLength,a,cw,r),bH(a,b.nByteLength)}let t={lowS:b.lowS,prehash:!1},u={lowS:b.lowS,prehash:!1};return h.BASE._setWindowSize(8),{CURVE:b,getPublicKey:function(a,b=!0){return h.fromPrivateKey(a).toRawBytes(b)},getSharedSecret:function(a,b,c=!0){if(o(a))throw Error("first arg must be private key");if(!o(b))throw Error("second arg must be public key");return h.fromHex(b).multiply(i(a)).toRawBytes(c)},sign:function(a,e,f=t){let{seed:j,k2sig:l}=function(a,e,f=t){if(["recovered","canonical"].some(a=>a in f))throw Error("sign() legacy options not supported");let{hash:j,randomBytes:l}=b,{lowS:m,prehash:o,extraEntropy:r}=f;null==m&&(m=!0),a=bJ("msgHash",a),cs(f),o&&(a=bJ("prehashed msgHash",j(a)));let u=q(a),v=i(e),w=[s(v),s(u)];if(null!=r&&!1!==r){let a=!0===r?l(c.BYTES):r;w.push(bJ("extraEntropy",a))}return{seed:bK(...w),k2sig:function(a){var b;let c=p(a);if(!k(c))return;let e=b5(c,d),f=h.BASE.multiply(c).toAffine(),i=g(f.x);if(i===cw)return;let j=g(e*g(u+i*v));if(j===cw)return;let l=2*(f.x!==i)|Number(f.y&cx),o=j;return m&&j>d>>cx&&(o=(b=j)>d>>cx?g(-b):b,l^=1),new n(i,o,l)}}}(a,e,f);return bS(b.hash.outputLen,b.nByteLength,b.hmac)(j,l)},verify:function(a,c,e,f=u){let i,j;c=bJ("msgHash",c),e=bJ("publicKey",e);let{lowS:k,prehash:l,format:m}=f;if(cs(f),"strict"in f)throw Error("options.strict was renamed to lowS");if(void 0!==m&&"compact"!==m&&"der"!==m)throw Error("format must be compact or der");let o="string"==typeof a||bv(a),p=!o&&!m&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!o&&!p)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(p&&(i=new n(a.r,a.s)),o){try{"compact"!==m&&(i=n.fromDER(a))}catch(a){if(!(a instanceof cv.Err))throw a}i||"der"===m||(i=n.fromCompact(a))}j=h.fromHex(e)}catch{return!1}if(!i||k&&i.hasHighS())return!1;l&&(c=b.hash(c));let{r:r,s:s}=i,t=q(c),v=b5(s,d),w=g(t*v),x=g(r*v),y=h.BASE.multiplyAndAddUnsafe(j,w,x)?.toAffine();return!!y&&g(y.x)===r},ProjectivePoint:h,Signature:n,utils:{isValidPrivateKey(a){try{return i(a),!0}catch{return!1}},normPrivateKeyToScalar:i,randomPrivateKey:()=>{let a=ca(b.n);return function(a,b,c=!1){let d=a.length,e=b9(b),f=ca(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=b2(c?bG(a):bF(a),b-bY)+bY;return c?bI(g,e):bH(g,e)}(b.randomBytes(a),b.n)},precompute:(a=8,b=h.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}})({...a,hash:b,hmac:(a,...c)=>bj(b,a,function(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];ao(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}(...c)),randomBytes:aC});return{...c(b),create:c}}({a:cz.create(BigInt("-3")),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Fp:cz,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},br),cB="base10",cC="base16",cD="base64pad",cE="base64url",cF="utf8";function cG(){let a=aC(32);return(0,U.toString)(a,cC)}function cH(a){let b=br((0,V.fromString)(a,cF));return(0,U.toString)(b,cC)}function cI(a){return(0,V.fromString)(`${a}`,cB)}function cJ(a){return Number((0,U.toString)(a,cB))}function cK(a){return a.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function cL(a){let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=(4-b.length%4)%4;return b+"=".repeat(c)}function cM(a){if(2===cJ(a.type))return(0,U.toString)((0,W.concat)([a.type,a.sealed]),cD);if(1===cJ(a.type)){if(typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");return(0,U.toString)((0,W.concat)([a.type,a.senderPublicKey,a.iv,a.sealed]),cD)}return(0,U.toString)((0,W.concat)([a.type,a.iv,a.sealed]),cD)}function cN(a){let b=(a.encoding||cD)===cE?cL(a.encoded):a.encoded,c=(0,V.fromString)(b,cD),d=c.slice(0,1);if(1===cJ(d)){let a=c.slice(1,33),b=c.slice(33,45);return{type:d,sealed:c.slice(45),iv:b,senderPublicKey:a}}if(2===cJ(d))return{type:d,sealed:c.slice(1),iv:aC(12)};let e=c.slice(1,13);return{type:d,sealed:c.slice(13),iv:e}}function cO(a){let b=a?.type||0;if(1===b){if(typeof a?.senderPublicKey>"u")throw Error("missing sender public key");if(typeof a?.receiverPublicKey>"u")throw Error("missing receiver public key")}return{type:b,senderPublicKey:a?.senderPublicKey,receiverPublicKey:a?.receiverPublicKey}}function cP(a){return 1===a.type&&"string"==typeof a.senderPublicKey&&"string"==typeof a.receiverPublicKey}function cQ(a){return a?.relay||{protocol:"irn"}}function cR(a){let b=X.RELAY_JSONRPC[a];if(typeof b>"u")throw Error(`Relay Protocol not supported: ${a}`);return b}function cS(a){var b;if(!a.includes("wc:")){let b=am(a);null!=b&&b.includes("wc:")&&(a=b)}let c=(a=(a=a.includes("wc://")?a.replace("wc://",""):a).includes("wc:")?a.replace("wc:",""):a).indexOf(":"),d=-1!==a.indexOf("?")?a.indexOf("?"):void 0,e=a.substring(0,c),f=a.substring(c+1,d).split("@"),g=new URLSearchParams("u">typeof d?a.substring(d):""),h={};g.forEach((a,b)=>{h[b]=a});let i="string"==typeof h.methods?h.methods.split(","):void 0;return{protocol:e,topic:(b=f[0]).startsWith("//")?b.substring(2):b,version:parseInt(f[1],10),symKey:h.symKey,relay:function(a,b="-"){let c={},d="relay"+b;return Object.keys(a).forEach(b=>{if(b.startsWith(d)){let e=b.replace(d,""),f=a[b];c[e]=f}}),c}(h),methods:i,expiryTimestamp:h.expiryTimestamp?parseInt(h.expiryTimestamp,10):void 0}}function cT(a){let b=new URLSearchParams,c=function(a,b="-"){let c={};return Object.keys(a).forEach(d=>{a[d]&&(c["relay"+b+d]=a[d])}),c}(a.relay);Object.keys(c).sort().forEach(a=>{b.set(a,c[a])}),b.set("symKey",a.symKey),a.expiryTimestamp&&b.set("expiryTimestamp",a.expiryTimestamp.toString()),a.methods&&b.set("methods",a.methods.join(","));let d=b.toString();return`${a.protocol}:${a.topic}@${a.version}?${d}`}Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;let cU={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},cV={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function cW(a,b){let{message:c,code:d}=cV[a];return{message:b?`${c} ${b}`:c,code:d}}function cX(a,b){let{message:c,code:d}=cU[a];return{message:b?`${c} ${b}`:c,code:d}}function cY(a){return typeof a>"u"}function cZ(a,b){return!!(b&&cY(a))||"string"==typeof a&&!!a.trim().length}function c$(a){return"u">typeof a}function c_(){let a=aa();return new Promise(b=>{switch(a){case Y.browser:b(_()&&navigator?.onLine);break;case Y.reactNative:b(c0());break;case Y.node:default:b(!0)}})}async function c0(){if($()&&null!=a.g&&a.g.NetInfo){let b=await (null==a.g?void 0:a.g.NetInfo.fetch());return b?.isConnected}return!0}var c1=a.i(258699);a.i(518307);var c2=a.i(860635),c3=a.i(327786),c4=a.i(84988);let c5="core",c6=`wc@2:${c5}:`,c7={logger:"error"},c8={database:":memory:"},c9="client_ed25519_seed",da=v.ONE_DAY,db=v.SIX_HOURS,dc="irn",dd="wss://relay.walletconnect.org",de={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},df={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},dg="2.21.0",dh={link_mode:"link_mode",relay:"relay"},di={inbound:"inbound",outbound:"outbound"},dj="WALLETCONNECT_LINK_MODE_APPS",dk={created:"subscription_created",deleted:"subscription_deleted",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},dl=(v.THIRTY_DAYS,v.FIVE_SECONDS,v.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:v.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:v.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:v.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:v.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:v.ONE_DAY,prompt:!1,tag:0},res:{ttl:v.ONE_DAY,prompt:!1,tag:0}}}),dm={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},dn={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},dp={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},dq=(v.ONE_DAY,"https://verify.walletconnect.org"),dr=dq,ds=`${dr}/v3`,dt=["https://verify.walletconnect.com",dq],du={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},dv={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},dw={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},dx={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},dy={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},dz={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"};var dA=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let dB=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class dC{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class dD{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return dF(this,a)}}class dE{constructor(a){this.decoders=a}or(a){return dF(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let dF=(a,b)=>new dE({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class dG{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new dC(a,b,c),this.decoder=new dD(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let dH=({name:a,prefix:b,encode:c,decode:d})=>new dG(a,b,c,d),dI=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=dA(c,b);return dH({prefix:a,name:b,encode:d,decode:a=>dB(e(a))})},dJ=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>dH({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var dK=Object.freeze({__proto__:null,identity:dH({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),dL=Object.freeze({__proto__:null,base2:dJ({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),dM=Object.freeze({__proto__:null,base8:dJ({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),dN=Object.freeze({__proto__:null,base10:dI({prefix:"9",name:"base10",alphabet:"0123456789"})}),dO=Object.freeze({__proto__:null,base16:dJ({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:dJ({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})});let dP=dJ({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),dQ=dJ({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),dR=dJ({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),dS=dJ({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),dT=dJ({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),dU=dJ({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),dV=dJ({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});var dW=Object.freeze({__proto__:null,base32:dP,base32upper:dQ,base32pad:dR,base32padupper:dS,base32hex:dT,base32hexupper:dU,base32hexpad:dV,base32hexpadupper:dJ({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:dJ({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),dX=Object.freeze({__proto__:null,base36:dI({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:dI({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),dY=Object.freeze({__proto__:null,base58btc:dI({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:dI({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})});let dZ=dJ({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),d$=dJ({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});var d_=Object.freeze({__proto__:null,base64:dZ,base64pad:d$,base64url:dJ({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:dJ({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let d0=Array.from(""),d1=d0.reduce((a,b,c)=>(a[c]=b,a),[]),d2=d0.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var d3=Object.freeze({__proto__:null,base256emoji:dH({prefix:"",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=d1[b],"")},decode:function(a){let b=[];for(let c of a){let a=d2[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function d4(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,d4.bytes=c-d+1,b}var d5={encode:d4,encodingLength:function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10}};let d6=(a,b,c=0)=>(d5.encode(a,b,c),b),d7=a=>d5.encodingLength(a),d8=(a,b)=>{let c=b.byteLength,d=d7(a),e=d+d7(c),f=new Uint8Array(e+c);return d6(a,f,0),d6(c,f,d),f.set(b,e),new d9(a,c,b,f)};class d9{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let ea=({name:a,code:b,encode:c})=>new eb(a,b,c);class eb{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?d8(this.code,b):b.then(a=>d8(this.code,a))}throw Error("Unknown type, must be binary type")}}let ec=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var ed=Object.freeze({__proto__:null,sha256:ea({name:"sha2-256",code:18,encode:ec("SHA-256")}),sha512:ea({name:"sha2-512",code:19,encode:ec("SHA-512")})}),ee=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:dB,digest:a=>d8(0,dB(a))}});new TextEncoder,new TextDecoder;let ef={...dK,...dL,...dM,...dN,...dO,...dW,...dX,...dY,...d_,...d3};function eg(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...ed,...ee});let eh=eg("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),ei=eg("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=function(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(a):new Uint8Array(a)}((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),ej={utf8:eh,"utf-8":eh,hex:ef.base16,latin1:ei,ascii:ei,binary:ei,...ef};var ek=Object.defineProperty,el=(a,b,c)=>((a,b,c)=>b in a?ek(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class em{constructor(a,b){this.core=a,this.logger=b,el(this,"keychain",new Map),el(this,"name","keychain"),el(this,"version","0.3"),el(this,"initialized",!1),el(this,"storagePrefix",c6),el(this,"init",async()=>{if(!this.initialized){let a=await this.getKeyChain();"u">typeof a&&(this.keychain=a),this.initialized=!0}}),el(this,"has",a=>(this.isInitialized(),this.keychain.has(a))),el(this,"set",async(a,b)=>{this.isInitialized(),this.keychain.set(a,b),await this.persist()}),el(this,"get",a=>{this.isInitialized();let b=this.keychain.get(a);if(typeof b>"u"){let{message:b}=cW("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}),el(this,"del",async a=>{this.isInitialized(),this.keychain.delete(a),await this.persist()}),this.core=a,this.logger=(0,e.generateChildLogger)(b,this.name)}get context(){return(0,e.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(a){await this.core.storage.setItem(this.storageKey,ad(a))}async getKeyChain(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?ae(a):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:a}=cW("NOT_INITIALIZED",this.name);throw Error(a)}}}var en=Object.defineProperty,eo=(a,b,c)=>((a,b,c)=>b in a?en(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class ep{constructor(a,b,c){this.core=a,this.logger=b,eo(this,"name","crypto"),eo(this,"keychain"),eo(this,"randomSessionIdentifier",cG()),eo(this,"initialized",!1),eo(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),eo(this,"hasKeys",a=>(this.isInitialized(),this.keychain.has(a))),eo(this,"getClientId",async()=>{this.isInitialized();let a=await this.getClientSeed(),b=x.generateKeyPair(a);return x.encodeIss(b.publicKey)}),eo(this,"generateKeyPair",()=>{this.isInitialized();let a=function(){let a=cr.utils.randomPrivateKey(),b=cr.getPublicKey(a);return{privateKey:(0,U.toString)(a,cC),publicKey:(0,U.toString)(b,cC)}}();return this.setPrivateKey(a.publicKey,a.privateKey)}),eo(this,"signJWT",async a=>{this.isInitialized();let b=await this.getClientSeed(),c=x.generateKeyPair(b),d=this.randomSessionIdentifier;return await x.signJWT(d,a,da,c)}),eo(this,"generateSharedKey",(a,b,c)=>{this.isInitialized();let d=function(a,b){var c;let d,e=cr.getSharedSecret((0,V.fromString)(a,cC),(0,V.fromString)(b,cC)),f=(d=void 0,function(a,b,c,d=32){if(ap(a),an(d),d>255*a.outputLen)throw Error("Length should be <= 255*HashLen");let e=Math.ceil(d/a.outputLen);void 0===c&&(c=bl);let f=new Uint8Array(e*a.outputLen),g=bj.create(a,b),h=g._cloneInto(),i=new Uint8Array(g.outputLen);for(let b=0;b<e;b++)bk[0]=b+1,h.update(0===b?bl:i).update(c).update(bk).digestInto(i),f.set(i,a.outputLen*b),g._cloneInto(h);return g.destroy(),h.destroy(),i.fill(0),bk.fill(0),f.slice(0,d)}(br,(c=void 0,ap(br),void 0===c&&(c=new Uint8Array(br.outputLen)),bj(br,az(c),az(e))),d,32));return(0,U.toString)(f,cC)}(this.getPrivateKey(a),b);return this.setSymKey(d,c)}),eo(this,"setSymKey",async(a,b)=>{this.isInitialized();let c=b||function(a){let b=br((0,V.fromString)(a,cC));return(0,U.toString)(b,cC)}(a);return await this.keychain.set(c,a),c}),eo(this,"deleteKeyPair",async a=>{this.isInitialized(),await this.keychain.del(a)}),eo(this,"deleteSymKey",async a=>{this.isInitialized(),await this.keychain.del(a)}),eo(this,"encode",async(a,b,c)=>{this.isInitialized();let d=cO(c),e=(0,w.safeJsonStringify)(b);if(2===d.type)return function(a,b){let c=cI(2),d=aC(12),e=cM({type:c,sealed:(0,V.fromString)(a,cF),iv:d});return b===cE?cK(e):e}(e,c?.encoding);if(cP(d)){let b=d.senderPublicKey,c=d.receiverPublicKey;a=await this.generateSharedKey(b,c)}let f=this.getSymKey(a),{type:g,senderPublicKey:h}=d;return function(a){let b=cI("u">typeof a.type?a.type:0);if(1===cJ(b)&&typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");let c="u">typeof a.senderPublicKey?(0,V.fromString)(a.senderPublicKey,cC):void 0,d="u">typeof a.iv?(0,V.fromString)(a.iv,cC):aC(12),e=cM({type:b,sealed:bh((0,V.fromString)(a.symKey,cC),d).encrypt((0,V.fromString)(a.message,cF)),iv:d,senderPublicKey:c});return a.encoding===cE?cK(e):e}({type:g,symKey:f,message:e,senderPublicKey:h,encoding:c?.encoding})}),eo(this,"decode",async(a,b,c)=>{this.isInitialized();let d=function(a,b){let c=cN({encoded:a,encoding:b?.encoding});return cO({type:cJ(c.type),senderPublicKey:"u">typeof c.senderPublicKey?(0,U.toString)(c.senderPublicKey,cC):void 0,receiverPublicKey:b?.receiverPublicKey})}(b,c);if(2===d.type){let a=function(a,b){let{sealed:c}=cN({encoded:a,encoding:b});return(0,U.toString)(c,cF)}(b,c?.encoding);return(0,w.safeJsonParse)(a)}if(cP(d)){let b=d.receiverPublicKey,c=d.senderPublicKey;a=await this.generateSharedKey(b,c)}try{let d=this.getSymKey(a),e=function(a){let b=(0,V.fromString)(a.symKey,cC),{sealed:c,iv:d}=cN({encoded:a.encoded,encoding:a.encoding}),e=bh(b,d).decrypt(c);if(null===e)throw Error("Failed to decrypt");return(0,U.toString)(e,cF)}({symKey:d,encoded:b,encoding:c?.encoding});return(0,w.safeJsonParse)(e)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}}),eo(this,"getPayloadType",(a,b=cD)=>cJ(cN({encoded:a,encoding:b}).type)),eo(this,"getPayloadSenderPublicKey",(a,b=cD)=>{let c=cN({encoded:a,encoding:b});return c.senderPublicKey?(0,U.toString)(c.senderPublicKey,cC):void 0}),this.core=a,this.logger=(0,e.generateChildLogger)(b,this.name),this.keychain=c||new em(this.core,this.logger)}get context(){return(0,e.getLoggerContext)(this.logger)}async setPrivateKey(a,b){return await this.keychain.set(a,b),a}getPrivateKey(a){return this.keychain.get(a)}async getClientSeed(){let a="";try{a=this.keychain.get(c9)}catch{a=cG(),await this.keychain.set(c9,a)}return function(a,b="utf8"){let c=ej[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(a,"utf8"):c.decoder.decode(`${c.prefix}${a}`)}(a,"base16")}getSymKey(a){return this.keychain.get(a)}isInitialized(){if(!this.initialized){let{message:a}=cW("NOT_INITIALIZED",this.name);throw Error(a)}}}var eq=Object.defineProperty,er=Object.defineProperties,es=Object.getOwnPropertyDescriptors,et=Object.getOwnPropertySymbols,eu=Object.prototype.hasOwnProperty,ev=Object.prototype.propertyIsEnumerable,ew=(a,b,c)=>b in a?eq(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,ex=(a,b,c)=>ew(a,"symbol"!=typeof b?b+"":b,c);class ey extends m{constructor(a,b){super(a,b),this.logger=a,this.core=b,ex(this,"messages",new Map),ex(this,"messagesWithoutClientAck",new Map),ex(this,"name","messages"),ex(this,"version","0.3"),ex(this,"initialized",!1),ex(this,"storagePrefix",c6),ex(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let a=await this.getRelayerMessages();"u">typeof a&&(this.messages=a);let b=await this.getRelayerMessagesWithoutClientAck();"u">typeof b&&(this.messagesWithoutClientAck=b),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}finally{this.initialized=!0}}}),ex(this,"set",async(a,b,c)=>{this.isInitialized();let d=cH(b),e=this.messages.get(a);if(typeof e>"u"&&(e={}),"u">typeof e[d])return d;if(e[d]=b,this.messages.set(a,e),c===di.inbound){let c=this.messagesWithoutClientAck.get(a)||{};this.messagesWithoutClientAck.set(a,er(((a,b)=>{for(var c in b||(b={}))eu.call(b,c)&&ew(a,c,b[c]);if(et)for(var c of et(b))ev.call(b,c)&&ew(a,c,b[c]);return a})({},c),es({[d]:b})))}return await this.persist(),d}),ex(this,"get",a=>{this.isInitialized();let b=this.messages.get(a);return typeof b>"u"&&(b={}),b}),ex(this,"getWithoutAck",a=>{this.isInitialized();let b={};for(let c of a){let a=this.messagesWithoutClientAck.get(c)||{};b[c]=Object.values(a)}return b}),ex(this,"has",(a,b)=>(this.isInitialized(),"u">typeof this.get(a)[cH(b)])),ex(this,"ack",async(a,b)=>{this.isInitialized();let c=this.messagesWithoutClientAck.get(a);if(typeof c>"u")return;let d=cH(b);delete c[d],0===Object.keys(c).length?this.messagesWithoutClientAck.delete(a):this.messagesWithoutClientAck.set(a,c),await this.persist()}),ex(this,"del",async a=>{this.isInitialized(),this.messages.delete(a),this.messagesWithoutClientAck.delete(a),await this.persist()}),this.logger=(0,e.generateChildLogger)(a,this.name),this.core=b}get context(){return(0,e.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(a){await this.core.storage.setItem(this.storageKey,ad(a))}async setRelayerMessagesWithoutClientAck(a){await this.core.storage.setItem(this.storageKeyWithoutClientAck,ad(a))}async getRelayerMessages(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?ae(a):void 0}async getRelayerMessagesWithoutClientAck(){let a=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return"u">typeof a?ae(a):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:a}=cW("NOT_INITIALIZED",this.name);throw Error(a)}}}var ez=Object.defineProperty,eA=Object.defineProperties,eB=Object.getOwnPropertyDescriptors,eC=Object.getOwnPropertySymbols,eD=Object.prototype.hasOwnProperty,eE=Object.prototype.propertyIsEnumerable,eF=(a,b,c)=>b in a?ez(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,eG=(a,b)=>{for(var c in b||(b={}))eD.call(b,c)&&eF(a,c,b[c]);if(eC)for(var c of eC(b))eE.call(b,c)&&eF(a,c,b[c]);return a},eH=(a,b)=>eA(a,eB(b)),eI=(a,b,c)=>eF(a,"symbol"!=typeof b?b+"":b,c);class eJ extends n{constructor(a,c){super(a,c),this.relayer=a,this.logger=c,eI(this,"events",new b.EventEmitter),eI(this,"name","publisher"),eI(this,"queue",new Map),eI(this,"publishTimeout",(0,v.toMiliseconds)(v.ONE_MINUTE)),eI(this,"initialPublishTimeout",(0,v.toMiliseconds)(15*v.ONE_SECOND)),eI(this,"needsTransportRestart",!1),eI(this,"publish",async(a,b,c)=>{var d;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:a,message:b,opts:c}});let e=c?.ttl||db,f=cQ(c),g=c?.prompt||!1,h=c?.tag||0,i=c?.id||(0,c2.getBigIntRpcId)().toString(),j={topic:a,message:b,opts:{ttl:e,relay:f,prompt:g,tag:h,id:i,attestation:c?.attestation,tvf:c?.tvf}},k=`Failed to publish payload, please try again. id:${i} tag:${h}`;try{let d=new Promise(async d=>{let f=({id:a})=>{j.opts.id===a&&(this.removeRequestFromQueue(a),this.relayer.events.removeListener(de.publish,f),d(j))};this.relayer.events.on(de.publish,f);let k=af(new Promise((d,f)=>{this.rpcPublish({topic:a,message:b,ttl:e,prompt:g,tag:h,id:i,attestation:c?.attestation,tvf:c?.tvf}).then(d).catch(a=>{this.logger.warn(a,a?.message),f(a)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${i} tag:${h}`);try{await k,this.events.removeListener(de.publish,f)}catch(a){this.queue.set(i,eH(eG({},j),{attempt:1})),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:i,topic:a,message:b,opts:c}}),await af(d,this.publishTimeout,k)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(d=c?.internal)&&d.throwOnFailedPublish)throw a}finally{this.queue.delete(i)}}),eI(this,"on",(a,b)=>{this.events.on(a,b)}),eI(this,"once",(a,b)=>{this.events.once(a,b)}),eI(this,"off",(a,b)=>{this.events.off(a,b)}),eI(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.relayer=a,this.logger=(0,e.generateChildLogger)(c,this.name),this.registerEventListeners()}get context(){return(0,e.getLoggerContext)(this.logger)}async rpcPublish(a){var b,c,d,e;let{topic:f,message:g,ttl:h=db,prompt:i,tag:j,id:k,attestation:l,tvf:m}=a,n={method:cR(cQ().protocol).publish,params:eG({topic:f,message:g,ttl:h,prompt:i,tag:j,attestation:l},m),id:k};cY(null==(b=n.params)?void 0:b.prompt)&&(null==(c=n.params)||delete c.prompt),cY(null==(d=n.params)?void 0:d.tag)&&(null==(e=n.params)||delete e.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:n});let o=await this.relayer.request(n);return this.relayer.events.emit(de.publish,a),this.logger.debug("Successfully Published Payload"),o}removeRequestFromQueue(a){this.queue.delete(a)}checkQueue(){this.queue.forEach(async(a,b)=>{let c=a.attempt+1;this.queue.set(b,eH(eG({},a),{attempt:c}));let{topic:d,message:e,opts:f,attestation:g}=a;this.logger.warn({},`Publisher: queue->publishing: ${a.opts.id}, tag: ${a.opts.tag}, attempt: ${c}`),await this.rpcPublish(eH(eG({},a),{topic:d,message:e,ttl:f.ttl,prompt:f.prompt,tag:f.tag,id:f.id,attestation:g,tvf:f.tvf})),this.logger.warn({},`Publisher: queue->published: ${a.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(c.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(de.connection_stalled);return}this.checkQueue()}),this.relayer.on(de.message_ack,a=>{this.removeRequestFromQueue(a.id.toString())})}}var eK=Object.defineProperty,eL=(a,b,c)=>((a,b,c)=>b in a?eK(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class eM{constructor(){eL(this,"map",new Map),eL(this,"set",(a,b)=>{let c=this.get(a);this.exists(a,b)||this.map.set(a,[...c,b])}),eL(this,"get",a=>this.map.get(a)||[]),eL(this,"exists",(a,b)=>this.get(a).includes(b)),eL(this,"delete",(a,b)=>{if(typeof b>"u")return void this.map.delete(a);if(!this.map.has(a))return;let c=this.get(a);if(!this.exists(a,b))return;let d=c.filter(a=>a!==b);if(!d.length)return void this.map.delete(a);this.map.set(a,d)}),eL(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var eN=Object.defineProperty,eO=Object.defineProperties,eP=Object.getOwnPropertyDescriptors,eQ=Object.getOwnPropertySymbols,eR=Object.prototype.hasOwnProperty,eS=Object.prototype.propertyIsEnumerable,eT=(a,b,c)=>b in a?eN(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,eU=(a,b)=>{for(var c in b||(b={}))eR.call(b,c)&&eT(a,c,b[c]);if(eQ)for(var c of eQ(b))eS.call(b,c)&&eT(a,c,b[c]);return a},eV=(a,b)=>eO(a,eP(b)),eW=(a,b,c)=>eT(a,"symbol"!=typeof b?b+"":b,c);class eX extends q{constructor(a,d){super(a,d),this.relayer=a,this.logger=d,eW(this,"subscriptions",new Map),eW(this,"topicMap",new eM),eW(this,"events",new b.EventEmitter),eW(this,"name","subscription"),eW(this,"version","0.3"),eW(this,"pending",new Map),eW(this,"cached",[]),eW(this,"initialized",!1),eW(this,"storagePrefix",c6),eW(this,"subscribeTimeout",(0,v.toMiliseconds)(v.ONE_MINUTE)),eW(this,"initialSubscribeTimeout",(0,v.toMiliseconds)(15*v.ONE_SECOND)),eW(this,"clientId"),eW(this,"batchSubscribeTopicsLimit",500),eW(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),eW(this,"subscribe",async(a,b)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}});try{let c=cQ(b),d={topic:a,relay:c,transportType:b?.transportType};this.pending.set(a,d);let e=await this.rpcSubscribe(a,c,b);return"string"==typeof e&&(this.onSubscribe(e,d),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}})),e}catch(a){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(a),a}}),eW(this,"unsubscribe",async(a,b)=>{this.isInitialized(),"u">typeof b?.id?await this.unsubscribeById(a,b.id,b):await this.unsubscribeByTopic(a,b)}),eW(this,"isSubscribed",a=>new Promise(b=>{b(this.topicMap.topics.includes(a))})),eW(this,"isKnownTopic",a=>new Promise(b=>{b(this.topicMap.topics.includes(a)||this.pending.has(a)||this.cached.some(b=>b.topic===a))})),eW(this,"on",(a,b)=>{this.events.on(a,b)}),eW(this,"once",(a,b)=>{this.events.once(a,b)}),eW(this,"off",(a,b)=>{this.events.off(a,b)}),eW(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),eW(this,"start",async()=>{await this.onConnect()}),eW(this,"stop",async()=>{await this.onDisconnect()}),eW(this,"restart",async()=>{await this.restore(),await this.onRestart()}),eW(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;let a=[];this.pending.forEach(b=>{a.push(b)}),await this.batchSubscribe(a)}),eW(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(c.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(dk.created,async a=>{let b=dk.created;this.logger.info(`Emitting ${b}`),this.logger.debug({type:"event",event:b,data:a}),await this.persist()}),this.events.on(dk.deleted,async a=>{let b=dk.deleted;this.logger.info(`Emitting ${b}`),this.logger.debug({type:"event",event:b,data:a}),await this.persist()})}),this.relayer=a,this.logger=(0,e.generateChildLogger)(d,this.name),this.clientId=""}get context(){return(0,e.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(a,b){let c=!1;try{c=this.getSubscription(a).topic===b}catch{}return c}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(a,b){let c=this.topicMap.get(a);await Promise.all(c.map(async c=>await this.unsubscribeById(a,c,b)))}async unsubscribeById(a,b,c){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}});try{let d=cQ(c);await this.restartToComplete({topic:a,id:b,relay:d}),await this.rpcUnsubscribe(a,b,d);let e=cX("USER_DISCONNECTED",`${this.name}, ${a}`);await this.onUnsubscribe(a,b,e),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(a,b,c){var d;c&&c?.transportType!==dh.relay||await this.restartToComplete({topic:a,id:a,relay:b});let e={method:cR(b.protocol).subscribe,params:{topic:a}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:e});let f=null==(d=c?.internal)?void 0:d.throwOnFailedPublish;try{let b=await this.getSubscriptionId(a);if(c?.transportType===dh.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(e).catch(a=>this.logger.warn(a))},(0,v.toMiliseconds)(v.ONE_SECOND)),b;let d=new Promise(async b=>{let c=d=>{d.topic===a&&(this.events.removeListener(dk.created,c),b(d.id))};this.events.on(dk.created,c);try{let d=await af(new Promise((a,b)=>{this.relayer.request(e).catch(a=>{this.logger.warn(a,a?.message),b(a)}).then(a)}),this.initialSubscribeTimeout,`Subscribing to ${a} failed, please try again`);this.events.removeListener(dk.created,c),b(d)}catch{}}),g=await af(d,this.subscribeTimeout,`Subscribing to ${a} failed, please try again`);if(!g&&f)throw Error(`Subscribing to ${a} failed, please try again`);return g?b:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(de.connection_stalled),f)throw a}return null}async rpcBatchSubscribe(a){if(!a.length)return;let b={method:cR(a[0].relay.protocol).batchSubscribe,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:b});try{await await af(new Promise(a=>{this.relayer.request(b).catch(a=>this.logger.warn(a)).then(a)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(de.connection_stalled)}}async rpcBatchFetchMessages(a){let b;if(!a.length)return;let c={method:cR(a[0].relay.protocol).batchFetchMessages,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:c});try{b=await await af(new Promise((a,b)=>{this.relayer.request(c).catch(a=>{this.logger.warn(a),b(a)}).then(a)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(de.connection_stalled)}return b}rpcUnsubscribe(a,b,c){let d={method:cR(c.protocol).unsubscribe,params:{topic:a,id:b}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:d}),this.relayer.request(d)}onSubscribe(a,b){this.setSubscription(a,eV(eU({},b),{id:a})),this.pending.delete(b.topic)}onBatchSubscribe(a){a.length&&a.forEach(a=>{this.setSubscription(a.id,eU({},a)),this.pending.delete(a.topic)})}async onUnsubscribe(a,b,c){this.events.removeAllListeners(b),this.hasSubscription(b,a)&&this.deleteSubscription(b,c),await this.relayer.messages.del(a)}async setRelayerSubscriptions(a){await this.relayer.core.storage.setItem(this.storageKey,a)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(a,b){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:a,subscription:b}),this.addSubscription(a,b)}addSubscription(a,b){this.subscriptions.set(a,eU({},b)),this.topicMap.set(b.topic,a),this.events.emit(dk.created,b)}getSubscription(a){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:a});let b=this.subscriptions.get(a);if(!b){let{message:b}=cW("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}deleteSubscription(a,b){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:a,reason:b});let c=this.getSubscription(a);this.subscriptions.delete(a),this.topicMap.delete(c.topic,a),this.events.emit(dk.deleted,eV(eU({},c),{reason:b}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(dk.sync)}async onRestart(){if(this.cached.length){let a=[...this.cached],b=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let c=0;c<b;c++){let b=a.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(b)}}this.events.emit(dk.resubscribed)}async restore(){try{let a=await this.getRelayerSubscriptions();if(typeof a>"u"||!a.length)return;if(this.subscriptions.size){let{message:a}=cW("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(a){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(a)}}async batchSubscribe(a){a.length&&(await this.rpcBatchSubscribe(a),this.onBatchSubscribe(await Promise.all(a.map(async a=>eV(eU({},a),{id:await this.getSubscriptionId(a.topic)})))))}async batchFetchMessages(a){var b;if(!a.length)return;this.logger.trace(`Fetching batch messages for ${a.length} subscriptions`);let c=await this.rpcBatchFetchMessages(a);c&&c.messages&&(await (b=(0,v.toMiliseconds)(v.ONE_SECOND),new Promise(a=>setTimeout(a,b))),await this.relayer.handleBatchMessageEvents(c.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:a}=cW("NOT_INITIALIZED",this.name);throw Error(a)}}async restartToComplete(a){this.relayer.connected||this.relayer.connecting||(this.cached.push(a),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(a){return cH(a+await this.getClientId())}}var eY=Object.defineProperty,eZ=Object.getOwnPropertySymbols,e$=Object.prototype.hasOwnProperty,e_=Object.prototype.propertyIsEnumerable,e0=(a,b,c)=>b in a?eY(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,e1=(a,b)=>{for(var c in b||(b={}))e$.call(b,c)&&e0(a,c,b[c]);if(eZ)for(var c of eZ(b))e_.call(b,c)&&e0(a,c,b[c]);return a},e2=(a,b,c)=>e0(a,"symbol"!=typeof b?b+"":b,c);class e3 extends o{constructor(c){super(c),e2(this,"protocol","wc"),e2(this,"version",2),e2(this,"core"),e2(this,"logger"),e2(this,"events",new b.EventEmitter),e2(this,"provider"),e2(this,"messages"),e2(this,"subscriber"),e2(this,"publisher"),e2(this,"name","relayer"),e2(this,"transportExplicitlyClosed",!1),e2(this,"initialized",!1),e2(this,"connectionAttemptInProgress",!1),e2(this,"relayUrl"),e2(this,"projectId"),e2(this,"packageName"),e2(this,"bundleId"),e2(this,"hasExperiencedNetworkDisruption",!1),e2(this,"pingTimeout"),e2(this,"heartBeatTimeout",(0,v.toMiliseconds)(v.THIRTY_SECONDS+v.FIVE_SECONDS)),e2(this,"reconnectTimeout"),e2(this,"connectPromise"),e2(this,"reconnectInProgress",!1),e2(this,"requestsInFlight",[]),e2(this,"connectTimeout",(0,v.toMiliseconds)(15*v.ONE_SECOND)),e2(this,"request",async a=>{var b,c;this.logger.debug("Publishing Request Payload");let d=a.id||(0,c2.getBigIntRpcId)().toString();await this.toEstablishConnection();try{this.logger.trace({id:d,method:a.method,topic:null==(b=a.params)?void 0:b.topic},"relayer.request - publishing...");let e=`${d}:${(null==(c=a.params)?void 0:c.tag)||""}`;this.requestsInFlight.push(e);let f=await this.provider.request(a);return this.requestsInFlight=this.requestsInFlight.filter(a=>a!==e),f}catch(a){throw this.logger.debug(`Failed to Publish Request: ${d}`),a}}),e2(this,"resetPingTimeout",()=>{Z()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var a,b,c,d;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(d=null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.terminate)||d.call(c)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),e2(this,"onPayloadHandler",a=>{this.onProviderPayload(a),this.resetPingTimeout()}),e2(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(de.connect)}),e2(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),e2(this,"onProviderErrorHandler",a=>{this.logger.fatal(`Fatal socket error: ${a.message}`),this.events.emit(de.error,a),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),e2(this,"registerProviderListeners",()=>{this.provider.on(df.payload,this.onPayloadHandler),this.provider.on(df.connect,this.onConnectHandler),this.provider.on(df.disconnect,this.onDisconnectHandler),this.provider.on(df.error,this.onProviderErrorHandler)}),this.core=c.core,this.logger="u">typeof c.logger&&"string"!=typeof c.logger?(0,e.generateChildLogger)(c.logger,this.name):(0,f.pino)((0,e.getDefaultLoggerOptions)({level:c.logger||"error"})),this.messages=new ey(this.logger,c.core),this.subscriber=new eX(this,this.logger),this.publisher=new eJ(this,this.logger),this.relayUrl=c?.relayUrl||dd,this.projectId=c.projectId,$()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="android"?this.packageName=ab():$()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="ios"&&(this.bundleId=ab()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(a){this.logger.warn(a,a?.message)}}get context(){return(0,e.getLoggerContext)(this.logger)}get connected(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===1}get connecting(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===0||void 0!==this.connectPromise}async publish(a,b,c){this.isInitialized(),await this.publisher.publish(a,b,c),await this.recordMessageEvent({topic:a,message:b,publishedAt:Date.now(),transportType:dh.relay},di.outbound)}async subscribe(a,b){var c,d,e;this.isInitialized(),null!=b&&b.transportType&&b?.transportType!=="relay"||await this.toEstablishConnection();let f=typeof(null==(c=b?.internal)?void 0:c.throwOnFailedPublish)>"u"||(null==(d=b?.internal)?void 0:d.throwOnFailedPublish),g=(null==(e=this.subscriber.topicMap.get(a))?void 0:e[0])||"",h,i=b=>{b.topic===a&&(this.subscriber.off(dk.created,i),h())};return await Promise.all([new Promise(a=>{h=a,this.subscriber.on(dk.created,i)}),new Promise(async(c,d)=>{g=await this.subscriber.subscribe(a,e1({internal:{throwOnFailedPublish:f}},b)).catch(a=>{f&&d(a)})||g,c()})]),g}async unsubscribe(a,b){this.isInitialized(),await this.subscriber.unsubscribe(a,b)}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await af(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(a){if(!this.subscriber.hasAnyTopics)return void this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(b,c)=>{await this.connect(a).then(b).catch(c).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(a){this.logger.debug({},"Restarting transport..."),this.connectionAttemptInProgress||(this.relayUrl=a||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await c_())throw Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(a){if(a?.length===0)return void this.logger.trace("Batch message events is empty. Ignoring...");let b=a.sort((a,b)=>a.publishedAt-b.publishedAt);for(let a of(this.logger.debug(`Batch of ${b.length} message events sorted`),b))try{await this.onMessageEvent(a)}catch(a){this.logger.warn(a,"Error while processing batch message event: "+a?.message)}this.logger.trace(`Batch of ${b.length} message events processed`)}async onLinkMessageEvent(a,b){let{topic:c}=a;if(!b.sessionExists){let a=ah(v.FIVE_MINUTES);await this.core.pairing.pairings.set(c,{topic:c,expiry:a,relay:{protocol:"irn"},active:!1})}this.events.emit(de.message,a),await this.recordMessageEvent(a,di.inbound)}async connect(a){await this.confirmOnlineStateOrThrow(),a&&a!==this.relayUrl&&(this.relayUrl=a,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let b=1;for(;b<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${b}...`),await this.createProvider(),await new Promise(async(a,b)=>{let c=()=>{b(Error("Connection interrupted while trying to subscribe"))};this.provider.once(df.disconnect,c),await af(new Promise((a,b)=>{this.provider.connect().then(a).catch(b)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>{b(a)}).finally(()=>{this.provider.off(df.disconnect,c),clearTimeout(this.reconnectTimeout)}),await new Promise(async(a,b)=>{let c=()=>{b(Error("Connection interrupted while trying to subscribe"))};this.provider.once(df.disconnect,c),await this.subscriber.start().then(a).catch(b).finally(()=>{this.provider.off(df.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,a()})}catch(a){await this.subscriber.stop(),this.logger.warn({},a.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${b}`);break}await new Promise(a=>setTimeout(a,(0,v.toMiliseconds)(+b))),b++}}startPingTimeout(){var a,b,c,d,e;if(Z())try{null!=(b=null==(a=this.provider)?void 0:a.connection)&&b.socket&&(null==(e=null==(d=null==(c=this.provider)?void 0:c.connection)?void 0:d.socket)||e.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let a=await this.core.crypto.signJWT(this.relayUrl);this.provider=new c1.JsonRpcProvider(new c4.default(function({protocol:a,version:b,relayUrl:c,sdkVersion:d,auth:e,projectId:f,useOnCloseEvent:g,bundleId:h,packageName:i}){let j=c.split("?"),k=ac(a,b,d),l=function(a,b){let c=new URLSearchParams(a);for(let a of Object.keys(b).sort())if(b.hasOwnProperty(a)){let d=b[a];void 0!==d&&c.set(a,d)}return c.toString()}(j[1]||"",{auth:e,ua:k,projectId:f,useOnCloseEvent:g||void 0,packageName:i||void 0,bundleId:h||void 0});return j[0]+"?"+l}({sdkVersion:dg,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:a,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(a,b){let{topic:c,message:d}=a;await this.messages.set(c,d,b)}async shouldIgnoreMessageEvent(a){let{topic:b,message:c}=a;if(!c||0===c.length)return this.logger.warn(`Ignoring invalid/empty message: ${c}`),!0;if(!await this.subscriber.isKnownTopic(b))return this.logger.warn(`Ignoring message for unknown topic ${b}`),!0;let d=this.messages.has(b,c);return d&&this.logger.warn(`Ignoring duplicate message: ${c}`),d}async onProviderPayload(a){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:a}),(0,c3.isJsonRpcRequest)(a)){if(!a.method.endsWith("_subscription"))return;let b=a.params,{topic:c,message:d,publishedAt:e,attestation:f}=b.data,g={topic:c,message:d,publishedAt:e,transportType:dh.relay,attestation:f};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(e1({type:"event",event:b.id},g)),this.events.emit(b.id,g),await this.acknowledgePayload(a),await this.onMessageEvent(g)}else(0,c3.isJsonRpcResponse)(a)&&this.events.emit(de.message_ack,a)}async onMessageEvent(a){await this.shouldIgnoreMessageEvent(a)||(await this.recordMessageEvent(a,di.inbound),this.events.emit(de.message,a))}async acknowledgePayload(a){let b=(0,c2.formatJsonRpcResult)(a.id,!0);await this.provider.connection.send(b)}unregisterProviderListeners(){this.provider.off(df.payload,this.onPayloadHandler),this.provider.off(df.connect,this.onConnectHandler),this.provider.off(df.disconnect,this.onDisconnectHandler),this.provider.off(df.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let b=await c_();(function(b){var c,d;switch(aa()){case Y.browser:c=b,!$()&&_()&&(window.addEventListener("online",()=>c(!0)),window.addEventListener("offline",()=>c(!1)));break;case Y.reactNative:d=b,$()&&null!=a.g&&a.g.NetInfo&&a.g?.NetInfo.addEventListener(a=>d(a?.isConnected));case Y.node:}})(async a=>{b!==a&&(b=a,a?await this.transportOpen().catch(a=>this.logger.error(a,a?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(c.HEARTBEAT_EVENTS.pulse,async()=>{var a;if(!this.transportExplicitlyClosed&&!this.connected&&(!(_()&&(0,z.getDocument)())||(null==(a=(0,z.getDocument)())?void 0:a.visibilityState)==="visible"))try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(a){this.logger.warn(a,a?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(de.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(a=>this.logger.error(a,a?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,v.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:a}=cW("NOT_INITIALIZED",this.name);throw Error(a)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function e4(){}function e5(a){if(!a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&"[object Object]"===Object.prototype.toString.call(a)}function e6(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function e7(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let e8="[object Arguments]",e9="[object Object]";var fa=Object.defineProperty,fb=Object.getOwnPropertySymbols,fc=Object.prototype.hasOwnProperty,fd=Object.prototype.propertyIsEnumerable,fe=(a,b,c)=>b in a?fa(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,ff=(a,b)=>{for(var c in b||(b={}))fc.call(b,c)&&fe(a,c,b[c]);if(fb)for(var c of fb(b))fd.call(b,c)&&fe(a,c,b[c]);return a},fg=(a,b,c)=>fe(a,"symbol"!=typeof b?b+"":b,c);class fh extends p{constructor(a,b,c,d=c6,f){super(a,b,c,d),this.core=a,this.logger=b,this.name=c,fg(this,"map",new Map),fg(this,"version","0.3"),fg(this,"cached",[]),fg(this,"initialized",!1),fg(this,"getKey"),fg(this,"storagePrefix",c6),fg(this,"recentlyDeleted",[]),fg(this,"recentlyDeletedLimit",200),fg(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&null!==a&&!cY(a)?this.map.set(this.getKey(a),a):function(a){var b;return null==(b=a?.proposer)?void 0:b.publicKey}(a)?this.map.set(a.id,a):a?.topic&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)}),fg(this,"set",async(a,b)=>{this.isInitialized(),this.map.has(a)?await this.update(a,b):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:b}),this.map.set(a,b),await this.persist())}),fg(this,"get",a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a))),fg(this,"getAll",a=>(this.isInitialized(),a?this.values.filter(b=>Object.keys(a).every(c=>{var d;return d=b[c],function a(b,c,d,e,f,g,h){let i=h(b,c,d,e,f,g);if(void 0!==i)return i;if(typeof b==typeof c)switch(typeof b){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return b===c;case"number":return b===c||Object.is(b,c)}return function b(c,d,e,f){if(Object.is(c,d))return!0;let g=e7(c),h=e7(d);if(g===e8&&(g=e9),h===e8&&(h=e9),g!==h)return!1;switch(g){case"[object String]":return c.toString()===d.toString();case"[object Number]":{let a=c.valueOf(),b=d.valueOf();return a===b||Number.isNaN(a)&&Number.isNaN(b)}case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(c.valueOf(),d.valueOf());case"[object RegExp]":return c.source===d.source&&c.flags===d.flags;case"[object Function]":return c===d}let i=(e=e??new Map).get(c),j=e.get(d);if(null!=i&&null!=j)return i===d;e.set(c,d),e.set(d,c);try{switch(g){case"[object Map]":if(c.size!==d.size)return!1;for(let[b,g]of c.entries())if(!d.has(b)||!a(g,d.get(b),b,c,d,e,f))return!1;return!0;case"[object Set]":{if(c.size!==d.size)return!1;let b=Array.from(c.values()),g=Array.from(d.values());for(let h=0;h<b.length;h++){let i=b[h],j=g.findIndex(b=>a(i,b,void 0,c,d,e,f));if(-1===j)return!1;g.splice(j,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if("u">typeof Buffer&&Buffer.isBuffer(c)!==Buffer.isBuffer(d)||c.length!==d.length)return!1;for(let b=0;b<c.length;b++)if(!a(c[b],d[b],b,c,d,e,f))return!1;return!0;case"[object ArrayBuffer]":return c.byteLength===d.byteLength&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object DataView]":return c.byteLength===d.byteLength&&c.byteOffset===d.byteOffset&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object Error]":return c.name===d.name&&c.message===d.message;case e9:{if(!(b(c.constructor,d.constructor,e,f)||e5(c)&&e5(d)))return!1;let g=[...Object.keys(c),...e6(c)],h=[...Object.keys(d),...e6(d)];if(g.length!==h.length)return!1;for(let b=0;b<g.length;b++){let h=g[b],i=c[h];if(!Object.hasOwn(d,h))return!1;let j=d[h];if(!a(i,j,h,c,d,e,f))return!1}return!0}default:return!1}}finally{e.delete(c),e.delete(d)}}(b,c,g,h)}(d,a[c],void 0,void 0,void 0,void 0,e4)})):this.values)),fg(this,"update",async(a,b)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:b});let c=ff(ff({},this.getData(a)),b);this.map.set(a,c),await this.persist()}),fg(this,"delete",async(a,b)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:b}),this.map.delete(a),this.addToRecentlyDeleted(a),await this.persist())}),this.logger=(0,e.generateChildLogger)(b,this.name),this.storagePrefix=d,this.getKey=f}get context(){return(0,e.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(a){this.recentlyDeleted.push(a),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(a){await this.core.storage.setItem(this.storageKey,a)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(a){let b=this.map.get(a);if(!b){if(this.recentlyDeleted.includes(a)){let{message:b}=cW("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${a}`);throw this.logger.error(b),Error(b)}let{message:b}=cW("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.error(b),Error(b)}return b}async persist(){await this.setDataStore(this.values)}async restore(){try{let a=await this.getDataStore();if(typeof a>"u"||!a.length)return;if(this.map.size){let{message:a}=cW("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(a){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(a)}}isInitialized(){if(!this.initialized){let{message:a}=cW("NOT_INITIALIZED",this.name);throw Error(a)}}}var fi=Object.defineProperty,fj=(a,b,c)=>((a,b,c)=>b in a?fi(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class fk{constructor(a,c){this.core=a,this.logger=c,fj(this,"name","pairing"),fj(this,"version","0.3"),fj(this,"events",new b.default),fj(this,"pairings"),fj(this,"initialized",!1),fj(this,"storagePrefix",c6),fj(this,"ignoredPayloadTypes",[1]),fj(this,"registeredMethods",[]),fj(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),fj(this,"register",({methods:a})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...a])]}),fj(this,"create",async a=>{this.isInitialized();let b=cG(),c=await this.core.crypto.setSymKey(b),d=ah(v.FIVE_MINUTES),e={protocol:dc},f={topic:c,expiry:d,relay:e,active:!1,methods:a?.methods},g=cT({protocol:this.core.protocol,version:this.core.version,topic:c,symKey:b,relay:e,expiryTimestamp:d,methods:a?.methods});return this.events.emit(dm.create,f),this.core.expirer.set(c,d),await this.pairings.set(c,f),await this.core.relayer.subscribe(c,{transportType:a?.transportType}),{topic:c,uri:g}}),fj(this,"pair",async a=>{let b;this.isInitialized();let c=this.core.eventClient.createEvent({properties:{topic:a?.uri,trace:[du.pairing_started]}});this.isValidPair(a,c);let{topic:d,symKey:e,relay:f,expiryTimestamp:g,methods:h}=cS(a.uri);if(c.props.properties.topic=d,c.addTrace(du.pairing_uri_validation_success),c.addTrace(du.pairing_uri_not_expired),this.pairings.keys.includes(d)){if(b=this.pairings.get(d),c.addTrace(du.existing_pairing),b.active)throw c.setError(dv.active_pairing_already_exists),Error(`Pairing already exists: ${d}. Please try again with a new connection URI.`);c.addTrace(du.pairing_not_expired)}let i=g||ah(v.FIVE_MINUTES),j={topic:d,relay:f,expiry:i,active:!1,methods:h};this.core.expirer.set(d,i),await this.pairings.set(d,j),c.addTrace(du.store_new_pairing),a.activatePairing&&await this.activate({topic:d}),this.events.emit(dm.create,j),c.addTrace(du.emit_inactive_pairing),this.core.crypto.keychain.has(d)||await this.core.crypto.setSymKey(e,d),c.addTrace(du.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{c.setError(dv.no_internet_connection)}try{await this.core.relayer.subscribe(d,{relay:f})}catch(a){throw c.setError(dv.subscribe_pairing_topic_failure),a}return c.addTrace(du.subscribe_pairing_topic_success),j}),fj(this,"activate",async({topic:a})=>{this.isInitialized();let b=ah(v.FIVE_MINUTES);this.core.expirer.set(a,b),await this.pairings.update(a,{active:!0,expiry:b})}),fj(this,"ping",async a=>{this.isInitialized(),await this.isValidPing(a),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:b}=a;if(this.pairings.keys.includes(b)){let a=await this.sendRequest(b,"wc_pairingPing",{}),{done:c,resolve:d,reject:e}=function(a=v.FIVE_MINUTES,b){let c,d,e,f,g=(0,v.toMiliseconds)(a||v.FIVE_MINUTES);return{resolve:a=>{e&&c&&(clearTimeout(e),c(a),f=Promise.resolve(a))},reject:a=>{e&&d&&(clearTimeout(e),d(a))},done:()=>new Promise((a,b)=>{if(f)return a(f);e=setTimeout(()=>{let a=Error(void 0);f=Promise.reject(a),b(a)},g),c=a,d=b})}}();this.events.once(aj("pairing_ping",a),({error:a})=>{a?e(a):d()}),await c()}}),fj(this,"updateExpiry",async({topic:a,expiry:b})=>{this.isInitialized(),await this.pairings.update(a,{expiry:b})}),fj(this,"updateMetadata",async({topic:a,metadata:b})=>{this.isInitialized(),await this.pairings.update(a,{peerMetadata:b})}),fj(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),fj(this,"disconnect",async a=>{this.isInitialized(),await this.isValidDisconnect(a);let{topic:b}=a;this.pairings.keys.includes(b)&&(await this.sendRequest(b,"wc_pairingDelete",cX("USER_DISCONNECTED")),await this.deletePairing(b))}),fj(this,"formatUriFromPairing",a=>{this.isInitialized();let{topic:b,relay:c,expiry:d,methods:e}=a,f=this.core.crypto.keychain.get(b);return cT({protocol:this.core.protocol,version:this.core.version,topic:b,symKey:f,relay:c,expiryTimestamp:d,methods:e})}),fj(this,"sendRequest",async(a,b,c)=>{let d=(0,c2.formatJsonRpcRequest)(b,c),e=await this.core.crypto.encode(a,d),f=dl[b].req;return this.core.history.set(a,d),this.core.relayer.publish(a,e,f),d.id}),fj(this,"sendResult",async(a,b,c)=>{let d=(0,c2.formatJsonRpcResult)(a,c),e=await this.core.crypto.encode(b,d),f=dl[(await this.core.history.get(b,a)).request.method].res;await this.core.relayer.publish(b,e,f),await this.core.history.resolve(d)}),fj(this,"sendError",async(a,b,c)=>{let d=(0,c2.formatJsonRpcError)(a,c),e=await this.core.crypto.encode(b,d),f=(await this.core.history.get(b,a)).request.method,g=dl[f]?dl[f].res:dl.unregistered_method.res;await this.core.relayer.publish(b,e,g),await this.core.history.resolve(d)}),fj(this,"deletePairing",async(a,b)=>{await this.core.relayer.unsubscribe(a),await Promise.all([this.pairings.delete(a,cX("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(a),b?Promise.resolve():this.core.expirer.del(a)])}),fj(this,"cleanup",async()=>{let a=this.pairings.getAll().filter(a=>ai(a.expiry));await Promise.all(a.map(a=>this.deletePairing(a.topic)))}),fj(this,"onRelayEventRequest",async a=>{let{topic:b,payload:c}=a;switch(c.method){case"wc_pairingPing":return await this.onPairingPingRequest(b,c);case"wc_pairingDelete":return await this.onPairingDeleteRequest(b,c);default:return await this.onUnknownRpcMethodRequest(b,c)}}),fj(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c}=a,d=(await this.core.history.get(b,c.id)).request.method;return"wc_pairingPing"===d?this.onPairingPingResponse(b,c):this.onUnknownRpcMethodResponse(d)}),fj(this,"onPairingPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult(c,a,!0),this.events.emit(dm.ping,{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),fj(this,"onPairingPingResponse",(a,b)=>{let{id:c}=b;setTimeout(()=>{(0,c3.isJsonRpcResult)(b)?this.events.emit(aj("pairing_ping",c),{}):(0,c3.isJsonRpcError)(b)&&this.events.emit(aj("pairing_ping",c),{error:b.error})},500)}),fj(this,"onPairingDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a}),await this.deletePairing(a),this.events.emit(dm.delete,{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),fj(this,"onUnknownRpcMethodRequest",async(a,b)=>{let{id:c,method:d}=b;try{if(this.registeredMethods.includes(d))return;let b=cX("WC_METHOD_UNSUPPORTED",d);await this.sendError(c,a,b),this.logger.error(b)}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),fj(this,"onUnknownRpcMethodResponse",a=>{this.registeredMethods.includes(a)||this.logger.error(cX("WC_METHOD_UNSUPPORTED",a))}),fj(this,"isValidPair",(a,b)=>{var c;if(!c$(a)){let{message:c}=cW("MISSING_OR_INVALID",`pair() params: ${a}`);throw b.setError(dv.malformed_pairing_uri),Error(c)}if(!function(a){function b(a){try{return"u">typeof new URL(a)}catch{return!1}}try{if(cZ(a,!1)){if(b(a))return!0;let c=am(a);return b(c)}}catch{}return!1}(a.uri)){let{message:c}=cW("MISSING_OR_INVALID",`pair() uri: ${a.uri}`);throw b.setError(dv.malformed_pairing_uri),Error(c)}let d=cS(a?.uri);if(!(null!=(c=d?.relay)&&c.protocol)){let{message:a}=cW("MISSING_OR_INVALID","pair() uri#relay-protocol");throw b.setError(dv.malformed_pairing_uri),Error(a)}if(!(null!=d&&d.symKey)){let{message:a}=cW("MISSING_OR_INVALID","pair() uri#symKey");throw b.setError(dv.malformed_pairing_uri),Error(a)}if(null!=d&&d.expiryTimestamp&&(0,v.toMiliseconds)(d?.expiryTimestamp)<Date.now()){b.setError(dv.pairing_expired);let{message:a}=cW("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw Error(a)}}),fj(this,"isValidPing",async a=>{if(!c$(a)){let{message:b}=cW("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),fj(this,"isValidDisconnect",async a=>{if(!c$(a)){let{message:b}=cW("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),fj(this,"isValidPairingTopic",async a=>{if(!cZ(a,!1)){let{message:b}=cW("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.pairings.keys.includes(a)){let{message:b}=cW("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(ai(this.pairings.get(a).expiry)){await this.deletePairing(a);let{message:b}=cW("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}),this.core=a,this.logger=(0,e.generateChildLogger)(c,this.name),this.pairings=new fh(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,e.getLoggerContext)(this.logger)}isInitialized(){if(!this.initialized){let{message:a}=cW("NOT_INITIALIZED",this.name);throw Error(a)}}registerRelayerEvents(){this.core.relayer.on(de.message,async a=>{let{topic:b,message:c,transportType:d}=a;if(this.pairings.keys.includes(b)&&d!==dh.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(c)))try{let a=await this.core.crypto.decode(b,c);(0,c3.isJsonRpcRequest)(a)?(this.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a})):(0,c3.isJsonRpcResponse)(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a}),this.core.history.delete(b,a.id)),await this.core.relayer.messages.ack(b,c)}catch(a){this.logger.error(a)}})}registerExpirerEvents(){this.core.expirer.on(dp.expired,async a=>{let{topic:b}=function(a){let[b,c]=a.split(":"),d={id:void 0,topic:void 0};if("topic"===b&&"string"==typeof c)d.topic=c;else if("id"===b&&Number.isInteger(Number(c)))d.id=Number(c);else throw Error(`Invalid target, expected id:number or topic:string, got ${b}:${c}`);return d}(a.target);b&&this.pairings.keys.includes(b)&&(await this.deletePairing(b,!0),this.events.emit(dm.expire,{topic:b}))})}}var fl=Object.defineProperty,fm=(a,b,c)=>((a,b,c)=>b in a?fl(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class fn extends l{constructor(a,c){super(a,c),this.core=a,this.logger=c,fm(this,"records",new Map),fm(this,"events",new b.EventEmitter),fm(this,"name","history"),fm(this,"version","0.3"),fm(this,"cached",[]),fm(this,"initialized",!1),fm(this,"storagePrefix",c6),fm(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.records.set(a.id,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),fm(this,"set",(a,b,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:a,request:b,chainId:c}),this.records.has(b.id))return;let d={id:b.id,topic:a,request:{method:b.method,params:b.params||null},chainId:c,expiry:ah(v.THIRTY_DAYS)};this.records.set(d.id,d),this.persist(),this.events.emit(dn.created,d)}),fm(this,"resolve",async a=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:a}),!this.records.has(a.id))return;let b=await this.getRecord(a.id);typeof b.response>"u"&&(b.response=(0,c3.isJsonRpcError)(a)?{error:a.error}:{result:a.result},this.records.set(b.id,b),this.persist(),this.events.emit(dn.updated,b))}),fm(this,"get",async(a,b)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:a,id:b}),await this.getRecord(b))),fm(this,"delete",(a,b)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:b}),this.values.forEach(c=>{c.topic===a&&("u">typeof b&&c.id!==b||(this.records.delete(c.id),this.events.emit(dn.deleted,c)))}),this.persist()}),fm(this,"exists",async(a,b)=>(this.isInitialized(),!!this.records.has(b)&&(await this.getRecord(b)).topic===a)),fm(this,"on",(a,b)=>{this.events.on(a,b)}),fm(this,"once",(a,b)=>{this.events.once(a,b)}),fm(this,"off",(a,b)=>{this.events.off(a,b)}),fm(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=(0,e.generateChildLogger)(c,this.name)}get context(){return(0,e.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let a=[];return this.values.forEach(b=>{if("u">typeof b.response)return;let c={topic:b.topic,request:(0,c2.formatJsonRpcRequest)(b.request.method,b.request.params,b.id),chainId:b.chainId};return a.push(c)}),a}async setJsonRpcRecords(a){await this.core.storage.setItem(this.storageKey,a)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(a){this.isInitialized();let b=this.records.get(a);if(!b){let{message:b}=cW("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(dn.sync)}async restore(){try{let a=await this.getJsonRpcRecords();if(typeof a>"u"||!a.length)return;if(this.records.size){let{message:a}=cW("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}}registerEventListeners(){this.events.on(dn.created,a=>{let b=dn.created;this.logger.info(`Emitting ${b}`),this.logger.debug({type:"event",event:b,record:a})}),this.events.on(dn.updated,a=>{let b=dn.updated;this.logger.info(`Emitting ${b}`),this.logger.debug({type:"event",event:b,record:a})}),this.events.on(dn.deleted,a=>{let b=dn.deleted;this.logger.info(`Emitting ${b}`),this.logger.debug({type:"event",event:b,record:a})}),this.core.heartbeat.on(c.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let a=!1;this.records.forEach(b=>{(0,v.toMiliseconds)(b.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${b.id}`),this.records.delete(b.id),this.events.emit(dn.deleted,b,!1),a=!0)}),a&&this.persist()}catch(a){this.logger.warn(a)}}isInitialized(){if(!this.initialized){let{message:a}=cW("NOT_INITIALIZED",this.name);throw Error(a)}}}var fo=Object.defineProperty,fp=(a,b,c)=>((a,b,c)=>b in a?fo(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class fq extends r{constructor(a,c){super(a,c),this.core=a,this.logger=c,fp(this,"expirations",new Map),fp(this,"events",new b.EventEmitter),fp(this,"name","expirer"),fp(this,"version","0.3"),fp(this,"cached",[]),fp(this,"initialized",!1),fp(this,"storagePrefix",c6),fp(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.expirations.set(a.target,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),fp(this,"has",a=>{try{let b=this.formatTarget(a);return"u">typeof this.getExpiration(b)}catch{return!1}}),fp(this,"set",(a,b)=>{this.isInitialized();let c=this.formatTarget(a),d={target:c,expiry:b};this.expirations.set(c,d),this.checkExpiry(c,d),this.events.emit(dp.created,{target:c,expiration:d})}),fp(this,"get",a=>{this.isInitialized();let b=this.formatTarget(a);return this.getExpiration(b)}),fp(this,"del",a=>{if(this.isInitialized(),this.has(a)){let b=this.formatTarget(a),c=this.getExpiration(b);this.expirations.delete(b),this.events.emit(dp.deleted,{target:b,expiration:c})}}),fp(this,"on",(a,b)=>{this.events.on(a,b)}),fp(this,"once",(a,b)=>{this.events.once(a,b)}),fp(this,"off",(a,b)=>{this.events.off(a,b)}),fp(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=(0,e.generateChildLogger)(c,this.name)}get context(){return(0,e.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(a){if("string"==typeof a)return ag("topic",a);if("number"==typeof a)return ag("id",a);let{message:b}=cW("UNKNOWN_TYPE",`Target type: ${typeof a}`);throw Error(b)}async setExpirations(a){await this.core.storage.setItem(this.storageKey,a)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(dp.sync)}async restore(){try{let a=await this.getExpirations();if(typeof a>"u"||!a.length)return;if(this.expirations.size){let{message:a}=cW("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(a){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(a)}}getExpiration(a){let b=this.expirations.get(a);if(!b){let{message:b}=cW("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.warn(b),Error(b)}return b}checkExpiry(a,b){let{expiry:c}=b;(0,v.toMiliseconds)(c)-Date.now()<=0&&this.expire(a,b)}expire(a,b){this.expirations.delete(a),this.events.emit(dp.expired,{target:a,expiration:b})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((a,b)=>this.checkExpiry(b,a))}registerEventListeners(){this.core.heartbeat.on(c.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(dp.created,a=>{let b=dp.created;this.logger.info(`Emitting ${b}`),this.logger.debug({type:"event",event:b,data:a}),this.persist()}),this.events.on(dp.expired,a=>{let b=dp.expired;this.logger.info(`Emitting ${b}`),this.logger.debug({type:"event",event:b,data:a}),this.persist()}),this.events.on(dp.deleted,a=>{let b=dp.deleted;this.logger.info(`Emitting ${b}`),this.logger.debug({type:"event",event:b,data:a}),this.persist()})}isInitialized(){if(!this.initialized){let{message:a}=cW("NOT_INITIALIZED",this.name);throw Error(a)}}}var fr=Object.defineProperty,fs=(a,b,c)=>((a,b,c)=>b in a?fr(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class ft extends s{constructor(a,b,c){super(a,b,c),this.core=a,this.logger=b,this.store=c,fs(this,"name","verify-api"),fs(this,"abortController"),fs(this,"isDevEnv"),fs(this,"verifyUrlV3",ds),fs(this,"storagePrefix",c6),fs(this,"version",2),fs(this,"publicKey"),fs(this,"fetchPromise"),fs(this,"init",async()=>{var a;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,v.toMiliseconds)(null==(a=this.publicKey)?void 0:a.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),fs(this,"register",async a=>{if(!_()||this.isDevEnv)return;let b=window.location.origin,{id:c,decryptedId:d}=a,e=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${b}&id=${c}&decryptedId=${d}`;try{let a=(0,z.getDocument)(),b=this.startAbortTimer(5*v.ONE_SECOND),d=await new Promise((d,f)=>{let g=()=>{window.removeEventListener("message",i),a.body.removeChild(h),f("attestation aborted")};this.abortController.signal.addEventListener("abort",g);let h=a.createElement("iframe");h.src=e,h.style.display="none",h.addEventListener("error",g,{signal:this.abortController.signal});let i=e=>{if(e.data&&"string"==typeof e.data)try{let f=JSON.parse(e.data);if("verify_attestation"===f.type){if((0,x.decodeJWT)(f.attestation).payload.id!==c)return;clearInterval(b),a.body.removeChild(h),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",i),d(null===f.attestation?"":f.attestation)}}catch(a){this.logger.warn(a)}};a.body.appendChild(h),window.addEventListener("message",i,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",d),d}catch(a){this.logger.warn(a)}return""}),fs(this,"resolve",async a=>{if(this.isDevEnv)return"";let{attestationId:b,hash:c,encryptedId:d}=a;if(""===b)return void this.logger.debug("resolve: attestationId is empty, skipping");if(b){if((0,x.decodeJWT)(b).payload.id!==d)return;let a=await this.isValidJwtAttestation(b);if(a)return a.isVerified?a:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!c)return;let e=this.getVerifyUrl(a?.verifyUrl);return this.fetchAttestation(c,e)}),fs(this,"fetchAttestation",async(a,b)=>{this.logger.debug(`resolving attestation: ${a} from url: ${b}`);let c=this.startAbortTimer(5*v.ONE_SECOND),d=await fetch(`${b}/attestation/${a}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(c),200===d.status?await d.json():void 0}),fs(this,"getVerifyUrl",a=>{let b=a||dr;return dt.includes(b)||(this.logger.info(`verify url: ${b}, not included in trusted list, assigning default: ${dr}`),b=dr),b}),fs(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let a=this.startAbortTimer(v.FIVE_SECONDS),b=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(a),await b.json()}catch(a){this.logger.warn(a)}}),fs(this,"persistPublicKey",async a=>{this.logger.debug("persisting public key to local storage",a),await this.store.setItem(this.storeKey,a),this.publicKey=a}),fs(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),fs(this,"isValidJwtAttestation",async a=>{let b=await this.getPublicKey();try{if(b)return this.validateAttestation(a,b)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let c=await this.fetchAndPersistPublicKey();try{if(c)return this.validateAttestation(a,c)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),fs(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),fs(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async a=>{let b=await this.fetchPublicKey();b&&(await this.persistPublicKey(b),a(b))});let a=await this.fetchPromise;return this.fetchPromise=void 0,a}),fs(this,"validateAttestation",(a,b)=>{let c=function(a,b){let[c,d,e]=a.split("."),f=Buffer.from(cL(e),"base64");if(64!==f.length)throw Error("Invalid signature length");let g=f.slice(0,32),h=f.slice(32,64),i=br(`${c}.${d}`),j=function(a){let b=Buffer.from(a.x,"base64"),c=Buffer.from(a.y,"base64");return(0,W.concat)([new Uint8Array([4]),b,c])}(b);if(!cA.verify((0,W.concat)([g,h]),i,j))throw Error("Invalid signature");return(0,x.decodeJWT)(a).payload}(a,b.publicKey),d={hasExpired:(0,v.toMiliseconds)(c.exp)<Date.now(),payload:c};if(d.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),Error("JWT attestation expired");return{origin:d.payload.origin,isScam:d.payload.isScam,isVerified:d.payload.isVerified}}),this.logger=(0,e.generateChildLogger)(b,this.name),this.abortController=new AbortController,this.isDevEnv=al(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return(0,e.getLoggerContext)(this.logger)}startAbortTimer(a){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,v.toMiliseconds)(a))}}var fu=Object.defineProperty,fv=(a,b,c)=>((a,b,c)=>b in a?fu(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class fw extends t{constructor(a,b){super(a,b),this.projectId=a,this.logger=b,fv(this,"context","echo"),fv(this,"registerDeviceToken",async a=>{let{clientId:b,token:c,notificationType:d,enableEncrypted:e=!1}=a,f=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:b,type:d,token:c,always_raw:e})})}),this.logger=(0,e.generateChildLogger)(b,this.context)}}var fx=Object.defineProperty,fy=Object.getOwnPropertySymbols,fz=Object.prototype.hasOwnProperty,fA=Object.prototype.propertyIsEnumerable,fB=(a,b,c)=>b in a?fx(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,fC=(a,b)=>{for(var c in b||(b={}))fz.call(b,c)&&fB(a,c,b[c]);if(fy)for(var c of fy(b))fA.call(b,c)&&fB(a,c,b[c]);return a},fD=(a,b,c)=>fB(a,"symbol"!=typeof b?b+"":b,c);class fE extends u{constructor(a,b,d=!0){super(a,b,d),this.core=a,this.logger=b,fD(this,"context","event-client"),fD(this,"storagePrefix",c6),fD(this,"storageVersion",.1),fD(this,"events",new Map),fD(this,"shouldPersist",!1),fD(this,"init",async()=>{if(!al())try{let a={eventId:ak(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:ac(this.core.relayer.protocol,this.core.relayer.version,dg)}}};await this.sendEvent([a])}catch(a){this.logger.warn(a)}}),fD(this,"createEvent",a=>{let{event:b="ERROR",type:c="",properties:{topic:d,trace:e}}=a,f=ak(),g=this.core.projectId||"",h=fC({eventId:f,timestamp:Date.now(),props:{event:b,type:c,properties:{topic:d,trace:e}},bundleId:g,domain:this.getAppDomain()},this.setMethods(f));return this.telemetryEnabled&&(this.events.set(f,h),this.shouldPersist=!0),h}),fD(this,"getEvent",a=>{let{eventId:b,topic:c}=a;if(b)return this.events.get(b);let d=Array.from(this.events.values()).find(a=>a.props.properties.topic===c);if(d)return fC(fC({},d),this.setMethods(d.eventId))}),fD(this,"deleteEvent",a=>{let{eventId:b}=a;this.events.delete(b),this.shouldPersist=!0}),fD(this,"setEventListeners",()=>{this.core.heartbeat.on(c.HEARTBEAT_EVENTS.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(a=>{(0,v.fromMiliseconds)(Date.now())-(0,v.fromMiliseconds)(a.timestamp)>86400&&(this.events.delete(a.eventId),this.shouldPersist=!0)})})}),fD(this,"setMethods",a=>({addTrace:b=>this.addTrace(a,b),setError:b=>this.setError(a,b)})),fD(this,"addTrace",(a,b)=>{let c=this.events.get(a);c&&(c.props.properties.trace.push(b),this.events.set(a,c),this.shouldPersist=!0)}),fD(this,"setError",(a,b)=>{let c=this.events.get(a);c&&(c.props.type=b,c.timestamp=Date.now(),this.events.set(a,c),this.shouldPersist=!0)}),fD(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),fD(this,"restore",async()=>{try{let a=await this.core.storage.getItem(this.storageKey)||[];if(!a.length)return;a.forEach(a=>{this.events.set(a.eventId,fC(fC({},a),this.setMethods(a.eventId)))})}catch(a){this.logger.warn(a)}}),fD(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;let a=[];for(let[b,c]of this.events)c.props.type&&a.push(c);if(0!==a.length)try{if((await this.sendEvent(a)).ok)for(let b of a)this.events.delete(b.eventId),this.shouldPersist=!0}catch(a){this.logger.warn(a)}}),fD(this,"sendEvent",async a=>{let b=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${dg}${b}`,{method:"POST",body:JSON.stringify(a)})}),fD(this,"getAppDomain",()=>((0,A.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}).url),this.logger=(0,e.generateChildLogger)(b,this.context),this.telemetryEnabled=d,d?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var fF=Object.defineProperty,fG=Object.getOwnPropertySymbols,fH=Object.prototype.hasOwnProperty,fI=Object.prototype.propertyIsEnumerable,fJ=(a,b,c)=>b in a?fF(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,fK=(a,b)=>{for(var c in b||(b={}))fH.call(b,c)&&fJ(a,c,b[c]);if(fG)for(var c of fG(b))fI.call(b,c)&&fJ(a,c,b[c]);return a},fL=(a,b,c)=>fJ(a,"symbol"!=typeof b?b+"":b,c);class fM extends j{constructor(a){var f;super(a),fL(this,"protocol","wc"),fL(this,"version",2),fL(this,"name",c5),fL(this,"relayUrl"),fL(this,"projectId"),fL(this,"customStoragePrefix"),fL(this,"events",new b.EventEmitter),fL(this,"logger"),fL(this,"heartbeat"),fL(this,"relayer"),fL(this,"crypto"),fL(this,"storage"),fL(this,"history"),fL(this,"expirer"),fL(this,"pairing"),fL(this,"verify"),fL(this,"echoClient"),fL(this,"linkModeSupportedApps"),fL(this,"eventClient"),fL(this,"initialized",!1),fL(this,"logChunkController"),fL(this,"on",(a,b)=>this.events.on(a,b)),fL(this,"once",(a,b)=>this.events.once(a,b)),fL(this,"off",(a,b)=>this.events.off(a,b)),fL(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),fL(this,"dispatchEnvelope",({topic:a,message:b,sessionExists:c})=>{if(!a||!b)return;let d={topic:a,message:b,publishedAt:Date.now(),transportType:dh.link_mode};this.relayer.onLinkMessageEvent(d,{sessionExists:c})});let g=this.getGlobalCore(a?.customStoragePrefix);if(g)try{return this.customStoragePrefix=g.customStoragePrefix,this.logger=g.logger,this.heartbeat=g.heartbeat,this.crypto=g.crypto,this.history=g.history,this.expirer=g.expirer,this.storage=g.storage,this.relayer=g.relayer,this.pairing=g.pairing,this.verify=g.verify,this.echoClient=g.echoClient,this.linkModeSupportedApps=g.linkModeSupportedApps,this.eventClient=g.eventClient,this.initialized=g.initialized,this.logChunkController=g.logChunkController,g}catch(a){console.warn("Failed to copy global core",a)}this.projectId=a?.projectId,this.relayUrl=a?.relayUrl||dd,this.customStoragePrefix=null!=a&&a.customStoragePrefix?`:${a.customStoragePrefix}`:"";let h=(0,e.getDefaultLoggerOptions)({level:"string"==typeof a?.logger&&a.logger?a.logger:c7.logger,name:c5}),{logger:i,chunkLoggerController:j}=(0,e.generatePlatformLogger)({opts:h,maxSizeInBytes:a?.maxLogBlobSizeInBytes,loggerOverride:a?.logger});this.logChunkController=j,null!=(f=this.logChunkController)&&f.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,b;null!=(a=this.logChunkController)&&a.downloadLogsBlobInBrowser&&(null==(b=this.logChunkController)||b.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=(0,e.generateChildLogger)(i,this.name),this.heartbeat=new c.HeartBeat,this.crypto=new ep(this,this.logger,a?.keychain),this.history=new fn(this,this.logger),this.expirer=new fq(this,this.logger),this.storage=null!=a&&a.storage?a.storage:new d.default(fK(fK({},c8),a?.storageOptions)),this.relayer=new e3({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new fk(this,this.logger),this.verify=new ft(this,this.logger,this.storage),this.echoClient=new fw(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new fE(this,this.logger,a?.telemetryEnabled),this.setGlobalCore(this)}static async init(a){let b=new fM(a);await b.initialize();let c=await b.crypto.getClientId();return await b.storage.setItem("WALLETCONNECT_CLIENT_ID",c),b}get context(){return(0,e.getLoggerContext)(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var a;return null==(a=this.logChunkController)?void 0:a.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(a){this.linkModeSupportedApps.includes(a)||(this.linkModeSupportedApps.push(a),await this.storage.setItem(dj,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(dj)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(a){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,a),this.logger.error(a.message),a}}getGlobalCore(a=""){try{if(this.isGlobalCoreDisabled())return;let b=`_walletConnectCore_${a}`,c=`${b}_count`;return globalThis[c]=(globalThis[c]||0)+1,globalThis[c]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[c]} times.`),globalThis[b]}catch(a){console.warn("Failed to get global WalletConnect core",a);return}}setGlobalCore(a){var b;try{if(this.isGlobalCoreDisabled())return;let c=`_walletConnectCore_${(null==(b=a.opts)?void 0:b.customStoragePrefix)||""}`;globalThis[c]=a}catch(a){console.warn("Failed to set global WalletConnect core",a)}}isGlobalCoreDisabled(){try{return"u">typeof process&&"true"===process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}let fN=fM;function fO(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function fP(a,...b){if(!(a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function fQ(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function fR(a,b){fP(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}g.IEvents,g.IEvents,g.IEvents,g.IEvents,g.IEvents,g.IEvents,b.default,b.EventEmitter,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;let fS=BigInt(0x100000000-1),fT=BigInt(32),fU="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function fV(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function fW(a,b){return a<<32-b|a>>>b}let fX=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function fY(a){for(let c=0;c<a.length;c++){var b;a[c]=(b=a[c])<<24&0xff000000|b<<8&0xff0000|b>>>8&65280|b>>>24&255}}function fZ(a){return"string"==typeof a&&(a=function(a){if("string"!=typeof a)throw Error("utf8ToBytes expected string, got "+typeof a);return new Uint8Array(new TextEncoder().encode(a))}(a)),fP(a),a}class f${clone(){return this._cloneInto()}}function f_(a){let b=b=>a().update(fZ(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function f0(a=32){if(fU&&"function"==typeof fU.getRandomValues)return fU.getRandomValues(new Uint8Array(a));if(fU&&"function"==typeof fU.randomBytes)return fU.randomBytes(a);throw Error("crypto.getRandomValues must be defined")}let f1=[],f2=[],f3=[],f4=BigInt(0),f5=BigInt(1),f6=BigInt(2),f7=BigInt(7),f8=BigInt(256),f9=BigInt(113);for(let a=0,b=f5,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],f1.push(2*(5*d+c)),f2.push((a+1)*(a+2)/2%64);let e=f4;for(let a=0;a<7;a++)(b=(b<<f5^(b>>f7)*f9)%f8)&f6&&(e^=f5<<(f5<<BigInt(a))-f5);f3.push(e)}let[ga,gb]=function(a,b=!1){let c=new Uint32Array(a.length),d=new Uint32Array(a.length);for(let e=0;e<a.length;e++){let{h:f,l:g}=function(a,b=!1){return b?{h:Number(a&fS),l:Number(a>>fT&fS)}:{h:0|Number(a>>fT&fS),l:0|Number(a&fS)}}(a[e],b);[c[e],d[e]]=[f,g]}return[c,d]}(f3,!0),gc=(a,b,c)=>c>32?((a,b,c)=>b<<c-32|a>>>64-c)(a,b,c):((a,b,c)=>a<<c|b>>>32-c)(a,b,c),gd=(a,b,c)=>c>32?((a,b,c)=>a<<c-32|b>>>64-c)(a,b,c):((a,b,c)=>b<<c|a>>>32-c)(a,b,c);class ge extends f${constructor(a,b,c,d=!1,e=24){if(super(),this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,fO(c),0>=this.blockLen||this.blockLen>=200)throw Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=function(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}(this.state)}keccak(){fX||fY(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=gc(f,g,1)^c[d],i=gd(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=f2[c],f=gc(b,e,d),g=gd(b,e,d),h=f1[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=ga[d],a[1]^=gb[d]}c.fill(0)}(this.state32,this.rounds),fX||fY(this.state32),this.posOut=0,this.pos=0}update(a){fQ(this);let{blockLen:b,state:c}=this,d=(a=fZ(a)).length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){fQ(this,!1),fP(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return fO(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(fR(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new ge(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}function gf(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function gg(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function gh(a,...b){if(!gg(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function gi(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function gj(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}f_(()=>new ge(136,1,32)),Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;let gk=a=>new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4));if(68!==new Uint8Array(new Uint32Array([0x11223344]).buffer)[0])throw Error("Non little-endian hardware is not supported");function gl(a){if("string"==typeof a)a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a);else if(gg(a))a=go(a);else throw Error("Uint8Array expected, got "+typeof a);return a}function gm(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error("invalid output length, expected "+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function gn(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function go(a){return Uint8Array.from(a)}function gp(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let gq=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),gr=gq("expand 16-byte k"),gs=gq("expand 32-byte k"),gt=gk(gr),gu=gk(gs);function gv(a,b){return a<<b|a>>>32-b}function gw(a){return a.byteOffset%4==0}let gx=0x100000000-1,gy=new Uint32Array,gz=(a,b)=>255&a[b++]|(255&a[b++])<<8;class gA{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,gh(a=gl(a),32);let b=gz(a,0),c=gz(a,2),d=gz(a,4),e=gz(a,6),f=gz(a,8),g=gz(a,10),h=gz(a,12),i=gz(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=gz(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=gz(a,b+0),q=gz(a,b+2),r=gz(a,b+4),s=gz(a,b+6),t=gz(a,b+8),u=gz(a,b+10),v=gz(a,b+12),w=gz(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;gp(c)}update(a){gi(this);let{buffer:b,blockLen:c}=this,d=(a=gl(a)).length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){gp(this.h,this.r,this.buffer,this.pad)}digestInto(a){gi(this),function(a,b){gh(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,h:c}=this,{pos:d}=this;if(d){for(b[d++]=1;d<16;d++)b[d]=0;this.process(b,0,!0)}this.finalize();let e=0;for(let b=0;b<8;b++)a[e++]=c[b]>>>0,a[e++]=c[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let gB=function(a){let b=(b,c)=>a(c).update(gl(b)).digest(),c=a(new Uint8Array(32));return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=b=>a(b),b}(a=>new gA(a)),gC=function(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return gf(e),gf(g),gj(f),gj(c),(b,h,i,j,k=0)=>{gh(b),gh(h),gh(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),gh(j),gf(k),k<0||k>=gx)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],n=b.length,o,p;if(32===n)m.push(o=go(b)),p=gu;else if(16===n&&c)(o=new Uint8Array(32)).set(b),o.set(b,16),p=gt,m.push(o);else throw Error(`arx: invalid 32-byte key, got length=${n}`);gw(h)||m.push(h=go(h));let q=gk(o);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(p,q,gk(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=gk(j),l=gw(e)&&gw(f),m=l?gk(e):gy,n=l?gk(f):gy;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=gx)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,p,q,gk(h),i,j,k,g),gp(...m),j}}(function(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=gv(H^(v=v+z|0),16))|0,v=v+(z=gv(z^D,12))|0,D=D+(H=gv(H^v,8))|0,z=gv(z^D,7),E=E+(I=gv(I^(w=w+A|0),16))|0,w=w+(A=gv(A^E,12))|0,E=E+(I=gv(I^w,8))|0,A=gv(A^E,7),F=F+(J=gv(J^(x=x+B|0),16))|0,x=x+(B=gv(B^F,12))|0,F=F+(J=gv(J^x,8))|0,B=gv(B^F,7),G=G+(K=gv(K^(y=y+C|0),16))|0,y=y+(C=gv(C^G,12))|0,G=G+(K=gv(K^y,8))|0,C=gv(C^G,7),F=F+(K=gv(K^(v=v+A|0),16))|0,v=v+(A=gv(A^F,12))|0,F=F+(K=gv(K^v,8))|0,A=gv(A^F,7),G=G+(H=gv(H^(w=w+B|0),16))|0,w=w+(B=gv(B^G,12))|0,G=G+(H=gv(H^w,8))|0,B=gv(B^G,7),D=D+(I=gv(I^(x=x+C|0),16))|0,x=x+(C=gv(C^D,12))|0,D=D+(I=gv(I^x,8))|0,C=gv(C^D,7),E=E+(J=gv(J^(y=y+z|0),16))|0,y=y+(z=gv(z^E,12))|0,E=E+(J=gv(J^y,8))|0,z=gv(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),gD=new Uint8Array(16),gE=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(gD.subarray(c))},gF=new Uint8Array(32);function gG(a,b,c,d,e){let f=a(b,c,gF),g=gB.create(f);e&&gE(g,e),gE(g,d);let h=new Uint8Array(16),i=new DataView(h.buffer,h.byteOffset,h.byteLength);gn(i,0,BigInt(e?e.length:0),!0),gn(i,8,BigInt(d.length),!0),g.update(h);let j=g.digest();return gp(f,h),j}((a,b)=>Object.assign(function(c,...d){if(gh(c),void 0!==a.nonceLength){let b=d[0];if(!b)throw Error("nonce / iv required");a.varSizeNonce?gh(b):gh(b,a.nonceLength)}let e=a.tagLength;e&&void 0!==d[1]&&gh(d[1]);let f=b(c,...d),g=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");gh(b)}},h=!1;return{encrypt(a,b){if(h)throw Error("cannot encrypt() twice with same key + nonce");return h=!0,gh(a),g(f.encrypt.length,b),f.encrypt(a,b)},decrypt(a,b){if(gh(a),e&&a.length<e)throw Error("invalid ciphertext length: smaller than tagLength="+e);return g(f.decrypt.length,b),f.decrypt(a,b)}}},a))({blockSize:64,nonceLength:12,tagLength:16},(a=>(b,c,d)=>({encrypt(e,f){let g=e.length;(f=gm(g+16,f,!1)).set(e);let h=f.subarray(0,-16);a(b,c,h,h,1);let i=gG(a,b,c,h,d);return f.set(i,g),gp(i),f},decrypt(e,f){f=gm(e.length-16,f,!1);let g=e.subarray(0,-16),h=e.subarray(-16),i=gG(a,b,c,g,d);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(h,i))throw Error("invalid tag");return f.set(e.subarray(0,-16)),a(b,c,f,f,1),gp(i),f}}))(gC));class gH extends f${constructor(a,b){super(),this.finished=!1,this.destroyed=!1,function(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.wrapConstructor");fO(a.outputLen),fO(a.blockLen)}(a);let c=fZ(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),e.fill(0)}update(a){return fQ(this),this.iHash.update(a),this}digestInto(a){fQ(this),fP(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let gI=(a,b,c)=>new gH(a,b).update(c).digest();gI.create=(a,b)=>new gH(a,b),new Uint8Array([0]),new Uint8Array;class gJ extends f${constructor(a,b,c,d){super(),this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(a),this.view=fV(this.buffer)}update(a){fQ(this);let{view:b,buffer:c,blockLen:d}=this,e=(a=fZ(a)).length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=fV(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){fQ(this),fR(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,this.buffer.subarray(f).fill(0),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=fV(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.length=d,a.pos=g,a.finished=e,a.destroyed=f,d%b&&a.buffer.set(c),a}}let gK=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),gL=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),gM=new Uint32Array(64);class gN extends gJ{constructor(){super(64,32,8,!1),this.A=0|gL[0],this.B=0|gL[1],this.C=0|gL[2],this.D=0|gL[3],this.E=0|gL[4],this.F=0|gL[5],this.G=0|gL[6],this.H=0|gL[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)gM[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=gM[a-15],c=gM[a-2],d=fW(b,7)^fW(b,18)^b>>>3,e=fW(c,17)^fW(c,19)^c>>>10;gM[a]=e+gM[a-7]+d+gM[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(fW(g,6)^fW(g,11)^fW(g,25))+((k=g)&h^~k&i)+gK[a]+gM[a]|0,o=(fW(c,2)^fW(c,13)^fW(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){gM.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}let gO=f_(()=>new gN),gP=BigInt(0),gQ=BigInt(1),gR=BigInt(2);function gS(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function gT(a){if(!gS(a))throw Error("Uint8Array expected")}function gU(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}let gV=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function gW(a){gT(a);let b="";for(let c=0;c<a.length;c++)b+=gV[a[c]];return b}function gX(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function gY(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?gP:BigInt("0x"+a)}let gZ={_0:48,_9:57,A:65,F:70,a:97,f:102};function g$(a){return a>=gZ._0&&a<=gZ._9?a-gZ._0:a>=gZ.A&&a<=gZ.F?a-(gZ.A-10):a>=gZ.a&&a<=gZ.f?a-(gZ.a-10):void 0}function g_(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=g$(a.charCodeAt(e)),f=g$(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function g0(a){return gY(gW(a))}function g1(a){return gT(a),gY(gW(Uint8Array.from(a).reverse()))}function g2(a,b){return g_(a.toString(16).padStart(2*b,"0"))}function g3(a,b){return g2(a,b).reverse()}function g4(a,b,c){let d;if("string"==typeof b)try{d=g_(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(gS(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function g5(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];gT(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let g6=a=>"bigint"==typeof a&&gP<=a;function g7(a,b,c){return g6(a)&&g6(b)&&g6(c)&&b<=a&&a<c}function g8(a,b,c,d){if(!g7(b,c,d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}function g9(a){let b;for(b=0;a>gP;a>>=gQ,b+=1);return b}let ha=a=>(gR<<BigInt(a-1))-gQ,hb=a=>new Uint8Array(a),hc=a=>Uint8Array.from(a);function hd(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=hb(a),e=hb(a),f=0,g=()=>{d.fill(1),e.fill(0),f=0},h=(...a)=>c(e,d,...a),i=(a=hb())=>{e=h(hc([0]),a),d=h(),0!==a.length&&(e=h(hc([1]),a),d=h())},j=()=>{if(f++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(d=h()).slice();c.push(b),a+=d.length}return g5(...c)};return(a,b)=>{let c;for(g(),i(a);!(c=b(j()));)i();return g(),c}}let he={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||gS(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function hf(a,b,c={}){let d=(b,c,d)=>{let e=he[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if(!(d&&void 0===f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function hg(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}var hh=Object.freeze({__proto__:null,isBytes:gS,abytes:gT,abool:gU,bytesToHex:gW,numberToHexUnpadded:gX,hexToNumber:gY,hexToBytes:g_,bytesToNumberBE:g0,bytesToNumberLE:g1,numberToBytesBE:g2,numberToBytesLE:g3,numberToVarBytesBE:function(a){return g_(gX(a))},ensureBytes:g4,concatBytes:g5,equalBytes:function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c},utf8ToBytes:function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))},inRange:g7,aInRange:g8,bitLen:g9,bitGet:function(a,b){return a>>BigInt(b)&gQ},bitSet:function(a,b,c){return a|(c?gQ:gP)<<BigInt(b)},bitMask:ha,createHmacDrbg:hd,validateObject:hf,notImplemented:()=>{throw Error("not implemented")},memoized:hg});let hi=BigInt(0),hj=BigInt(1),hk=BigInt(2),hl=BigInt(3),hm=BigInt(4),hn=BigInt(5),ho=BigInt(8);function hp(a,b){let c=a%b;return c>=hi?c:b+c}function hq(a,b,c){if(b<hi)throw Error("invalid exponent, negatives unsupported");if(c<=hi)throw Error("invalid modulus");if(c===hj)return hi;let d=hj;for(;b>hi;)b&hj&&(d=d*a%c),a=a*a%c,b>>=hj;return d}function hr(a,b,c){let d=a;for(;b-- >hi;)d*=d,d%=c;return d}function hs(a,b){if(a===hi)throw Error("invert: expected non-zero number");if(b<=hi)throw Error("invert: expected positive modulus, got "+b);let c=hp(a,b),d=b,e=hi,f=hj;for(;c!==hi;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==hj)throw Error("invert: does not exist");return hp(e,b)}let ht=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function hu(a,b){let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function hv(a,b,c=!1,d={}){let e;if(a<=hi)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=hu(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:ha(f),ZERO:hi,ONE:hj,create:b=>hp(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return hi<=b&&b<a},is0:a=>a===hi,isOdd:a=>(a&hj)===hj,neg:b=>hp(-b,a),eql:(a,b)=>a===b,sqr:b=>hp(b*b,a),add:(b,c)=>hp(b+c,a),sub:(b,c)=>hp(b-c,a),mul:(b,c)=>hp(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<hi)throw Error("invalid exponent, negatives unsupported");if(c===hi)return a.ONE;if(c===hj)return b;let d=a.ONE,e=b;for(;c>hi;)c&hj&&(d=a.mul(d,e)),e=a.sqr(e),c>>=hj;return d})(h,a,b),div:(b,c)=>hp(b*hs(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>hs(b,a),sqrt:d.sqrt||(b=>(e||(e=function(a){if(a%hm===hl){let b=(a+hj)/hm;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}if(a%ho===hn){let b=(a-hn)/ho;return function(a,c){let d=a.mul(c,hk),e=a.pow(d,b),f=a.mul(c,e),g=a.mul(a.mul(f,hk),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),c))throw Error("Cannot find square root");return h}}return function(a){let b,c,d,e=(a-hj)/hk;for(b=a-hj,c=0;b%hk===hi;b/=hk,c++);for(d=hk;d<a&&hq(d,e,a)!==a-hj;d++)if(d>1e3)throw Error("Cannot find square root: likely non-prime P");if(1===c){let b=(a+hj)/hm;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}let f=(b+hj)/hk;return function(a,g){if(a.pow(g,e)===a.neg(a.ONE))throw Error("Cannot find square root");let h=c,i=a.pow(a.mul(a.ONE,d),b),j=a.pow(g,f),k=a.pow(g,b);for(;!a.eql(k,a.ONE);){if(a.eql(k,a.ZERO))return a.ZERO;let b=1;for(let c=a.sqr(k);b<h&&!a.eql(c,a.ONE);b++)c=a.sqr(c);let c=a.pow(i,hj<<BigInt(h-b-1));i=a.sqr(c),j=a.mul(j,c),k=a.mul(k,i),h=b}return j}}(a)}(a)),e(h,b))),invertBatch:a=>(function(a,b){let c=Array(b.length),d=b.reduce((b,d,e)=>a.is0(d)?b:(c[e]=b,a.mul(b,d)),a.ONE),e=a.inv(d);return b.reduceRight((b,d,e)=>a.is0(d)?b:(c[e]=a.mul(b,c[e]),a.mul(b,d)),e),c})(h,a),cmov:(a,b,c)=>c?b:a,toBytes:a=>c?g3(a,g):g2(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?g1(a):g0(a)}});return Object.freeze(h)}function hw(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function hx(a){let b=hw(a);return b+Math.ceil(b/2)}let hy=BigInt(0),hz=BigInt(1);function hA(a,b){let c=b.negate();return a?c:b}function hB(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function hC(a,b){return hB(a,b),{windows:Math.ceil(b/a)+1,windowSize:2**(a-1)}}let hD=new WeakMap,hE=new WeakMap;function hF(a){return hE.get(a)||1}function hG(a){return hf(a.Fp,ht.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),hf(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...hu(a.n,a.nBitLength),...a,p:a.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);let hH=BigInt(0),hI=BigInt(1),hJ=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);let hK=BigInt(1),hL=BigInt(2),hM=BigInt(3),hN=BigInt(5);function hO(a){void 0!==a.lowS&&gU("lowS",a.lowS),void 0!==a.prehash&&gU("prehash",a.prehash)}BigInt(8),!function(a){let b=(hf(a,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...a})),{P:c}=b,d=a=>hp(a,c),e=b.montgomeryBits,f=Math.ceil(e/8),g=b.nByteLength,h=b.adjustScalarBytes||(a=>a),i=b.powPminus2||(a=>hq(a,c-BigInt(2),c));(b.a-BigInt(2))/BigInt(4);g3(d(b.Gu),f)}({P:hJ,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:a=>{let{pow_p_5_8:b,b2:c}=function(a){let b=BigInt(10),c=BigInt(20),d=BigInt(40),e=BigInt(80),f=a*a%hJ*a%hJ,g=hr(f,hL,hJ)*f%hJ,h=hr(g,hK,hJ)*a%hJ,i=hr(h,hN,hJ)*h%hJ,j=hr(i,b,hJ)*i%hJ,k=hr(j,c,hJ)*j%hJ,l=hr(k,d,hJ)*k%hJ,m=hr(l,e,hJ)*l%hJ,n=hr(m,e,hJ)*l%hJ,o=hr(n,b,hJ)*i%hJ;return{pow_p_5_8:hr(o,hL,hJ)*a%hJ,b2:f}}(a);return hp(hr(b,hM,hJ)*c,hJ)},adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a},randomBytes:f0});let{bytesToNumberBE:hP,hexToBytes:hQ}=hh,hR={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=hR;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=gX(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?gX(e.length/2|128):"";return gX(a)+f+e+b},decode(a,b){let{Err:c}=hR,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=hR;if(a<hS)throw new b("integer: negative integers are not allowed");let c=gX(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=hR;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return hP(a)}},toSig(a){let{Err:b,_int:c,_tlv:d}=hR,e="string"==typeof a?hQ(a):a;gT(e);let{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=hR,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},hS=BigInt(0),hT=BigInt(1);BigInt(2);let hU=BigInt(3);BigInt(4);let hV=hv(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"));(function(a,b){let c=b=>(function(a){let b=function(a){let b=hG(a);return hf(b,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...b})}(a),{Fp:c,n:d}=b,e=c.BYTES+1,f=2*c.BYTES+1;function g(a){return hp(a,d)}let{ProjectivePoint:h,normPrivateKeyToScalar:i,weierstrassEquation:j,isWithinCurveOrder:k}=function(a){var b;let c=function(a){let b=hG(a);hf(b,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:c,Fp:d,a:e}=b;if(c){if(!d.eql(e,d.ZERO))throw Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof c||"bigint"!=typeof c.beta||"function"!=typeof c.splitScalar)throw Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...b})}(a),{Fp:d}=c,e=hv(c.n,c.nBitLength),f=c.toBytes||((a,b,c)=>{let e=b.toAffine();return g5(Uint8Array.from([4]),d.toBytes(e.x),d.toBytes(e.y))}),g=c.fromBytes||(a=>{let b=a.subarray(1);return{x:d.fromBytes(b.subarray(0,d.BYTES)),y:d.fromBytes(b.subarray(d.BYTES,2*d.BYTES))}});function h(a){let{a:b,b:e}=c,f=d.sqr(a),g=d.mul(f,a);return d.add(d.add(g,d.mul(a,b)),e)}if(!d.eql(d.sqr(c.Gy),h(c.Gx)))throw Error("bad generator point: equation left != right");function i(a){let b,{allowedPrivateKeyLengths:d,nByteLength:e,wrapPrivateKey:f,n:g}=c;if(d&&"bigint"!=typeof a){if(gS(a)&&(a=gW(a)),"string"!=typeof a||!d.includes(a.length))throw Error("invalid private key");a=a.padStart(2*e,"0")}try{b="bigint"==typeof a?a:g0(g4("private key",a,e))}catch{throw Error("invalid private key, expected hex or "+e+" bytes, got "+typeof a)}return f&&(b=hp(b,g)),g8("private key",b,hT,g),b}function j(a){if(!(a instanceof m))throw Error("ProjectivePoint expected")}let k=hg((a,b)=>{let{px:c,py:e,pz:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),l=hg(a=>{if(a.is0()){if(c.allowInfinityPoint&&!d.is0(a.py))return;throw Error("bad point: ZERO")}let{x:b,y:e}=a.toAffine();if(!d.isValid(b)||!d.isValid(e))throw Error("bad point: x or y not FE");let f=d.sqr(e),g=h(b);if(!d.eql(f,g))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class m{constructor(a,b,c){if(this.px=a,this.py=b,this.pz=c,null==a||!d.isValid(a))throw Error("x required");if(null==b||!d.isValid(b))throw Error("y required");if(null==c||!d.isValid(c))throw Error("z required");Object.freeze(this)}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof m)throw Error("projective point not allowed");let e=a=>d.eql(a,d.ZERO);return e(b)&&e(c)?m.ZERO:new m(b,c,d.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(a){let b=d.invertBatch(a.map(a=>a.pz));return a.map((a,c)=>a.toAffine(b[c])).map(m.fromAffine)}static fromHex(a){let b=m.fromAffine(g(g4("pointHex",a)));return b.assertValidity(),b}static fromPrivateKey(a){return m.BASE.multiply(i(a))}static msm(a,b){return function(a,b,c,d){if(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})}(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b),c.length!==d.length)throw Error("arrays of points and scalars must have equal length");let e=a.ZERO,f=g9(BigInt(c.length)),g=f>12?f-3:f>4?f-2:f?2:1,h=(1<<g)-1,i=Array(h+1).fill(e),j=Math.floor((b.BITS-1)/g)*g,k=e;for(let a=j;a>=0;a-=g){i.fill(e);for(let b=0;b<d.length;b++){let e=Number(d[b]>>BigInt(a)&BigInt(h));i[e]=i[e].add(c[b])}let b=e;for(let a=i.length-1,c=e;a>0;a--)c=c.add(i[a]),b=b.add(c);if(k=k.add(b),0!==a)for(let a=0;a<g;a++)k=k.double()}return k}(m,e,a,b)}_setWindowSize(a){o.setWindowSize(this,a)}assertValidity(){l(this)}hasEvenY(){let{y:a}=this.toAffine();if(d.isOdd)return!d.isOdd(a);throw Error("Field doesn't support isOdd")}equals(a){j(a);let{px:b,py:c,pz:e}=this,{px:f,py:g,pz:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),k=d.eql(d.mul(c,h),d.mul(g,e));return i&&k}negate(){return new m(this.px,d.neg(this.py),this.pz)}double(){let{a:a,b:b}=c,e=d.mul(b,hU),{px:f,py:g,pz:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(f,f),n=d.mul(g,g),o=d.mul(h,h),p=d.mul(f,g);return p=d.add(p,p),k=d.mul(f,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(e,o),j=d.add(i,j),i=d.sub(n,j),j=d.add(n,j),j=d.mul(i,j),i=d.mul(p,i),k=d.mul(e,k),o=d.mul(a,o),p=d.sub(l,o),p=d.mul(a,p),p=d.add(p,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,o),l=d.mul(l,p),j=d.add(j,l),o=d.mul(g,h),o=d.add(o,o),l=d.mul(o,p),i=d.sub(i,l),k=d.mul(o,n),k=d.add(k,k),new m(i,j,k=d.add(k,k))}add(a){j(a);let{px:b,py:e,pz:f}=this,{px:g,py:h,pz:i}=a,k=d.ZERO,l=d.ZERO,n=d.ZERO,o=c.a,p=d.mul(c.b,hU),q=d.mul(b,g),r=d.mul(e,h),s=d.mul(f,i),t=d.add(b,e),u=d.add(g,h);t=d.mul(t,u),u=d.add(q,r),t=d.sub(t,u),u=d.add(b,f);let v=d.add(g,i);return u=d.mul(u,v),v=d.add(q,s),u=d.sub(u,v),v=d.add(e,f),k=d.add(h,i),v=d.mul(v,k),k=d.add(r,s),v=d.sub(v,k),n=d.mul(o,u),k=d.mul(p,s),n=d.add(k,n),k=d.sub(r,n),n=d.add(r,n),l=d.mul(k,n),r=d.add(q,q),r=d.add(r,q),s=d.mul(o,s),u=d.mul(p,u),r=d.add(r,s),s=d.sub(q,s),s=d.mul(o,s),u=d.add(u,s),q=d.mul(r,u),l=d.add(l,q),q=d.mul(v,u),k=d.mul(t,k),k=d.sub(k,q),q=d.mul(t,r),n=d.mul(v,n),new m(k,l,n=d.add(n,q))}subtract(a){return this.add(a.negate())}is0(){return this.equals(m.ZERO)}wNAF(a){return o.wNAFCached(this,a,m.normalizeZ)}multiplyUnsafe(a){let{endo:b,n:e}=c;g8("scalar",a,hS,e);let f=m.ZERO;if(a===hS)return f;if(this.is0()||a===hT)return this;if(!b||o.hasPrecomputes(this))return o.wNAFCachedUnsafe(this,a,m.normalizeZ);let{k1neg:g,k1:h,k2neg:i,k2:j}=b.splitScalar(a),k=f,l=f,n=this;for(;h>hS||j>hS;)h&hT&&(k=k.add(n)),j&hT&&(l=l.add(n)),n=n.double(),h>>=hT,j>>=hT;return g&&(k=k.negate()),i&&(l=l.negate()),l=new m(d.mul(l.px,b.beta),l.py,l.pz),k.add(l)}multiply(a){let b,e,{endo:f,n:g}=c;if(g8("scalar",a,hT,g),f){let{k1neg:c,k1:g,k2neg:h,k2:i}=f.splitScalar(a),{p:j,f:k}=this.wNAF(g),{p:l,f:n}=this.wNAF(i);j=o.constTimeNegate(c,j),l=o.constTimeNegate(h,l),l=new m(d.mul(l.px,f.beta),l.py,l.pz),b=j.add(l),e=k.add(n)}else{let{p:c,f:d}=this.wNAF(a);b=c,e=d}return m.normalizeZ([b,e])[0]}multiplyAndAddUnsafe(a,b,c){let d=m.BASE,e=(a,b)=>b!==hS&&b!==hT&&a.equals(d)?a.multiply(b):a.multiplyUnsafe(b),f=e(this,b).add(e(a,c));return f.is0()?void 0:f}toAffine(a){return k(this,a)}isTorsionFree(){let{h:a,isTorsionFree:b}=c;if(a===hT)return!0;if(b)return b(m,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:a,clearCofactor:b}=c;return a===hT?this:b?b(m,this):this.multiplyUnsafe(c.h)}toRawBytes(a=!0){return gU("isCompressed",a),this.assertValidity(),f(m,this,a)}toHex(a=!0){return gU("isCompressed",a),gW(this.toRawBytes(a))}}m.BASE=new m(c.Gx,c.Gy,d.ONE),m.ZERO=new m(d.ZERO,d.ONE,d.ZERO);let n=c.nBitLength,o=(b=c.endo?Math.ceil(n/2):n,{constTimeNegate:hA,hasPrecomputes:a=>1!==hF(a),unsafeLadder(a,b,c=m.ZERO){let d=a;for(;b>hy;)b&hz&&(c=c.add(d)),d=d.double(),b>>=hz;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=hC(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let{windows:e,windowSize:f}=hC(a,b),g=m.ZERO,h=m.BASE,i=BigInt(2**a-1),j=2**a,k=BigInt(a);for(let a=0;a<e;a++){let b=a*f,e=Number(d&i);d>>=k,e>f&&(e-=j,d+=hz);let l=b+Math.abs(e)-1,m=a%2!=0,n=e<0;0===e?h=h.add(hA(m,c[b])):g=g.add(hA(n,c[l]))}return{p:g,f:h}},wNAFUnsafe(a,c,d,e=m.ZERO){let{windows:f,windowSize:g}=hC(a,b),h=BigInt(2**a-1),i=2**a,j=BigInt(a);for(let a=0;a<f;a++){let b=a*g;if(d===hy)break;let f=Number(d&h);if(d>>=j,f>g&&(f-=i,d+=hz),0===f)continue;let k=c[b+Math.abs(f)-1];f<0&&(k=k.negate()),e=e.add(k)}return e},getPrecomputes(a,b,c){let d=hD.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&hD.set(b,c(d))),d},wNAFCached(a,b,c){let d=hF(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=hF(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){hB(c,b),hE.set(a,c),hD.delete(a)}});return{CURVE:c,ProjectivePoint:m,normPrivateKeyToScalar:i,weierstrassEquation:h,isWithinCurveOrder:function(a){return g7(a,hT,c.n)}}}({...b,toBytes(a,b,d){let e=b.toAffine(),f=c.toBytes(e.x);return gU("isCompressed",d),d?g5(Uint8Array.from([b.hasEvenY()?2:3]),f):g5(Uint8Array.from([4]),f,c.toBytes(e.y))},fromBytes(a){let b=a.length,d=a[0],g=a.subarray(1);if(b===e&&(2===d||3===d)){let a,b=g0(g);if(!g7(b,hT,c.ORDER))throw Error("Point is not on curve");let e=j(b);try{a=c.sqrt(e)}catch(a){throw Error("Point is not on curve"+(a instanceof Error?": "+a.message:""))}return(1&d)==1!=((a&hT)===hT)&&(a=c.neg(a)),{x:b,y:a}}if(b===f&&4===d)return{x:c.fromBytes(g.subarray(0,c.BYTES)),y:c.fromBytes(g.subarray(c.BYTES,2*c.BYTES))};throw Error("invalid Point, expected length of "+e+", or uncompressed "+f+", got "+b)}}),l=a=>gW(g2(a,b.nByteLength)),m=(a,b,c)=>g0(a.slice(b,c));class n{constructor(a,b,c){this.r=a,this.s=b,this.recovery=c,this.assertValidity()}static fromCompact(a){let c=b.nByteLength;return new n(m(a=g4("compactSignature",a,2*c),0,c),m(a,c,2*c))}static fromDER(a){let{r:b,s:c}=hR.toSig(g4("DER",a));return new n(b,c)}assertValidity(){g8("r",this.r,hT,d),g8("s",this.s,hT,d)}addRecoveryBit(a){return new n(this.r,this.s,a)}recoverPublicKey(a){let{r:e,s:f,recovery:i}=this,j=q(g4("msgHash",a));if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");let k=2===i||3===i?e+b.n:e;if(k>=c.ORDER)throw Error("recovery id 2 or 3 invalid");let m=(1&i)==0?"02":"03",n=h.fromHex(m+l(k)),o=hs(k,d),p=g(-j*o),r=g(f*o),s=h.BASE.multiplyAndAddUnsafe(n,p,r);if(!s)throw Error("point at infinify");return s.assertValidity(),s}hasHighS(){return this.s>d>>hT}normalizeS(){return this.hasHighS()?new n(this.r,g(-this.s),this.recovery):this}toDERRawBytes(){return g_(this.toDERHex())}toDERHex(){return hR.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return g_(this.toCompactHex())}toCompactHex(){return l(this.r)+l(this.s)}}function o(a){let b=gS(a),c="string"==typeof a,d=(b||c)&&a.length;return b?d===e||d===f:c?d===2*e||d===2*f:a instanceof h}let p=b.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let c=g0(a),d=8*a.length-b.nBitLength;return d>0?c>>BigInt(d):c},q=b.bits2int_modN||function(a){return g(p(a))},r=ha(b.nBitLength);function s(a){return g8("num < 2^"+b.nBitLength,a,hS,r),g2(a,b.nByteLength)}let t={lowS:b.lowS,prehash:!1},u={lowS:b.lowS,prehash:!1};return h.BASE._setWindowSize(8),{CURVE:b,getPublicKey:function(a,b=!0){return h.fromPrivateKey(a).toRawBytes(b)},getSharedSecret:function(a,b,c=!0){if(o(a))throw Error("first arg must be private key");if(!o(b))throw Error("second arg must be public key");return h.fromHex(b).multiply(i(a)).toRawBytes(c)},sign:function(a,e,f=t){let{seed:j,k2sig:l}=function(a,e,f=t){if(["recovered","canonical"].some(a=>a in f))throw Error("sign() legacy options not supported");let{hash:j,randomBytes:l}=b,{lowS:m,prehash:o,extraEntropy:r}=f;null==m&&(m=!0),a=g4("msgHash",a),hO(f),o&&(a=g4("prehashed msgHash",j(a)));let u=q(a),v=i(e),w=[s(v),s(u)];if(null!=r&&!1!==r){let a=!0===r?l(c.BYTES):r;w.push(g4("extraEntropy",a))}return{seed:g5(...w),k2sig:function(a){let b=p(a);if(!k(b))return;let c=hs(b,d),e=h.BASE.multiply(b).toAffine(),f=g(e.x);if(f===hS)return;let i=g(c*g(u+f*v));if(i===hS)return;let j=2*(e.x!==f)|Number(e.y&hT),l=i;return m&&i>d>>hT&&(l=i>d>>hT?g(-i):i,j^=1),new n(f,l,j)}}}(a,e,f);return hd(b.hash.outputLen,b.nByteLength,b.hmac)(j,l)},verify:function(a,c,e,f=u){let i,j;c=g4("msgHash",c),e=g4("publicKey",e);let{lowS:k,prehash:l,format:m}=f;if(hO(f),"strict"in f)throw Error("options.strict was renamed to lowS");if(void 0!==m&&"compact"!==m&&"der"!==m)throw Error("format must be compact or der");let o="string"==typeof a||gS(a),p=!o&&!m&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!o&&!p)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(p&&(i=new n(a.r,a.s)),o){try{"compact"!==m&&(i=n.fromDER(a))}catch(a){if(!(a instanceof hR.Err))throw a}i||"der"===m||(i=n.fromCompact(a))}j=h.fromHex(e)}catch{return!1}if(!i||k&&i.hasHighS())return!1;l&&(c=b.hash(c));let{r:r,s:s}=i,t=q(c),v=hs(s,d),w=g(t*v),x=g(r*v),y=h.BASE.multiplyAndAddUnsafe(j,w,x)?.toAffine();return!!y&&g(y.x)===r},ProjectivePoint:h,Signature:n,utils:{isValidPrivateKey(a){try{return i(a),!0}catch{return!1}},normPrivateKeyToScalar:i,randomPrivateKey:()=>{let a=hx(b.n);return function(a,b,c=!1){let d=a.length,e=hw(b),f=hx(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=hp(c?g1(a):g0(a),b-hj)+hj;return c?g3(g,e):g2(g,e)}(b.randomBytes(a),b.n)},precompute:(a=8,b=h.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}})({...a,hash:b,hmac:(a,...c)=>gI(b,a,function(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];fP(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}(...c)),randomBytes:f0});({...c(b),create:c})})({a:hV.create(BigInt("-3")),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Fp:hV,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},gO),Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,v.THIRTY_DAYS,v.SEVEN_DAYS,v.FIVE_MINUTES,v.FIVE_MINUTES,v.FIVE_MINUTES,v.FIVE_MINUTES,v.FIVE_MINUTES,v.FIVE_MINUTES,v.ONE_DAY,v.ONE_DAY,v.ONE_DAY,v.ONE_DAY,v.FIVE_MINUTES,v.FIVE_MINUTES,v.FIVE_MINUTES,v.FIVE_MINUTES,v.ONE_DAY,v.ONE_DAY,v.ONE_DAY,v.ONE_DAY,v.ONE_HOUR,v.ONE_HOUR,v.FIVE_MINUTES,v.FIVE_MINUTES,v.FIVE_MINUTES,v.SEVEN_DAYS,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,a.i(66814),Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;var hW=a.i(432570),hX=a.i(139583),hY=a.i(194174),hZ=a.i(714977),h$=a.i(975725),h_=a.i(638081),h0=a.i(903544),h1=a.i(584577),h2=a.i(660569),h3=a.i(71664),h4=a.i(259968),h5=a.i(400880);let h6={getSIWX:()=>h2.OptionsController.state.siwx,async initializeIfEnabled(){let a=h2.OptionsController.state.siwx,b=hZ.ChainController.getActiveCaipAddress();if(!(a&&b))return;let[c,d,e]=b.split(":");if(hZ.ChainController.checkIfSupportedNetwork(c))try{if((await a.getSessions(`${c}:${d}`,e)).length)return;await h1.ModalController.open({view:"SIWXSignMessage"})}catch(a){console.error("SIWXUtil:initializeIfEnabled",a),h0.EventsController.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties()}),await h$.ConnectionController._getClient()?.disconnect().catch(console.error),h3.RouterController.reset("Connect"),h4.SnackController.showError("A problem occurred while trying initialize authentication")}},async requestSignMessage(){let a=h2.OptionsController.state.siwx,b=h5.CoreHelperUtil.getPlainAddress(hZ.ChainController.getActiveCaipAddress()),c=hZ.ChainController.getActiveCaipNetwork(),d=h$.ConnectionController._getClient();if(!a)throw Error("SIWX is not enabled");if(!b)throw Error("No ActiveCaipAddress found");if(!c)throw Error("No ActiveCaipNetwork or client found");if(!d)throw Error("No ConnectionController client found");try{let e=await a.createMessage({chainId:c.caipNetworkId,accountAddress:b}),f=e.toString();h_.ConnectorController.getConnectorId(c.chainNamespace)===hW.ConstantsUtil.CONNECTOR_ID.AUTH&&h3.RouterController.pushTransactionStack({});let g=await d.signMessage(f);await a.addSession({data:e,message:f,signature:g}),h1.ModalController.close(),h0.EventsController.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(b){let a=this.getSIWXEventProperties();h1.ModalController.state.open&&"ApproveTransaction"!==h3.RouterController.state.view||await h1.ModalController.open({view:"SIWXSignMessage"}),a.isSmartAccount?h4.SnackController.showError("This application might not support Smart Accounts"):h4.SnackController.showError("Signature declined"),h0.EventsController.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:a}),console.error("SWIXUtil:requestSignMessage",b)}},async cancelSignMessage(){try{let a=this.getSIWX();a?.getRequired?.()?await h$.ConnectionController.disconnect():h1.ModalController.close(),h3.RouterController.reset("Connect"),h0.EventsController.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(a){console.error("SIWXUtil:cancelSignMessage",a)}},async getSessions(){let a=h2.OptionsController.state.siwx,b=h5.CoreHelperUtil.getPlainAddress(hZ.ChainController.getActiveCaipAddress()),c=hZ.ChainController.getActiveCaipNetwork();return a&&b&&c?a.getSessions(c.caipNetworkId,b):[]},async isSIWXCloseDisabled(){let a=this.getSIWX();if(a){let b="ApproveTransaction"===h3.RouterController.state.view,c="SIWXSignMessage"===h3.RouterController.state.view;if(b||c)return a.getRequired?.()&&0===(await this.getSessions()).length}return!1},async universalProviderAuthenticate({universalProvider:a,chains:b,methods:c}){let d=h6.getSIWX(),e=new Set(b.map(a=>a.split(":")[0]));if(!d||1!==e.size||!e.has("eip155"))return!1;let f=await d.createMessage({chainId:hZ.ChainController.getActiveCaipNetwork()?.caipNetworkId||"",accountAddress:""}),g=await a.authenticate({nonce:f.nonce,domain:f.domain,uri:f.uri,exp:f.expirationTime,iat:f.issuedAt,nbf:f.notBefore,requestId:f.requestId,version:f.version,resources:f.resources,statement:f.statement,chainId:f.chainId,methods:c,chains:[f.chainId,...b.filter(a=>a!==f.chainId)]});if(h4.SnackController.showLoading("Authenticating...",{autoClose:!1}),hY.AccountController.setConnectedWalletInfo({...g.session.peer.metadata,name:g.session.peer.metadata.name,icon:g.session.peer.metadata.icons?.[0],type:"WALLET_CONNECT"},Array.from(e)[0]),g?.auths?.length){let b=g.auths.map(b=>{let c=a.client.formatAuthMessage({request:b.p,iss:b.p.iss});return{data:{...b.p,accountAddress:b.p.iss.split(":").slice(-1).join(""),chainId:b.p.iss.split(":").slice(2,4).join(":"),uri:b.p.aud,version:b.p.version||f.version,expirationTime:b.p.exp,issuedAt:b.p.iat,notBefore:b.p.nbf},message:c,signature:b.s.s,cacao:b}});try{await d.setSessions(b),h0.EventsController.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:h6.getSIWXEventProperties()})}catch(b){throw console.error("SIWX:universalProviderAuth - failed to set sessions",b),h0.EventsController.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:h6.getSIWXEventProperties()}),await a.disconnect().catch(console.error),b}finally{h4.SnackController.hide()}}return!0},getSIWXEventProperties(){let a=hZ.ChainController.state.activeChain;return{network:hZ.ChainController.state.activeCaipNetwork?.caipNetworkId||"",isSmartAccount:hY.AccountController.state.preferredAccountTypes?.[a]===hX.W3mFrameRpcConstants.ACCOUNT_TYPES.SMART_ACCOUNT}},async clearSessions(){let a=this.getSIWX();a&&await a.setSessions([])}}}];

//# sourceMappingURL=c35cb_%40reown_appkit-controllers_dist_esm_src_utils_SIWXUtil_7f095684.js.map