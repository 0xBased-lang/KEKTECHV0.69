module.exports=[623643,a=>{"use strict";a.s(["AppKit",()=>gH,"createAppKit",()=>gI],623643),a.s(["createAppKit",()=>gI],255431);var b=a.i(194174),c=a.i(975725),d=a.i(638081),e=a.i(400880),f=a.i(660569),g=a.i(104772),h=a.i(156907),i=a.i(459815);a.i(730729);var j=a.i(345652),k=a.i(427699),l=Object.defineProperty;j.IEvents,j.IEvents,j.IEvents,j.IEvents,j.IEvents,j.IEvents;var m=Object.defineProperty,n=(a,b,c)=>((a,b,c)=>b in a?m(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);k.default;class o{constructor(a){this.opts=a,n(this,"protocol","wc"),n(this,"version",2)}}k.EventEmitter;class p{constructor(a){this.client=a}}var q=a.i(873714);a.i(921836);var r=a.i(551979),s=a.i(177359);let t="2.23.2",u={getDocsUrl:({docsBaseUrl:a,docsPath:b="",docsSlug:c})=>b?`${a??"https://viem.sh"}${b}${c?`#${c}`:""}`:void 0,version:`viem@${t}`};class v extends Error{constructor(a,b={}){let c=b.cause instanceof v?b.cause.details:b.cause?.message?b.cause.message:b.details,d=b.cause instanceof v&&b.cause.docsPath||b.docsPath,e=u.getDocsUrl?.({...b,docsPath:d});super([a||"An error occurred.","",...b.metaMessages?[...b.metaMessages,""]:[],...e?[`Docs: ${e}`]:[],...c?[`Details: ${c}`]:[],...u.version?[`Version: ${u.version}`]:[]].join("\n"),b.cause?{cause:b.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=c,this.docsPath=d,this.metaMessages=b.metaMessages,this.name=b.name??this.name,this.shortMessage=a,this.version=t}walk(a){return function a(b,c){return c?.(b)?b:b&&"object"==typeof b&&"cause"in b&&void 0!==b.cause?a(b.cause,c):c?null:b}(this,a)}}function w(a,{strict:b=!0}={}){return!!a&&"string"==typeof a&&(b?/^0x[0-9a-fA-F]*$/.test(a):a.startsWith("0x"))}class x extends v{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (${a}) exceeds padding size (${b}).`,{name:"SizeExceedsPaddingSizeError"})}}function y(a,{dir:b,size:c=32}={}){return"string"==typeof a?function(a,{dir:b,size:c=32}={}){if(null===c)return a;let d=a.replace("0x","");if(d.length>2*c)throw new x({size:Math.ceil(d.length/2),targetSize:c,type:"hex"});return`0x${d["right"===b?"padEnd":"padStart"](2*c,"0")}`}(a,{dir:b,size:c}):function(a,{dir:b,size:c=32}={}){if(null===c)return a;if(a.length>c)throw new x({size:a.length,targetSize:c,type:"bytes"});let d=new Uint8Array(c);for(let e=0;e<c;e++){let f="right"===b;d[f?e:c-e-1]=a[f?e:a.length-e-1]}return d}(a,{dir:b,size:c})}class z extends v{constructor({max:a,min:b,signed:c,size:d,value:e}){super(`Number "${e}" is not in safe ${d?`${8*d}-bit ${c?"signed":"unsigned"} `:""}integer range ${a?`(${b} to ${a})`:`(above ${b})`}`,{name:"IntegerOutOfRangeError"})}}class A extends v{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed ${b} bytes. Given size: ${a} bytes.`,{name:"SizeOverflowError"})}}function B(a){return w(a,{strict:!1})?Math.ceil((a.length-2)/2):a.length}function C(a,{size:b}){if(B(a)>b)throw new A({givenSize:B(a),maxSize:b})}function D(a,b={}){let{signed:c}=b;b.size&&C(a,{size:b.size});let d=BigInt(a);if(!c)return d;let e=(a.length-2)/2;return d<=(1n<<8n*BigInt(e)-1n)-1n?d:d-BigInt(`0x${"f".padStart(2*e,"f")}`)-1n}let E=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function F(a,b={}){return"number"==typeof a||"bigint"==typeof a?H(a,b):"string"==typeof a?function(a,b={}){return G(I.encode(a),b)}(a,b):"boolean"==typeof a?function(a,b={}){let c=`0x${Number(a)}`;return"number"==typeof b.size?(C(c,{size:b.size}),y(c,{size:b.size})):c}(a,b):G(a,b)}function G(a,b={}){let c="";for(let b=0;b<a.length;b++)c+=E[a[b]];let d=`0x${c}`;return"number"==typeof b.size?(C(d,{size:b.size}),y(d,{dir:"right",size:b.size})):d}function H(a,b={}){let c,{signed:d,size:e}=b,f=BigInt(a);e?c=d?(1n<<8n*BigInt(e)-1n)-1n:2n**(8n*BigInt(e))-1n:"number"==typeof a&&(c=BigInt(Number.MAX_SAFE_INTEGER));let g="bigint"==typeof c&&d?-c-1n:0;if(c&&f>c||f<g){let b="bigint"==typeof a?"n":"";throw new z({max:c?`${c}${b}`:void 0,min:`${g}${b}`,signed:d,size:e,value:`${a}${b}`})}let h=`0x${(d&&f<0?(1n<<BigInt(8*e))+BigInt(f):f).toString(16)}`;return e?y(h,{size:e}):h}let I=new TextEncoder,J=new TextEncoder,K={zero:48,nine:57,A:65,F:70,a:97,f:102};function L(a){return a>=K.zero&&a<=K.nine?a-K.zero:a>=K.A&&a<=K.F?a-(K.A-10):a>=K.a&&a<=K.f?a-(K.a-10):void 0}function M(a,b={}){let c=a;b.size&&(C(c,{size:b.size}),c=y(c,{dir:"right",size:b.size}));let d=c.slice(2);d.length%2&&(d=`0${d}`);let e=d.length/2,f=new Uint8Array(e);for(let a=0,b=0;a<e;a++){let c=L(d.charCodeAt(b++)),e=L(d.charCodeAt(b++));if(void 0===c||void 0===e)throw new v(`Invalid byte sequence ("${d[b-2]}${d[b-1]}" in "${d}").`);f[a]=16*c+e}return f}function N(a,b={}){let c=J.encode(a);return"number"==typeof b.size?(C(c,{size:b.size}),y(c,{dir:"right",size:b.size})):c}var O=a.i(794380);function P(a,b){let c=(0,O.keccak_256)(w(a,{strict:!1})?function(a,b={}){return"number"==typeof a||"bigint"==typeof a?M(H(a,b)):"boolean"==typeof a?function(a,b={}){let c=new Uint8Array(1);return(c[0]=Number(a),"number"==typeof b.size)?(C(c,{size:b.size}),y(c,{size:b.size})):c}(a,b):w(a)?M(a,b):N(a,b)}(a):a);return"bytes"===(b||"hex")?c:F(c)}class Q extends Map{constructor(a){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=a}get(a){let b=super.get(a);return super.has(a)&&void 0!==b&&(this.delete(a),super.set(a,b)),b}set(a,b){if(super.set(a,b),this.maxSize&&this.size>this.maxSize){let a=this.keys().next().value;a&&this.delete(a)}return this}}let R=new Q(8192);async function S({hash:b,signature:c}){let d=w(b)?b:F(b),{secp256k1:e}=await a.A(783635),f=(()=>{if("object"==typeof c&&"r"in c&&"s"in c){let{r:a,s:b,v:d,yParity:f}=c,g=T(Number(f??d));return new e.Signature(D(a),D(b)).addRecoveryBit(g)}let a=w(c)?c:F(c),b=T(function(a,b={}){return Number(D(a,b))}(`0x${a.slice(130)}`));return e.Signature.fromCompact(a.substring(2,130)).addRecoveryBit(b)})().recoverPublicKey(d.substring(2)).toHex(!1);return`0x${f}`}function T(a){if(0===a||1===a)return a;if(27===a)return 0;if(28===a)return 1;throw Error("Invalid yParityOrV value")}async function U({hash:a,signature:b}){var c=await S({hash:a,signature:b});let d=P(`0x${c.substring(4)}`).substring(26);return function(a,b){if(R.has(`${a}.undefined`))return R.get(`${a}.${void 0}`);let c=b?`${b}${a.toLowerCase()}`:a.substring(2).toLowerCase(),d=P(N(c),"bytes"),e=(b?c.substring(`${b}0x`.length):c).split("");for(let a=0;a<40;a+=2)d[a>>1]>>4>=8&&e[a]&&(e[a]=e[a].toUpperCase()),(15&d[a>>1])>=8&&e[a+1]&&(e[a+1]=e[a+1].toUpperCase());let f=`0x${e.join("")}`;return R.set(`${a}.${b}`,f),f}(`0x${d}`)}var V=a.i(403083);a.i(600444),a.i(354033);var W=a.i(264153),X=a.i(440237);function Y(a){let[b,c]=a.split(":");return{namespace:b,reference:c}}function Z(a,b){return a.includes(":")?[a]:b.chains||[]}a.i(587585),a.i(457819);var $=Object.defineProperty,_=Object.defineProperties,aa=Object.getOwnPropertyDescriptors,ab=Object.getOwnPropertySymbols,ac=Object.prototype.hasOwnProperty,ad=Object.prototype.propertyIsEnumerable,ae=(a,b,c)=>b in a?$(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,af=(a,b)=>{for(var c in b||(b={}))ac.call(b,c)&&ae(a,c,b[c]);if(ab)for(var c of ab(b))ad.call(b,c)&&ae(a,c,b[c]);return a};let ag={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};function ah(){return"u">typeof process&&"u">typeof process.versions&&"u">typeof process.versions.node}function ai(){return!(0,r.getDocument)()&&!!(0,r.getNavigator)()&&"ReactNative"===navigator.product}function aj(){return!ah()&&!!(0,r.getNavigator)()&&!!(0,r.getDocument)()}function ak(a,b){return a.filter(a=>b.includes(a)).length===a.length}function al(a=q.FIVE_MINUTES,b){let c,d,e,f,g=(0,q.toMiliseconds)(a||q.FIVE_MINUTES);return{resolve:a=>{e&&c&&(clearTimeout(e),c(a),f=Promise.resolve(a))},reject:a=>{e&&d&&(clearTimeout(e),d(a))},done:()=>new Promise((a,h)=>{if(f)return a(f);e=setTimeout(()=>{let a=Error(b);f=Promise.reject(a),h(a)},g),c=a,d=h})}}function am(a,b){return(0,q.fromMiliseconds)((b||Date.now())+(0,q.toMiliseconds)(a))}function an(a){return Date.now()>=(0,q.toMiliseconds)(a)}function ao(a,b){return`${a}${b?`:${b}`:""}`}function ap(a=[],b=[]){return[...new Set([...a,...b])]}async function aq({id:b,topic:c,wcDeepLink:d}){var e,f;try{if(!d)return;let g="string"==typeof d?JSON.parse(d):d,h=g?.href;if("string"!=typeof h)return;let i=function(a,b,c){let d=`requestId=${b}&sessionTopic=${c}`;a.endsWith("/")&&(a=a.slice(0,-1));let e=`${a}`;if(a.startsWith("https://t.me")){let b=a.includes("?")?"&startapp=":"?startapp=";e=`${e}${b}${function(a,b=!1){let c=Buffer.from(a).toString("base64");return b?c.replace(/[=]/g,""):c}(d,!0)}`}else e=`${e}/wc?${d}`;return e}(h,b,c),j=ai()?ag.reactNative:ah()?ag.node:aj()?ag.browser:ag.unknown;if(j===ag.browser){let a;if(!(null!=(e=(0,r.getDocument)())&&e.hasFocus()))return void console.warn("Document does not have focus, skipping deeplink.");f=i,a="_self",!function(){try{return window.self!==window.top}catch{return!1}}()?(f.startsWith("https://")||f.startsWith("http://"))&&(a="_blank"):a="_top",window.open(f,a,"noreferrer noopener")}else j===ag.reactNative&&"u">typeof(null==a.g?void 0:a.g.Linking)&&await a.g.Linking.openURL(i)}catch(a){console.error(a)}}async function ar(a,b){let c="";try{if(aj()&&(c=localStorage.getItem(b)))return c;c=await a.getItem(b)}catch(a){console.error(a)}return c}function as(a,b){if(!a.includes(b))return null;let c=a.split(/([&,?,=])/),d=c.indexOf(b);return c[d+2]}function at(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function au(a,...b){if(!(a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function av(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function aw(a,b){au(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}let ax=BigInt(0x100000000-1),ay=BigInt(32),az="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function aA(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function aB(a,b){return a<<32-b|a>>>b}let aC=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function aD(a){for(let c=0;c<a.length;c++){var b;a[c]=(b=a[c])<<24&0xff000000|b<<8&0xff0000|b>>>8&65280|b>>>24&255}}function aE(a){return"string"==typeof a&&(a=function(a){if("string"!=typeof a)throw Error("utf8ToBytes expected string, got "+typeof a);return new Uint8Array(new TextEncoder().encode(a))}(a)),au(a),a}class aF{clone(){return this._cloneInto()}}function aG(a){let b=b=>a().update(aE(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function aH(a=32){if(az&&"function"==typeof az.getRandomValues)return az.getRandomValues(new Uint8Array(a));if(az&&"function"==typeof az.randomBytes)return az.randomBytes(a);throw Error("crypto.getRandomValues must be defined")}let aI=[],aJ=[],aK=[],aL=BigInt(0),aM=BigInt(1),aN=BigInt(2),aO=BigInt(7),aP=BigInt(256),aQ=BigInt(113);for(let a=0,b=aM,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],aI.push(2*(5*d+c)),aJ.push((a+1)*(a+2)/2%64);let e=aL;for(let a=0;a<7;a++)(b=(b<<aM^(b>>aO)*aQ)%aP)&aN&&(e^=aM<<(aM<<BigInt(a))-aM);aK.push(e)}let[aR,aS]=function(a,b=!1){let c=new Uint32Array(a.length),d=new Uint32Array(a.length);for(let e=0;e<a.length;e++){let{h:f,l:g}=function(a,b=!1){return b?{h:Number(a&ax),l:Number(a>>ay&ax)}:{h:0|Number(a>>ay&ax),l:0|Number(a&ax)}}(a[e],b);[c[e],d[e]]=[f,g]}return[c,d]}(aK,!0),aT=(a,b,c)=>c>32?((a,b,c)=>b<<c-32|a>>>64-c)(a,b,c):((a,b,c)=>a<<c|b>>>32-c)(a,b,c),aU=(a,b,c)=>c>32?((a,b,c)=>a<<c-32|b>>>64-c)(a,b,c):((a,b,c)=>b<<c|a>>>32-c)(a,b,c);class aV extends aF{constructor(a,b,c,d=!1,e=24){if(super(),this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,at(c),0>=this.blockLen||this.blockLen>=200)throw Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=function(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}(this.state)}keccak(){aC||aD(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=aT(f,g,1)^c[d],i=aU(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=aJ[c],f=aT(b,e,d),g=aU(b,e,d),h=aI[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=aR[d],a[1]^=aS[d]}c.fill(0)}(this.state32,this.rounds),aC||aD(this.state32),this.posOut=0,this.pos=0}update(a){av(this);let{blockLen:b,state:c}=this,d=(a=aE(a)).length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){av(this,!1),au(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return at(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(aw(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new aV(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let aW=aG(()=>new aV(136,1,32));function aX(a){let b=`Ethereum Signed Message:
${a.length}`,c=new TextEncoder().encode(b+a);return"0x"+Buffer.from(aW(c)).toString("hex")}async function aY(a,b,c,d,e,f){switch(c.t){case"eip191":return await aZ(a,b,c.s);case"eip1271":return await a$(a,b,c.s,d,e,f);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${c.t}`)}}async function aZ(a,b,c){return(await U({hash:aX(b),signature:c})).toLowerCase()===a.toLowerCase()}async function a$(a,b,c,d,e,f){let g=Y(d);if(!g.namespace||!g.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${d}`);try{let g="0x1626ba7e",h=c.substring(2),i=aX(b).substring(2),j=g+i+"00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000041"+h,k=await fetch(`${f||"https://rpc.walletconnect.org/v1"}/?chainId=${d}&projectId=${e}`,{method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:a,data:j},"latest"]})}),{result:l}=await k.json();return!!l&&l.slice(0,g.length).toLowerCase()===g.toLowerCase()}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}var a_=Object.defineProperty,a0=Object.defineProperties,a1=Object.getOwnPropertyDescriptors,a2=Object.getOwnPropertySymbols,a3=Object.prototype.hasOwnProperty,a4=Object.prototype.propertyIsEnumerable,a5=(a,b,c)=>b in a?a_(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;let a6=a=>a?.split(":"),a7=a=>{let b=a&&a6(a);if(b)return b[2]+":"+b[3]},a8=a=>{let b=a&&a6(a);if(b)return b.pop()};async function a9(a){let{cacao:b,projectId:c}=a,{s:d,p:e}=b,f=ba(e,e.iss),g=a8(e.iss);return await aY(g,f,d,a7(e.iss),c)}let ba=(a,b)=>{let c=`${a.domain} wants you to sign in with your Ethereum account:`,d=a8(b);if(!a.aud&&!a.uri)throw Error("Either `aud` or `uri` is required to construct the message");let e=a.statement||void 0,f=`URI: ${a.aud||a.uri}`,g=`Version: ${a.version}`,h=`Chain ID: ${(a=>{let b=a&&a6(a);if(b)return a.includes("did:pkh:")?b[3]:b[1]})(b)}`,i=`Nonce: ${a.nonce}`,j=`Issued At: ${a.iat}`,k=a.exp?`Expiration Time: ${a.exp}`:void 0,l=a.nbf?`Not Before: ${a.nbf}`:void 0,m=a.requestId?`Request ID: ${a.requestId}`:void 0,n=a.resources?`Resources:${a.resources.map(a=>`
- ${a}`).join("")}`:void 0,o=bg(a.resources);return o&&(e=function(a="",b){bb(b);let c="I further authorize the stated URI to perform the following actions on my behalf: ";if(a.includes(c))return a;let d=[],e=0;Object.keys(b.att).forEach(a=>{let c=Object.keys(b.att[a]).map(a=>({ability:a.split("/")[0],action:a.split("/")[1]}));c.sort((a,b)=>a.action.localeCompare(b.action));let f={};c.forEach(a=>{f[a.ability]||(f[a.ability]=[]),f[a.ability].push(a.action)});let g=Object.keys(f).map(b=>(e++,`(${e}) '${b}': '${f[b].join("', '")}' for '${a}'.`));d.push(g.join(", ").replace(".,","."))});let f=d.join(" "),g=`${c}${f}`;return`${a?a+" ":""}${g}`}(e,bd(o))),[c,d,"",e,"",f,g,h,i,j,k,l,m,n].filter(a=>null!=a).join(`
`)};function bb(a){if(!a)throw Error("No recap provided, value is undefined");if(!a.att)throw Error("No `att` property found");let b=Object.keys(a.att);if(!(null!=b&&b.length))throw Error("No resources found in `att` property");b.forEach(b=>{let c=a.att[b];if(Array.isArray(c)||"object"!=typeof c)throw Error(`Resource must be an object: ${b}`);if(!Object.keys(c).length)throw Error(`Resource object is empty: ${b}`);Object.keys(c).forEach(a=>{let b=c[a];if(!Array.isArray(b))throw Error(`Ability limits ${a} must be an array of objects, found: ${b}`);if(!b.length)throw Error(`Value of ${a} is empty array, must be an array with objects`);b.forEach(b=>{if("object"!=typeof b)throw Error(`Ability limits (${a}) must be an array of objects, found: ${b}`)})})})}function bc(a){return bb(a),`urn:recap:${Buffer.from(JSON.stringify(a)).toString("base64").replace(/=/g,"")}`}function bd(a){var b;let c=(b=a.replace("urn:recap:",""),JSON.parse(Buffer.from(b,"base64").toString("utf-8")));return bb(c),c}function be(a){var b;let c=bd(a);bb(c);let d=null==(b=c.att)?void 0:b.eip155;return d?Object.keys(d).map(a=>a.split("/")[1]):[]}function bf(a){let b=bd(a);bb(b);let c=[];return Object.values(b.att).forEach(a=>{Object.values(a).forEach(a=>{var b;null!=(b=a?.[0])&&b.chains&&c.push(a[0].chains)})}),[...new Set(c.flat())]}function bg(a){if(!a)return;let b=a?.[a.length-1];return b&&b.includes("urn:recap:")?b:void 0}function bh(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function bi(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function bj(a,...b){if(!bi(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function bk(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function bl(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}let bm=a=>new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4));if(68!==new Uint8Array(new Uint32Array([0x11223344]).buffer)[0])throw Error("Non little-endian hardware is not supported");function bn(a){if("string"==typeof a)a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a);else if(bi(a))a=bq(a);else throw Error("Uint8Array expected, got "+typeof a);return a}function bo(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error("invalid output length, expected "+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function bp(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function bq(a){return Uint8Array.from(a)}function br(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let bs=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),bt=bs("expand 16-byte k"),bu=bs("expand 32-byte k"),bv=bm(bt),bw=bm(bu);function bx(a,b){return a<<b|a>>>32-b}function by(a){return a.byteOffset%4==0}let bz=0x100000000-1,bA=new Uint32Array,bB=(a,b)=>255&a[b++]|(255&a[b++])<<8;class bC{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,bj(a=bn(a),32);let b=bB(a,0),c=bB(a,2),d=bB(a,4),e=bB(a,6),f=bB(a,8),g=bB(a,10),h=bB(a,12),i=bB(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=bB(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=bB(a,b+0),q=bB(a,b+2),r=bB(a,b+4),s=bB(a,b+6),t=bB(a,b+8),u=bB(a,b+10),v=bB(a,b+12),w=bB(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;br(c)}update(a){bk(this);let{buffer:b,blockLen:c}=this,d=(a=bn(a)).length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){br(this.h,this.r,this.buffer,this.pad)}digestInto(a){bk(this),function(a,b){bj(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,h:c}=this,{pos:d}=this;if(d){for(b[d++]=1;d<16;d++)b[d]=0;this.process(b,0,!0)}this.finalize();let e=0;for(let b=0;b<8;b++)a[e++]=c[b]>>>0,a[e++]=c[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let bD=function(a){let b=(b,c)=>a(c).update(bn(b)).digest(),c=a(new Uint8Array(32));return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=b=>a(b),b}(a=>new bC(a)),bE=function(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return bh(e),bh(g),bl(f),bl(c),(b,h,i,j,k=0)=>{bj(b),bj(h),bj(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),bj(j),bh(k),k<0||k>=bz)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],n=b.length,o,p;if(32===n)m.push(o=bq(b)),p=bw;else if(16===n&&c)(o=new Uint8Array(32)).set(b),o.set(b,16),p=bv,m.push(o);else throw Error(`arx: invalid 32-byte key, got length=${n}`);by(h)||m.push(h=bq(h));let q=bm(o);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(p,q,bm(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=bm(j),l=by(e)&&by(f),m=l?bm(e):bA,n=l?bm(f):bA;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=bz)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,p,q,bm(h),i,j,k,g),br(...m),j}}(function(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=bx(H^(v=v+z|0),16))|0,v=v+(z=bx(z^D,12))|0,D=D+(H=bx(H^v,8))|0,z=bx(z^D,7),E=E+(I=bx(I^(w=w+A|0),16))|0,w=w+(A=bx(A^E,12))|0,E=E+(I=bx(I^w,8))|0,A=bx(A^E,7),F=F+(J=bx(J^(x=x+B|0),16))|0,x=x+(B=bx(B^F,12))|0,F=F+(J=bx(J^x,8))|0,B=bx(B^F,7),G=G+(K=bx(K^(y=y+C|0),16))|0,y=y+(C=bx(C^G,12))|0,G=G+(K=bx(K^y,8))|0,C=bx(C^G,7),F=F+(K=bx(K^(v=v+A|0),16))|0,v=v+(A=bx(A^F,12))|0,F=F+(K=bx(K^v,8))|0,A=bx(A^F,7),G=G+(H=bx(H^(w=w+B|0),16))|0,w=w+(B=bx(B^G,12))|0,G=G+(H=bx(H^w,8))|0,B=bx(B^G,7),D=D+(I=bx(I^(x=x+C|0),16))|0,x=x+(C=bx(C^D,12))|0,D=D+(I=bx(I^x,8))|0,C=bx(C^D,7),E=E+(J=bx(J^(y=y+z|0),16))|0,y=y+(z=bx(z^E,12))|0,E=E+(J=bx(J^y,8))|0,z=bx(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),bF=new Uint8Array(16),bG=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(bF.subarray(c))},bH=new Uint8Array(32);function bI(a,b,c,d,e){let f=a(b,c,bH),g=bD.create(f);e&&bG(g,e),bG(g,d);let h=new Uint8Array(16),i=new DataView(h.buffer,h.byteOffset,h.byteLength);bp(i,0,BigInt(e?e.length:0),!0),bp(i,8,BigInt(d.length),!0),g.update(h);let j=g.digest();return br(f,h),j}((a,b)=>Object.assign(function(c,...d){if(bj(c),void 0!==a.nonceLength){let b=d[0];if(!b)throw Error("nonce / iv required");a.varSizeNonce?bj(b):bj(b,a.nonceLength)}let e=a.tagLength;e&&void 0!==d[1]&&bj(d[1]);let f=b(c,...d),g=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");bj(b)}},h=!1;return{encrypt(a,b){if(h)throw Error("cannot encrypt() twice with same key + nonce");return h=!0,bj(a),g(f.encrypt.length,b),f.encrypt(a,b)},decrypt(a,b){if(bj(a),e&&a.length<e)throw Error("invalid ciphertext length: smaller than tagLength="+e);return g(f.decrypt.length,b),f.decrypt(a,b)}}},a))({blockSize:64,nonceLength:12,tagLength:16},(a=>(b,c,d)=>({encrypt(e,f){let g=e.length;(f=bo(g+16,f,!1)).set(e);let h=f.subarray(0,-16);a(b,c,h,h,1);let i=bI(a,b,c,h,d);return f.set(i,g),br(i),f},decrypt(e,f){f=bo(e.length-16,f,!1);let g=e.subarray(0,-16),h=e.subarray(-16),i=bI(a,b,c,g,d);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(h,i))throw Error("invalid tag");return f.set(e.subarray(0,-16)),a(b,c,f,f,1),br(i),f}}))(bE));class bJ extends aF{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,function(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.wrapConstructor");at(a.outputLen),at(a.blockLen)}(a);let c=aE(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),e.fill(0)}update(a){return av(this),this.iHash.update(a),this}digestInto(a){av(this),au(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let bK=(a,b,c)=>new bJ(a,b).update(c).digest();bK.create=(a,b)=>new bJ(a,b),new Uint8Array([0]),new Uint8Array;class bL extends aF{constructor(a,b,c,d){super(),this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(a),this.view=aA(this.buffer)}update(a){av(this);let{view:b,buffer:c,blockLen:d}=this,e=(a=aE(a)).length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=aA(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){av(this),aw(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,this.buffer.subarray(f).fill(0),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=aA(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.length=d,a.pos=g,a.finished=e,a.destroyed=f,d%b&&a.buffer.set(c),a}}let bM=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),bN=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),bO=new Uint32Array(64);class bP extends bL{constructor(){super(64,32,8,!1),this.A=0|bN[0],this.B=0|bN[1],this.C=0|bN[2],this.D=0|bN[3],this.E=0|bN[4],this.F=0|bN[5],this.G=0|bN[6],this.H=0|bN[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)bO[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=bO[a-15],c=bO[a-2],d=aB(b,7)^aB(b,18)^b>>>3,e=aB(c,17)^aB(c,19)^c>>>10;bO[a]=e+bO[a-7]+d+bO[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(aB(g,6)^aB(g,11)^aB(g,25))+((k=g)&h^~k&i)+bM[a]+bO[a]|0,o=(aB(c,2)^aB(c,13)^aB(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){bO.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}let bQ=aG(()=>new bP),bR=BigInt(0),bS=BigInt(1),bT=BigInt(2);function bU(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function bV(a){if(!bU(a))throw Error("Uint8Array expected")}function bW(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}let bX=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function bY(a){bV(a);let b="";for(let c=0;c<a.length;c++)b+=bX[a[c]];return b}function bZ(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function b$(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?bR:BigInt("0x"+a)}let b_={_0:48,_9:57,A:65,F:70,a:97,f:102};function b0(a){return a>=b_._0&&a<=b_._9?a-b_._0:a>=b_.A&&a<=b_.F?a-(b_.A-10):a>=b_.a&&a<=b_.f?a-(b_.a-10):void 0}function b1(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=b0(a.charCodeAt(e)),f=b0(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function b2(a){return b$(bY(a))}function b3(a){return bV(a),b$(bY(Uint8Array.from(a).reverse()))}function b4(a,b){return b1(a.toString(16).padStart(2*b,"0"))}function b5(a,b){return b4(a,b).reverse()}function b6(a,b,c){let d;if("string"==typeof b)try{d=b1(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(bU(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function b7(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];bV(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let b8=a=>"bigint"==typeof a&&bR<=a;function b9(a,b,c){return b8(a)&&b8(b)&&b8(c)&&b<=a&&a<c}function ca(a,b,c,d){if(!b9(b,c,d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}function cb(a){let b;for(b=0;a>bR;a>>=bS,b+=1);return b}let cc=a=>(bT<<BigInt(a-1))-bS,cd=a=>new Uint8Array(a),ce=a=>Uint8Array.from(a);function cf(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=cd(a),e=cd(a),f=0,g=()=>{d.fill(1),e.fill(0),f=0},h=(...a)=>c(e,d,...a),i=(a=cd())=>{e=h(ce([0]),a),d=h(),0!==a.length&&(e=h(ce([1]),a),d=h())},j=()=>{if(f++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(d=h()).slice();c.push(b),a+=d.length}return b7(...c)};return(a,b)=>{let c;for(g(),i(a);!(c=b(j()));)i();return g(),c}}let cg={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||bU(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function ch(a,b,c={}){let d=(b,c,d)=>{let e=cg[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if(!(d&&void 0===f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function ci(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}var cj=Object.freeze({__proto__:null,isBytes:bU,abytes:bV,abool:bW,bytesToHex:bY,numberToHexUnpadded:bZ,hexToNumber:b$,hexToBytes:b1,bytesToNumberBE:b2,bytesToNumberLE:b3,numberToBytesBE:b4,numberToBytesLE:b5,numberToVarBytesBE:function(a){return b1(bZ(a))},ensureBytes:b6,concatBytes:b7,equalBytes:function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c},utf8ToBytes:function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))},inRange:b9,aInRange:ca,bitLen:cb,bitGet:function(a,b){return a>>BigInt(b)&bS},bitSet:function(a,b,c){return a|(c?bS:bR)<<BigInt(b)},bitMask:cc,createHmacDrbg:cf,validateObject:ch,notImplemented:()=>{throw Error("not implemented")},memoized:ci});let ck=BigInt(0),cl=BigInt(1),cm=BigInt(2),cn=BigInt(3),co=BigInt(4),cp=BigInt(5),cq=BigInt(8);function cr(a,b){let c=a%b;return c>=ck?c:b+c}function cs(a,b,c){if(b<ck)throw Error("invalid exponent, negatives unsupported");if(c<=ck)throw Error("invalid modulus");if(c===cl)return ck;let d=cl;for(;b>ck;)b&cl&&(d=d*a%c),a=a*a%c,b>>=cl;return d}function ct(a,b,c){let d=a;for(;b-- >ck;)d*=d,d%=c;return d}function cu(a,b){if(a===ck)throw Error("invert: expected non-zero number");if(b<=ck)throw Error("invert: expected positive modulus, got "+b);let c=cr(a,b),d=b,e=ck,f=cl;for(;c!==ck;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==cl)throw Error("invert: does not exist");return cr(e,b)}let cv=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function cw(a,b){let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function cx(a,b,c=!1,d={}){let e;if(a<=ck)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=cw(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:cc(f),ZERO:ck,ONE:cl,create:b=>cr(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return ck<=b&&b<a},is0:a=>a===ck,isOdd:a=>(a&cl)===cl,neg:b=>cr(-b,a),eql:(a,b)=>a===b,sqr:b=>cr(b*b,a),add:(b,c)=>cr(b+c,a),sub:(b,c)=>cr(b-c,a),mul:(b,c)=>cr(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<ck)throw Error("invalid exponent, negatives unsupported");if(c===ck)return a.ONE;if(c===cl)return b;let d=a.ONE,e=b;for(;c>ck;)c&cl&&(d=a.mul(d,e)),e=a.sqr(e),c>>=cl;return d})(h,a,b),div:(b,c)=>cr(b*cu(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>cu(b,a),sqrt:d.sqrt||(b=>(e||(e=function(a){if(a%co===cn){let b=(a+cl)/co;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}if(a%cq===cp){let b=(a-cp)/cq;return function(a,c){let d=a.mul(c,cm),e=a.pow(d,b),f=a.mul(c,e),g=a.mul(a.mul(f,cm),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),c))throw Error("Cannot find square root");return h}}return function(a){let b,c,d,e=(a-cl)/cm;for(b=a-cl,c=0;b%cm===ck;b/=cm,c++);for(d=cm;d<a&&cs(d,e,a)!==a-cl;d++)if(d>1e3)throw Error("Cannot find square root: likely non-prime P");if(1===c){let b=(a+cl)/co;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}let f=(b+cl)/cm;return function(a,g){if(a.pow(g,e)===a.neg(a.ONE))throw Error("Cannot find square root");let h=c,i=a.pow(a.mul(a.ONE,d),b),j=a.pow(g,f),k=a.pow(g,b);for(;!a.eql(k,a.ONE);){if(a.eql(k,a.ZERO))return a.ZERO;let b=1;for(let c=a.sqr(k);b<h&&!a.eql(c,a.ONE);b++)c=a.sqr(c);let c=a.pow(i,cl<<BigInt(h-b-1));i=a.sqr(c),j=a.mul(j,c),k=a.mul(k,i),h=b}return j}}(a)}(a)),e(h,b))),invertBatch:a=>(function(a,b){let c=Array(b.length),d=b.reduce((b,d,e)=>a.is0(d)?b:(c[e]=b,a.mul(b,d)),a.ONE),e=a.inv(d);return b.reduceRight((b,d,e)=>a.is0(d)?b:(c[e]=a.mul(b,c[e]),a.mul(b,d)),e),c})(h,a),cmov:(a,b,c)=>c?b:a,toBytes:a=>c?b5(a,g):b4(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?b3(a):b2(a)}});return Object.freeze(h)}function cy(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function cz(a){let b=cy(a);return b+Math.ceil(b/2)}let cA=BigInt(0),cB=BigInt(1);function cC(a,b){let c=b.negate();return a?c:b}function cD(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function cE(a,b){return cD(a,b),{windows:Math.ceil(b/a)+1,windowSize:2**(a-1)}}let cF=new WeakMap,cG=new WeakMap;function cH(a){return cG.get(a)||1}function cI(a){return ch(a.Fp,cv.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),ch(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...cw(a.n,a.nBitLength),...a,p:a.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);let cJ=BigInt(0),cK=BigInt(1),cL=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);let cM=BigInt(1),cN=BigInt(2),cO=BigInt(3),cP=BigInt(5);function cQ(a){void 0!==a.lowS&&bW("lowS",a.lowS),void 0!==a.prehash&&bW("prehash",a.prehash)}BigInt(8),!function(a){let b=(ch(a,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...a})),{P:c}=b,d=a=>cr(a,c),e=b.montgomeryBits,f=Math.ceil(e/8),g=b.nByteLength,h=b.adjustScalarBytes||(a=>a),i=b.powPminus2||(a=>cs(a,c-BigInt(2),c));(b.a-BigInt(2))/BigInt(4);b5(d(b.Gu),f)}({P:cL,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:a=>{let{pow_p_5_8:b,b2:c}=function(a){let b=BigInt(10),c=BigInt(20),d=BigInt(40),e=BigInt(80),f=a*a%cL*a%cL,g=ct(f,cN,cL)*f%cL,h=ct(g,cM,cL)*a%cL,i=ct(h,cP,cL)*h%cL,j=ct(i,b,cL)*i%cL,k=ct(j,c,cL)*j%cL,l=ct(k,d,cL)*k%cL,m=ct(l,e,cL)*l%cL,n=ct(m,e,cL)*l%cL,o=ct(n,b,cL)*i%cL;return{pow_p_5_8:ct(o,cN,cL)*a%cL,b2:f}}(a);return cr(ct(b,cO,cL)*c,cL)},adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a},randomBytes:aH});let{bytesToNumberBE:cR,hexToBytes:cS}=cj,cT={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=cT;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=bZ(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?bZ(e.length/2|128):"";return bZ(a)+f+e+b},decode(a,b){let{Err:c}=cT,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=cT;if(a<cU)throw new b("integer: negative integers are not allowed");let c=bZ(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=cT;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return cR(a)}},toSig(a){let{Err:b,_int:c,_tlv:d}=cT,e="string"==typeof a?cS(a):a;bV(e);let{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=cT,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},cU=BigInt(0),cV=BigInt(1);BigInt(2);let cW=BigInt(3);BigInt(4);let cX=cx(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),cY=(function(a,b){let c=b=>(function(a){let b=function(a){let b=cI(a);return ch(b,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...b})}(a),{Fp:c,n:d}=b,e=c.BYTES+1,f=2*c.BYTES+1;function g(a){return cr(a,d)}let{ProjectivePoint:h,normPrivateKeyToScalar:i,weierstrassEquation:j,isWithinCurveOrder:k}=function(a){var b;let c=function(a){let b=cI(a);ch(b,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:c,Fp:d,a:e}=b;if(c){if(!d.eql(e,d.ZERO))throw Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof c||"bigint"!=typeof c.beta||"function"!=typeof c.splitScalar)throw Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...b})}(a),{Fp:d}=c,e=cx(c.n,c.nBitLength),f=c.toBytes||((a,b,c)=>{let e=b.toAffine();return b7(Uint8Array.from([4]),d.toBytes(e.x),d.toBytes(e.y))}),g=c.fromBytes||(a=>{let b=a.subarray(1);return{x:d.fromBytes(b.subarray(0,d.BYTES)),y:d.fromBytes(b.subarray(d.BYTES,2*d.BYTES))}});function h(a){let{a:b,b:e}=c,f=d.sqr(a),g=d.mul(f,a);return d.add(d.add(g,d.mul(a,b)),e)}if(!d.eql(d.sqr(c.Gy),h(c.Gx)))throw Error("bad generator point: equation left != right");function i(a){let b,{allowedPrivateKeyLengths:d,nByteLength:e,wrapPrivateKey:f,n:g}=c;if(d&&"bigint"!=typeof a){if(bU(a)&&(a=bY(a)),"string"!=typeof a||!d.includes(a.length))throw Error("invalid private key");a=a.padStart(2*e,"0")}try{b="bigint"==typeof a?a:b2(b6("private key",a,e))}catch{throw Error("invalid private key, expected hex or "+e+" bytes, got "+typeof a)}return f&&(b=cr(b,g)),ca("private key",b,cV,g),b}function j(a){if(!(a instanceof m))throw Error("ProjectivePoint expected")}let k=ci((a,b)=>{let{px:c,py:e,pz:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),l=ci(a=>{if(a.is0()){if(c.allowInfinityPoint&&!d.is0(a.py))return;throw Error("bad point: ZERO")}let{x:b,y:e}=a.toAffine();if(!d.isValid(b)||!d.isValid(e))throw Error("bad point: x or y not FE");let f=d.sqr(e),g=h(b);if(!d.eql(f,g))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class m{constructor(a,b,c){if(this.px=a,this.py=b,this.pz=c,null==a||!d.isValid(a))throw Error("x required");if(null==b||!d.isValid(b))throw Error("y required");if(null==c||!d.isValid(c))throw Error("z required");Object.freeze(this)}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof m)throw Error("projective point not allowed");let e=a=>d.eql(a,d.ZERO);return e(b)&&e(c)?m.ZERO:new m(b,c,d.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(a){let b=d.invertBatch(a.map(a=>a.pz));return a.map((a,c)=>a.toAffine(b[c])).map(m.fromAffine)}static fromHex(a){let b=m.fromAffine(g(b6("pointHex",a)));return b.assertValidity(),b}static fromPrivateKey(a){return m.BASE.multiply(i(a))}static msm(a,b){return function(a,b,c,d){if(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})}(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b),c.length!==d.length)throw Error("arrays of points and scalars must have equal length");let e=a.ZERO,f=cb(BigInt(c.length)),g=f>12?f-3:f>4?f-2:f?2:1,h=(1<<g)-1,i=Array(h+1).fill(e),j=Math.floor((b.BITS-1)/g)*g,k=e;for(let a=j;a>=0;a-=g){i.fill(e);for(let b=0;b<d.length;b++){let e=Number(d[b]>>BigInt(a)&BigInt(h));i[e]=i[e].add(c[b])}let b=e;for(let a=i.length-1,c=e;a>0;a--)c=c.add(i[a]),b=b.add(c);if(k=k.add(b),0!==a)for(let a=0;a<g;a++)k=k.double()}return k}(m,e,a,b)}_setWindowSize(a){o.setWindowSize(this,a)}assertValidity(){l(this)}hasEvenY(){let{y:a}=this.toAffine();if(d.isOdd)return!d.isOdd(a);throw Error("Field doesn't support isOdd")}equals(a){j(a);let{px:b,py:c,pz:e}=this,{px:f,py:g,pz:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),k=d.eql(d.mul(c,h),d.mul(g,e));return i&&k}negate(){return new m(this.px,d.neg(this.py),this.pz)}double(){let{a:a,b:b}=c,e=d.mul(b,cW),{px:f,py:g,pz:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(f,f),n=d.mul(g,g),o=d.mul(h,h),p=d.mul(f,g);return p=d.add(p,p),k=d.mul(f,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(e,o),j=d.add(i,j),i=d.sub(n,j),j=d.add(n,j),j=d.mul(i,j),i=d.mul(p,i),k=d.mul(e,k),o=d.mul(a,o),p=d.sub(l,o),p=d.mul(a,p),p=d.add(p,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,o),l=d.mul(l,p),j=d.add(j,l),o=d.mul(g,h),o=d.add(o,o),l=d.mul(o,p),i=d.sub(i,l),k=d.mul(o,n),k=d.add(k,k),new m(i,j,k=d.add(k,k))}add(a){j(a);let{px:b,py:e,pz:f}=this,{px:g,py:h,pz:i}=a,k=d.ZERO,l=d.ZERO,n=d.ZERO,o=c.a,p=d.mul(c.b,cW),q=d.mul(b,g),r=d.mul(e,h),s=d.mul(f,i),t=d.add(b,e),u=d.add(g,h);t=d.mul(t,u),u=d.add(q,r),t=d.sub(t,u),u=d.add(b,f);let v=d.add(g,i);return u=d.mul(u,v),v=d.add(q,s),u=d.sub(u,v),v=d.add(e,f),k=d.add(h,i),v=d.mul(v,k),k=d.add(r,s),v=d.sub(v,k),n=d.mul(o,u),k=d.mul(p,s),n=d.add(k,n),k=d.sub(r,n),n=d.add(r,n),l=d.mul(k,n),r=d.add(q,q),r=d.add(r,q),s=d.mul(o,s),u=d.mul(p,u),r=d.add(r,s),s=d.sub(q,s),s=d.mul(o,s),u=d.add(u,s),q=d.mul(r,u),l=d.add(l,q),q=d.mul(v,u),k=d.mul(t,k),k=d.sub(k,q),q=d.mul(t,r),n=d.mul(v,n),new m(k,l,n=d.add(n,q))}subtract(a){return this.add(a.negate())}is0(){return this.equals(m.ZERO)}wNAF(a){return o.wNAFCached(this,a,m.normalizeZ)}multiplyUnsafe(a){let{endo:b,n:e}=c;ca("scalar",a,cU,e);let f=m.ZERO;if(a===cU)return f;if(this.is0()||a===cV)return this;if(!b||o.hasPrecomputes(this))return o.wNAFCachedUnsafe(this,a,m.normalizeZ);let{k1neg:g,k1:h,k2neg:i,k2:j}=b.splitScalar(a),k=f,l=f,n=this;for(;h>cU||j>cU;)h&cV&&(k=k.add(n)),j&cV&&(l=l.add(n)),n=n.double(),h>>=cV,j>>=cV;return g&&(k=k.negate()),i&&(l=l.negate()),l=new m(d.mul(l.px,b.beta),l.py,l.pz),k.add(l)}multiply(a){let b,e,{endo:f,n:g}=c;if(ca("scalar",a,cV,g),f){let{k1neg:c,k1:g,k2neg:h,k2:i}=f.splitScalar(a),{p:j,f:k}=this.wNAF(g),{p:l,f:n}=this.wNAF(i);j=o.constTimeNegate(c,j),l=o.constTimeNegate(h,l),l=new m(d.mul(l.px,f.beta),l.py,l.pz),b=j.add(l),e=k.add(n)}else{let{p:c,f:d}=this.wNAF(a);b=c,e=d}return m.normalizeZ([b,e])[0]}multiplyAndAddUnsafe(a,b,c){let d=m.BASE,e=(a,b)=>b!==cU&&b!==cV&&a.equals(d)?a.multiply(b):a.multiplyUnsafe(b),f=e(this,b).add(e(a,c));return f.is0()?void 0:f}toAffine(a){return k(this,a)}isTorsionFree(){let{h:a,isTorsionFree:b}=c;if(a===cV)return!0;if(b)return b(m,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:a,clearCofactor:b}=c;return a===cV?this:b?b(m,this):this.multiplyUnsafe(c.h)}toRawBytes(a=!0){return bW("isCompressed",a),this.assertValidity(),f(m,this,a)}toHex(a=!0){return bW("isCompressed",a),bY(this.toRawBytes(a))}}m.BASE=new m(c.Gx,c.Gy,d.ONE),m.ZERO=new m(d.ZERO,d.ONE,d.ZERO);let n=c.nBitLength,o=(b=c.endo?Math.ceil(n/2):n,{constTimeNegate:cC,hasPrecomputes:a=>1!==cH(a),unsafeLadder(a,b,c=m.ZERO){let d=a;for(;b>cA;)b&cB&&(c=c.add(d)),d=d.double(),b>>=cB;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=cE(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let{windows:e,windowSize:f}=cE(a,b),g=m.ZERO,h=m.BASE,i=BigInt(2**a-1),j=2**a,k=BigInt(a);for(let a=0;a<e;a++){let b=a*f,e=Number(d&i);d>>=k,e>f&&(e-=j,d+=cB);let l=b+Math.abs(e)-1,m=a%2!=0,n=e<0;0===e?h=h.add(cC(m,c[b])):g=g.add(cC(n,c[l]))}return{p:g,f:h}},wNAFUnsafe(a,c,d,e=m.ZERO){let{windows:f,windowSize:g}=cE(a,b),h=BigInt(2**a-1),i=2**a,j=BigInt(a);for(let a=0;a<f;a++){let b=a*g;if(d===cA)break;let f=Number(d&h);if(d>>=j,f>g&&(f-=i,d+=cB),0===f)continue;let k=c[b+Math.abs(f)-1];f<0&&(k=k.negate()),e=e.add(k)}return e},getPrecomputes(a,b,c){let d=cF.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&cF.set(b,c(d))),d},wNAFCached(a,b,c){let d=cH(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=cH(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){cD(c,b),cG.set(a,c),cF.delete(a)}});return{CURVE:c,ProjectivePoint:m,normPrivateKeyToScalar:i,weierstrassEquation:h,isWithinCurveOrder:function(a){return b9(a,cV,c.n)}}}({...b,toBytes(a,b,d){let e=b.toAffine(),f=c.toBytes(e.x);return bW("isCompressed",d),d?b7(Uint8Array.from([b.hasEvenY()?2:3]),f):b7(Uint8Array.from([4]),f,c.toBytes(e.y))},fromBytes(a){let b=a.length,d=a[0],g=a.subarray(1);if(b===e&&(2===d||3===d)){let a,b=b2(g);if(!b9(b,cV,c.ORDER))throw Error("Point is not on curve");let e=j(b);try{a=c.sqrt(e)}catch(a){throw Error("Point is not on curve"+(a instanceof Error?": "+a.message:""))}return(1&d)==1!=((a&cV)===cV)&&(a=c.neg(a)),{x:b,y:a}}if(b===f&&4===d)return{x:c.fromBytes(g.subarray(0,c.BYTES)),y:c.fromBytes(g.subarray(c.BYTES,2*c.BYTES))};throw Error("invalid Point, expected length of "+e+", or uncompressed "+f+", got "+b)}}),l=a=>bY(b4(a,b.nByteLength)),m=(a,b,c)=>b2(a.slice(b,c));class n{constructor(a,b,c){this.r=a,this.s=b,this.recovery=c,this.assertValidity()}static fromCompact(a){let c=b.nByteLength;return new n(m(a=b6("compactSignature",a,2*c),0,c),m(a,c,2*c))}static fromDER(a){let{r:b,s:c}=cT.toSig(b6("DER",a));return new n(b,c)}assertValidity(){ca("r",this.r,cV,d),ca("s",this.s,cV,d)}addRecoveryBit(a){return new n(this.r,this.s,a)}recoverPublicKey(a){let{r:e,s:f,recovery:i}=this,j=q(b6("msgHash",a));if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");let k=2===i||3===i?e+b.n:e;if(k>=c.ORDER)throw Error("recovery id 2 or 3 invalid");let m=(1&i)==0?"02":"03",n=h.fromHex(m+l(k)),o=cu(k,d),p=g(-j*o),r=g(f*o),s=h.BASE.multiplyAndAddUnsafe(n,p,r);if(!s)throw Error("point at infinify");return s.assertValidity(),s}hasHighS(){return this.s>d>>cV}normalizeS(){return this.hasHighS()?new n(this.r,g(-this.s),this.recovery):this}toDERRawBytes(){return b1(this.toDERHex())}toDERHex(){return cT.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return b1(this.toCompactHex())}toCompactHex(){return l(this.r)+l(this.s)}}function o(a){let b=bU(a),c="string"==typeof a,d=(b||c)&&a.length;return b?d===e||d===f:c?d===2*e||d===2*f:a instanceof h}let p=b.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let c=b2(a),d=8*a.length-b.nBitLength;return d>0?c>>BigInt(d):c},q=b.bits2int_modN||function(a){return g(p(a))},r=cc(b.nBitLength);function s(a){return ca("num < 2^"+b.nBitLength,a,cU,r),b4(a,b.nByteLength)}let t={lowS:b.lowS,prehash:!1},u={lowS:b.lowS,prehash:!1};return h.BASE._setWindowSize(8),{CURVE:b,getPublicKey:function(a,b=!0){return h.fromPrivateKey(a).toRawBytes(b)},getSharedSecret:function(a,b,c=!0){if(o(a))throw Error("first arg must be private key");if(!o(b))throw Error("second arg must be public key");return h.fromHex(b).multiply(i(a)).toRawBytes(c)},sign:function(a,e,f=t){let{seed:j,k2sig:l}=function(a,e,f=t){if(["recovered","canonical"].some(a=>a in f))throw Error("sign() legacy options not supported");let{hash:j,randomBytes:l}=b,{lowS:m,prehash:o,extraEntropy:r}=f;null==m&&(m=!0),a=b6("msgHash",a),cQ(f),o&&(a=b6("prehashed msgHash",j(a)));let u=q(a),v=i(e),w=[s(v),s(u)];if(null!=r&&!1!==r){let a=!0===r?l(c.BYTES):r;w.push(b6("extraEntropy",a))}return{seed:b7(...w),k2sig:function(a){let b=p(a);if(!k(b))return;let c=cu(b,d),e=h.BASE.multiply(b).toAffine(),f=g(e.x);if(f===cU)return;let i=g(c*g(u+f*v));if(i===cU)return;let j=2*(e.x!==f)|Number(e.y&cV),l=i;return m&&i>d>>cV&&(l=i>d>>cV?g(-i):i,j^=1),new n(f,l,j)}}}(a,e,f);return cf(b.hash.outputLen,b.nByteLength,b.hmac)(j,l)},verify:function(a,c,e,f=u){let i,j;c=b6("msgHash",c),e=b6("publicKey",e);let{lowS:k,prehash:l,format:m}=f;if(cQ(f),"strict"in f)throw Error("options.strict was renamed to lowS");if(void 0!==m&&"compact"!==m&&"der"!==m)throw Error("format must be compact or der");let o="string"==typeof a||bU(a),p=!o&&!m&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!o&&!p)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(p&&(i=new n(a.r,a.s)),o){try{"compact"!==m&&(i=n.fromDER(a))}catch(a){if(!(a instanceof cT.Err))throw a}i||"der"===m||(i=n.fromCompact(a))}j=h.fromHex(e)}catch{return!1}if(!i||k&&i.hasHighS())return!1;l&&(c=b.hash(c));let{r:r,s:s}=i,t=q(c),v=cu(s,d),w=g(t*v),x=g(r*v),y=h.BASE.multiplyAndAddUnsafe(j,w,x)?.toAffine();return!!y&&g(y.x)===r},ProjectivePoint:h,Signature:n,utils:{isValidPrivateKey(a){try{return i(a),!0}catch{return!1}},normPrivateKeyToScalar:i,randomPrivateKey:()=>{let a=cz(b.n);return function(a,b,c=!1){let d=a.length,e=cy(b),f=cz(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=cr(c?b3(a):b2(a),b-cl)+cl;return c?b5(g,e):b4(g,e)}(b.randomBytes(a),b.n)},precompute:(a=8,b=h.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}})({...a,hash:b,hmac:(a,...c)=>bK(b,a,function(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];au(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}(...c)),randomBytes:aH});({...c(b),create:c})}({a:cX.create(BigInt("-3")),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Fp:cX,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},bQ),"base16"),cZ="base64pad",c$="base64url";function c_(a){let b=bQ((0,X.fromString)(a,cY));return(0,W.toString)(b,cY)}function c0(a){let b=bQ((0,X.fromString)(a,"utf8"));return(0,W.toString)(b,cY)}function c1(a,b,c){return`${a}?wc_ev=${c}&topic=${b}`}var c2=Object.defineProperty,c3=Object.defineProperties,c4=Object.getOwnPropertyDescriptors,c5=Object.getOwnPropertySymbols,c6=Object.prototype.hasOwnProperty,c7=Object.prototype.propertyIsEnumerable,c8=(a,b,c)=>b in a?c2(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,c9=(a,b)=>{for(var c in b||(b={}))c6.call(b,c)&&c8(a,c,b[c]);if(c5)for(var c of c5(b))c7.call(b,c)&&c8(a,c,b[c]);return a},da=(a,b)=>c3(a,c4(b));function db(a){let b=[];return a.forEach(a=>{let[c,d]=a.split(":");b.push(`${c}:${d}`)}),b}function dc(a){return a.includes(":")}function dd(a){return dc(a)?a.split(":")[0]:a}function de(a){var b,c,d;let e={};if(!dl(a))return e;for(let[f,g]of Object.entries(a)){let a=dc(f)?[f]:g.chains,h=g.methods||[],i=g.events||[],j=dd(f);e[j]=da(c9({},e[j]),{chains:ap(a,null==(b=e[j])?void 0:b.chains),methods:ap(h,null==(c=e[j])?void 0:c.methods),events:ap(i,null==(d=e[j])?void 0:d.events)})}return e}function df(a,b){let c=function(a){let b={};return a?.forEach(a=>{var c;let[d,e]=a.split(":");b[d]||(b[d]={accounts:[],chains:[],events:[],methods:[]}),b[d].accounts.push(a),null==(c=b[d].chains)||c.push(`${d}:${e}`)}),b}(b=b.map(a=>a.replace("did:pkh:","")));for(let[b,d]of Object.entries(c))d.methods?d.methods=ap(d.methods,a):d.methods=a,d.events=["chainChanged","accountsChanged"];return c}let dg={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},dh={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function di(a,b){let{message:c,code:d}=dh[a];return{message:b?`${c} ${b}`:c,code:d}}function dj(a,b){let{message:c,code:d}=dg[a];return{message:b?`${c} ${b}`:c,code:d}}function dk(a,b){return!!Array.isArray(a)&&(!("u">typeof b)||!a.length||a.every(b))}function dl(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function dm(a){return typeof a>"u"}function dn(a,b){return!!(b&&dm(a))||"string"==typeof a&&!!a.trim().length}function dp(a,b){return!!(b&&dm(a))||"number"==typeof a&&!isNaN(a)}function dq(a){return!!(dn(a,!1)&&a.includes(":"))&&2===a.split(":").length}function dr(a){let b=!0;return dk(a)?a.length&&(b=a.every(a=>dn(a,!1))):b=!1,b}function ds(a,b){let c=null;return Object.values(a).forEach(a=>{var d;let e;if(c)return;let f=(d=`${b}, namespace`,e=null,dr(a?.methods)?dr(a?.events)||(e=dj("UNSUPPORTED_EVENTS",`${d}, events should be an array of strings or empty array for no events`)):e=dj("UNSUPPORTED_METHODS",`${d}, methods should be an array of strings or empty array for no methods`),e);f&&(c=f)}),c}function dt(a,b){let c=null;if(a&&dl(a)){let d,e=ds(a,b);e&&(c=e);let f=(d=null,Object.values(a).forEach(a=>{var c,e;let f;if(d)return;let g=(c=a?.accounts,e=`${b} namespace`,f=null,dk(c)?c.forEach(a=>{f||function(a){if(dn(a,!1)&&a.includes(":")){let b=a.split(":");if(3===b.length){let a=b[0]+":"+b[1];return!!b[2]&&dq(a)}}return!1}(a)||(f=dj("UNSUPPORTED_ACCOUNTS",`${e}, account ${a} should be a string and conform to "namespace:chainId:address" format`))}):f=dj("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),f);g&&(d=g)}),d);f&&(c=f)}else c=di("MISSING_OR_INVALID",`${b}, namespaces should be an object with data`);return c}function du(a){return dn(a.protocol,!0)}function dv(a){return"u">typeof a}function dw(a,b){return!(!dq(b)||!(function(a){let b=[];return Object.values(a).forEach(a=>{b.push(...db(a.accounts))}),b})(a).includes(b))}function dx(a,b,c){let d=null,e=function(a){let b={};return Object.keys(a).forEach(c=>{var d;c.includes(":")?b[c]=a[c]:null==(d=a[c].chains)||d.forEach(d=>{b[d]={methods:a[c].methods,events:a[c].events}})}),b}(a),f=function(a){let b={};return Object.keys(a).forEach(c=>{if(c.includes(":"))b[c]=a[c];else{let d=db(a[c].accounts);d?.forEach(d=>{b[d]={accounts:a[c].accounts.filter(a=>a.includes(`${d}:`)),methods:a[c].methods,events:a[c].events}})}}),b}(b),g=Object.keys(e),h=Object.keys(f),i=dy(Object.keys(a)),j=dy(Object.keys(b)),k=i.filter(a=>!j.includes(a));return k.length&&(d=di("NON_CONFORMING_NAMESPACES",`${c} namespaces keys don't satisfy requiredNamespaces.
      Required: ${k.toString()}
      Received: ${Object.keys(b).toString()}`)),ak(g,h)||(d=di("NON_CONFORMING_NAMESPACES",`${c} namespaces chains don't satisfy required namespaces.
      Required: ${g.toString()}
      Approved: ${h.toString()}`)),Object.keys(b).forEach(a=>{if(!a.includes(":")||d)return;let e=db(b[a].accounts);e.includes(a)||(d=di("NON_CONFORMING_NAMESPACES",`${c} namespaces accounts don't satisfy namespace accounts for ${a}
        Required: ${a}
        Approved: ${e.toString()}`))}),g.forEach(a=>{d||(ak(e[a].methods,f[a].methods)?ak(e[a].events,f[a].events)||(d=di("NON_CONFORMING_NAMESPACES",`${c} namespaces events don't satisfy namespace events for ${a}`)):d=di("NON_CONFORMING_NAMESPACES",`${c} namespaces methods don't satisfy namespace methods for ${a}`))}),d}function dy(a){return[...new Set(a.map(a=>a.includes(":")?a.split(":")[0]:a))]}let dz={};class dA{static get(a){return dz[a]}static set(a,b){dz[a]=b}static delete(a){delete dz[a]}}a.i(518307);var dB=a.i(327786),dC=a.i(860635);let dD="client",dE=`wc@2:${dD}:`,dF={name:dD,logger:"error"},dG="WALLETCONNECT_DEEPLINK_CHOICE",dH=(q.THIRTY_DAYS,"Proposal expired"),dI=q.SEVEN_DAYS,dJ={wc_sessionPropose:{req:{ttl:q.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1104},res:{ttl:q.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1106},res:{ttl:q.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:q.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:q.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1112},res:{ttl:q.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:q.ONE_DAY,prompt:!1,tag:1114},res:{ttl:q.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:q.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:q.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:q.FIVE_MINUTES,prompt:!1,tag:1119}}},dK={min:q.FIVE_MINUTES,max:q.SEVEN_DAYS},dL={idle:"IDLE",active:"ACTIVE"},dM={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},dN=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],dO="wc@1.5:auth:",dP=`${dO}:PUB_KEY`;var dQ=Object.defineProperty,dR=Object.defineProperties,dS=Object.getOwnPropertyDescriptors,dT=Object.getOwnPropertySymbols,dU=Object.prototype.hasOwnProperty,dV=Object.prototype.propertyIsEnumerable,dW=(a,b,c)=>b in a?dQ(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,dX=(a,b)=>{for(var c in b||(b={}))dU.call(b,c)&&dW(a,c,b[c]);if(dT)for(var c of dT(b))dV.call(b,c)&&dW(a,c,b[c]);return a},dY=(a,b)=>dR(a,dS(b)),dZ=(a,b,c)=>dW(a,"symbol"!=typeof b?b+"":b,c);class d$ extends p{constructor(b){super(b),dZ(this,"name","engine"),dZ(this,"events",new k.default),dZ(this,"initialized",!1),dZ(this,"requestQueue",{state:dL.idle,queue:[]}),dZ(this,"sessionRequestQueue",{state:dL.idle,queue:[]}),dZ(this,"requestQueueDelay",q.ONE_SECOND),dZ(this,"expectedPairingMethodMap",new Map),dZ(this,"recentlyDeletedMap",new Map),dZ(this,"recentlyDeletedLimit",200),dZ(this,"relayMessageCache",[]),dZ(this,"pendingSessions",new Map),dZ(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(dJ)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,q.toMiliseconds)(this.requestQueueDelay)))}),dZ(this,"connect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let b=dY(dX({},a),{requiredNamespaces:a.requiredNamespaces||{},optionalNamespaces:a.optionalNamespaces||{}});await this.isValidConnect(b),b.optionalNamespaces=function(a,b){var c,d,e,f,g,h;let i=de(a),j=de(b),k={};for(let a of Object.keys(i).concat(Object.keys(j)))k[a]={chains:ap(null==(c=i[a])?void 0:c.chains,null==(d=j[a])?void 0:d.chains),methods:ap(null==(e=i[a])?void 0:e.methods,null==(f=j[a])?void 0:f.methods),events:ap(null==(g=i[a])?void 0:g.events,null==(h=j[a])?void 0:h.events)};return k}(b.requiredNamespaces,b.optionalNamespaces),b.requiredNamespaces={};let{pairingTopic:c,requiredNamespaces:d,optionalNamespaces:e,sessionProperties:f,scopedProperties:h,relays:i}=b,j=c,k,l=!1;try{if(j){let a=this.client.core.pairing.pairings.get(j);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),l=a.active}}catch(a){throw this.client.logger.error(`connect() -> pairing.get(${j}) failed`),a}if(!j||!l){let{topic:a,uri:b}=await this.client.core.pairing.create();j=a,k=b}if(!j){let{message:a}=di("NO_MATCHING_KEY",`connect() pairing topic: ${j}`);throw Error(a)}let m=await this.client.core.crypto.generateKeyPair(),n=dJ.wc_sessionPropose.req.ttl||q.FIVE_MINUTES,o=am(n),p=dY(dX(dX({requiredNamespaces:d,optionalNamespaces:e,relays:i??[{protocol:g.RELAYER_DEFAULT_PROTOCOL}],proposer:{publicKey:m,metadata:this.client.metadata},expiryTimestamp:o,pairingTopic:j},f&&{sessionProperties:f}),h&&{scopedProperties:h}),{id:(0,dC.payloadId)()}),r=ao("session_connect",p.id),{reject:s,resolve:t,done:u}=al(n,dH),v=({id:a})=>{a===p.id&&(this.client.events.off("proposal_expire",v),this.pendingSessions.delete(p.id),this.events.emit(r,{error:{message:dH,code:0}}))};return this.client.events.on("proposal_expire",v),this.events.once(r,({error:a,session:b})=>{this.client.events.off("proposal_expire",v),a?s(a):b&&t(b)}),await this.sendRequest({topic:j,method:"wc_sessionPropose",params:p,throwOnFailedPublish:!0,clientRpcId:p.id}),await this.setProposal(p.id,p),{uri:k,approval:u}}),dZ(this,"pair",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(a)}catch(a){throw this.client.logger.error("pair() failed"),a}}),dZ(this,"approve",async a=>{var b,c,d;let e=this.client.core.eventClient.createEvent({properties:{topic:null==(b=a?.id)?void 0:b.toString(),trace:[g.EVENT_CLIENT_SESSION_TRACES.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(a){throw e.setError(g.EVENT_CLIENT_SESSION_ERRORS.no_internet_connection),a}try{await this.isValidProposalId(a?.id)}catch(b){throw this.client.logger.error(`approve() -> proposal.get(${a?.id}) failed`),e.setError(g.EVENT_CLIENT_SESSION_ERRORS.proposal_not_found),b}try{await this.isValidApprove(a)}catch(a){throw this.client.logger.error("approve() -> isValidApprove() failed"),e.setError(g.EVENT_CLIENT_SESSION_ERRORS.session_approve_namespace_validation_failure),a}let{id:f,relayProtocol:h,namespaces:i,sessionProperties:j,scopedProperties:k,sessionConfig:l}=a,m=this.client.proposal.get(f);this.client.core.eventClient.deleteEvent({eventId:e.eventId});let{pairingTopic:n,proposer:o,requiredNamespaces:p,optionalNamespaces:q}=m,r=null==(c=this.client.core.eventClient)?void 0:c.getEvent({topic:n});r||(r=null==(d=this.client.core.eventClient)?void 0:d.createEvent({type:g.EVENT_CLIENT_SESSION_TRACES.session_approve_started,properties:{topic:n,trace:[g.EVENT_CLIENT_SESSION_TRACES.session_approve_started,g.EVENT_CLIENT_SESSION_TRACES.session_namespaces_validation_success]}}));let s=await this.client.core.crypto.generateKeyPair(),t=o.publicKey,u=await this.client.core.crypto.generateSharedKey(s,t),v=dX(dX(dX({relay:{protocol:h??"irn"},namespaces:i,controller:{publicKey:s,metadata:this.client.metadata},expiry:am(dI)},j&&{sessionProperties:j}),k&&{scopedProperties:k}),l&&{sessionConfig:l}),w=g.TRANSPORT_TYPES.relay;r.addTrace(g.EVENT_CLIENT_SESSION_TRACES.subscribing_session_topic);try{await this.client.core.relayer.subscribe(u,{transportType:w})}catch(a){throw r.setError(g.EVENT_CLIENT_SESSION_ERRORS.subscribe_session_topic_failure),a}r.addTrace(g.EVENT_CLIENT_SESSION_TRACES.subscribe_session_topic_success);let x=dY(dX({},v),{topic:u,requiredNamespaces:p,optionalNamespaces:q,pairingTopic:n,acknowledged:!1,self:v.controller,peer:{publicKey:o.publicKey,metadata:o.metadata},controller:s,transportType:g.TRANSPORT_TYPES.relay});await this.client.session.set(u,x),r.addTrace(g.EVENT_CLIENT_SESSION_TRACES.store_session);try{r.addTrace(g.EVENT_CLIENT_SESSION_TRACES.publishing_session_settle),await this.sendRequest({topic:u,method:"wc_sessionSettle",params:v,throwOnFailedPublish:!0}).catch(a=>{throw r?.setError(g.EVENT_CLIENT_SESSION_ERRORS.session_settle_publish_failure),a}),r.addTrace(g.EVENT_CLIENT_SESSION_TRACES.session_settle_publish_success),r.addTrace(g.EVENT_CLIENT_SESSION_TRACES.publishing_session_approve),await this.sendResult({id:f,topic:n,result:{relay:{protocol:h??"irn"},responderPublicKey:s},throwOnFailedPublish:!0}).catch(a=>{throw r?.setError(g.EVENT_CLIENT_SESSION_ERRORS.session_approve_publish_failure),a}),r.addTrace(g.EVENT_CLIENT_SESSION_TRACES.session_approve_publish_success)}catch(a){throw this.client.logger.error(a),this.client.session.delete(u,dj("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(u),a}return this.client.core.eventClient.deleteEvent({eventId:r.eventId}),await this.client.core.pairing.updateMetadata({topic:n,metadata:o.metadata}),await this.client.proposal.delete(f,dj("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:n}),await this.setExpiry(u,am(dI)),{topic:u,acknowledged:()=>Promise.resolve(this.client.session.get(u))}}),dZ(this,"reject",async a=>{let b;this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(a)}catch(a){throw this.client.logger.error("reject() -> isValidReject() failed"),a}let{id:c,reason:d}=a;try{b=this.client.proposal.get(c).pairingTopic}catch(a){throw this.client.logger.error(`reject() -> proposal.get(${c}) failed`),a}b&&(await this.sendError({id:c,topic:b,error:d,rpcOpts:dJ.wc_sessionPropose.reject}),await this.client.proposal.delete(c,dj("USER_DISCONNECTED")))}),dZ(this,"update",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(a)}catch(a){throw this.client.logger.error("update() -> isValidUpdate() failed"),a}let{topic:b,namespaces:c}=a,{done:d,resolve:e,reject:f}=al(),g=(0,dC.payloadId)(),h=(0,dC.getBigIntRpcId)().toString(),i=this.client.session.get(b).namespaces;return this.events.once(ao("session_update",g),({error:a})=>{a?f(a):e()}),await this.client.session.update(b,{namespaces:c}),await this.sendRequest({topic:b,method:"wc_sessionUpdate",params:{namespaces:c},throwOnFailedPublish:!0,clientRpcId:g,relayRpcId:h}).catch(a=>{this.client.logger.error(a),this.client.session.update(b,{namespaces:i}),f(a)}),{acknowledged:d}}),dZ(this,"extend",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(a)}catch(a){throw this.client.logger.error("extend() -> isValidExtend() failed"),a}let{topic:b}=a,c=(0,dC.payloadId)(),{done:d,resolve:e,reject:f}=al();return this.events.once(ao("session_extend",c),({error:a})=>{a?f(a):e()}),await this.setExpiry(b,am(dI)),this.sendRequest({topic:b,method:"wc_sessionExtend",params:{},clientRpcId:c,throwOnFailedPublish:!0}).catch(a=>{f(a)}),{acknowledged:d}}),dZ(this,"request",async a=>{this.isInitialized();try{await this.isValidRequest(a)}catch(a){throw this.client.logger.error("request() -> isValidRequest() failed"),a}let{chainId:b,request:c,topic:d,expiry:e=dJ.wc_sessionRequest.req.ttl}=a,f=this.client.session.get(d);f?.transportType===g.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let h=(0,dC.payloadId)(),i=(0,dC.getBigIntRpcId)().toString(),{done:j,resolve:k,reject:l}=al(e,"Request expired. Please try again.");this.events.once(ao("session_request",h),({error:a,result:b})=>{a?l(a):k(b)});let m="wc_sessionRequest",n=this.getAppLinkIfEnabled(f.peer.metadata,f.transportType);if(n)return await this.sendRequest({clientRpcId:h,relayRpcId:i,topic:d,method:m,params:{request:dY(dX({},c),{expiryTimestamp:am(e)}),chainId:b},expiry:e,throwOnFailedPublish:!0,appLink:n}).catch(a=>l(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:h}),await j();let o={request:dY(dX({},c),{expiryTimestamp:am(e)}),chainId:b},p=this.shouldSetTVF(m,o);return await Promise.all([new Promise(async a=>{await this.sendRequest(dX({clientRpcId:h,relayRpcId:i,topic:d,method:m,params:o,expiry:e,throwOnFailedPublish:!0},p&&{tvf:this.getTVFParams(h,o)})).catch(a=>l(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:h}),a()}),new Promise(async a=>{var b;if(!(null!=(b=f.sessionConfig)&&b.disableDeepLink)){let a=await ar(this.client.core.storage,dG);await aq({id:h,topic:d,wcDeepLink:a})}a()}),j()]).then(a=>a[2])}),dZ(this,"respond",async a=>{this.isInitialized(),await this.isValidRespond(a);let{topic:b,response:c}=a,{id:d}=c,e=this.client.session.get(b);e.transportType===g.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let f=this.getAppLinkIfEnabled(e.peer.metadata,e.transportType);(0,dB.isJsonRpcResult)(c)?await this.sendResult({id:d,topic:b,result:c.result,throwOnFailedPublish:!0,appLink:f}):(0,dB.isJsonRpcError)(c)&&await this.sendError({id:d,topic:b,error:c.error,appLink:f}),this.cleanupAfterResponse(a)}),dZ(this,"ping",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(a)}catch(a){throw this.client.logger.error("ping() -> isValidPing() failed"),a}let{topic:b}=a;if(this.client.session.keys.includes(b)){let a=(0,dC.payloadId)(),c=(0,dC.getBigIntRpcId)().toString(),{done:d,resolve:e,reject:f}=al();this.events.once(ao("session_ping",a),({error:a})=>{a?f(a):e()}),await Promise.all([this.sendRequest({topic:b,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:c}),d()])}else this.client.core.pairing.pairings.keys.includes(b)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:b}))}),dZ(this,"emit",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(a);let{topic:b,event:c,chainId:d}=a,e=(0,dC.getBigIntRpcId)().toString(),f=(0,dC.payloadId)();await this.sendRequest({topic:b,method:"wc_sessionEvent",params:{event:c,chainId:d},throwOnFailedPublish:!0,relayRpcId:e,clientRpcId:f})}),dZ(this,"disconnect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(a);let{topic:b}=a;if(this.client.session.keys.includes(b))await this.sendRequest({topic:b,method:"wc_sessionDelete",params:dj("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:b,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(b))await this.client.core.pairing.disconnect({topic:b});else{let{message:a}=di("MISMATCHED_TOPIC",`Session or pairing topic not found: ${b}`);throw Error(a)}}),dZ(this,"find",a=>(this.isInitialized(),this.client.session.getAll().filter(b=>(function(a,b){let{requiredNamespaces:c}=b,d=Object.keys(a.namespaces),e=Object.keys(c),f=!0;return!!ak(e,d)&&(d.forEach(b=>{let{accounts:d,methods:e,events:g}=a.namespaces[b],h=db(d),i=c[b];ak(Z(b,i),h)&&ak(i.methods,e)&&ak(i.events,g)||(f=!1)}),f)})(b,a)))),dZ(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),dZ(this,"authenticate",async(a,b)=>{var c,d,e;let f;this.isInitialized(),this.isValidAuthenticate(a);let h=b&&this.client.core.linkModeSupportedApps.includes(b)&&(null==(c=this.client.metadata.redirect)?void 0:c.linkMode),i=h?g.TRANSPORT_TYPES.link_mode:g.TRANSPORT_TYPES.relay;i===g.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let{chains:j,statement:k="",uri:l,domain:m,nonce:n,type:o,exp:p,nbf:q,methods:r=[],expiry:s}=a,t=[...a.resources||[]],{topic:u,uri:v}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:i});this.client.logger.info({message:"Generated new pairing",pairing:{topic:u,uri:v}});let w=await this.client.core.crypto.generateKeyPair(),x=c_(w);if(await Promise.all([this.client.auth.authKeys.set(dP,{responseTopic:x,publicKey:w}),this.client.auth.pairingTopics.set(x,{topic:x,pairingTopic:u})]),await this.client.core.relayer.subscribe(x,{transportType:i}),this.client.logger.info(`sending request to new pairing topic: ${u}`),r.length>0){let{namespace:a}=Y(j[0]),b=bc(function(a,b,c,d={}){return c?.sort((a,b)=>a.localeCompare(b)),{att:{[a]:function(a,b,c={}){return Object.assign({},...(b=b?.sort((a,b)=>a.localeCompare(b))).map(b=>({[`${a}/${b}`]:[c]})))}(b,c,d)}}}(a,"request",r));bg(t)&&(d=b,e=t.pop(),b=bc(function(a,b){bb(a),bb(b);let c=Object.keys(a.att).concat(Object.keys(b.att)).sort((a,b)=>a.localeCompare(b)),d={att:{}};return c.forEach(c=>{var e,f;Object.keys((null==(e=a.att)?void 0:e[c])||{}).concat(Object.keys((null==(f=b.att)?void 0:f[c])||{})).sort((a,b)=>a.localeCompare(b)).forEach(e=>{var f,g;d.att[c]=a0(((a,b)=>{for(var c in b||(b={}))a3.call(b,c)&&a5(a,c,b[c]);if(a2)for(var c of a2(b))a4.call(b,c)&&a5(a,c,b[c]);return a})({},d.att[c]),a1({[e]:(null==(f=a.att[c])?void 0:f[e])||(null==(g=b.att[c])?void 0:g[e])}))})}),d}(bd(d),bd(e)))),t.push(b)}let y=s&&s>dJ.wc_sessionAuthenticate.req.ttl?s:dJ.wc_sessionAuthenticate.req.ttl,z={authPayload:{type:o??"caip122",chains:j,statement:k,aud:l,domain:m,version:"1",nonce:n,iat:new Date().toISOString(),exp:p,nbf:q,resources:t},requester:{publicKey:w,metadata:this.client.metadata},expiryTimestamp:am(y)},A={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:j,methods:[...new Set(["personal_sign",...r])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:u,proposer:{publicKey:w,metadata:this.client.metadata},expiryTimestamp:am(dJ.wc_sessionPropose.req.ttl),id:(0,dC.payloadId)()},{done:B,resolve:C,reject:D}=al(y,"Request expired"),E=(0,dC.payloadId)(),F=ao("session_connect",A.id),G=ao("session_request",E),H=async({error:a,session:b})=>{this.events.off(G,I),a?D(a):b&&C({session:b})},I=async a=>{var c,d,e;let f;if(await this.deletePendingAuthRequest(E,{message:"fulfilled",code:0}),a.error){let b=dj("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return a.error.code===b.code?void 0:(this.events.off(F,H),D(a.error.message))}await this.deleteProposal(A.id),this.events.off(F,H);let{cacaos:h,responder:j}=a.result,k=[],l=[];for(let a of h){await a9({cacao:a,projectId:this.client.core.projectId})||(this.client.logger.error(a,"Signature verification failed"),D(dj("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:b}=a,c=bg(b.resources),d=[a7(b.iss)],e=a8(b.iss);if(c){let a=be(c),b=bf(c);k.push(...a),d.push(...b)}for(let a of d)l.push(`${a}:${e}`)}let m=await this.client.core.crypto.generateSharedKey(w,j.publicKey);k.length>0&&(f={topic:m,acknowledged:!0,self:{publicKey:w,metadata:this.client.metadata},peer:j,controller:j.publicKey,expiry:am(dI),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:u,namespaces:df([...new Set(k)],[...new Set(l)]),transportType:i},await this.client.core.relayer.subscribe(m,{transportType:i}),await this.client.session.set(m,f),u&&await this.client.core.pairing.updateMetadata({topic:u,metadata:j.metadata}),f=this.client.session.get(m)),null!=(c=this.client.metadata.redirect)&&c.linkMode&&null!=(d=j.metadata.redirect)&&d.linkMode&&null!=(e=j.metadata.redirect)&&e.universal&&b&&(this.client.core.addLinkModeSupportedApp(j.metadata.redirect.universal),this.client.session.update(m,{transportType:g.TRANSPORT_TYPES.link_mode})),C({auths:h,session:f})};this.events.once(F,H),this.events.once(G,I);try{if(h){let a=(0,dC.formatJsonRpcRequest)("wc_sessionAuthenticate",z,E);this.client.core.history.set(u,a);let c=await this.client.core.crypto.encode("",a,{type:2,encoding:c$});f=c1(b,u,c)}else await Promise.all([this.sendRequest({topic:u,method:"wc_sessionAuthenticate",params:z,expiry:a.expiry,throwOnFailedPublish:!0,clientRpcId:E}),this.sendRequest({topic:u,method:"wc_sessionPropose",params:A,expiry:dJ.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:A.id})])}catch(a){throw this.events.off(F,H),this.events.off(G,I),a}return await this.setProposal(A.id,A),await this.setAuthRequest(E,{request:dY(dX({},z),{verifyContext:{}}),pairingTopic:u,transportType:i}),{uri:f??v,response:B}}),dZ(this,"approveSessionAuthenticate",async a=>{let b,{id:c,auths:d}=a,e=this.client.core.eventClient.createEvent({properties:{topic:c.toString(),trace:[g.EVENT_CLIENT_AUTHENTICATE_TRACES.authenticated_session_approve_started]}});try{this.isInitialized()}catch(a){throw e.setError(g.EVENT_CLIENT_AUTHENTICATE_ERRORS.no_internet_connection),a}let f=this.getPendingAuthRequest(c);if(!f)throw e.setError(g.EVENT_CLIENT_AUTHENTICATE_ERRORS.authenticated_session_pending_request_not_found),Error(`Could not find pending auth request with id ${c}`);let h=f.transportType||g.TRANSPORT_TYPES.relay;h===g.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let i=f.requester.publicKey,j=await this.client.core.crypto.generateKeyPair(),k=c_(i),l={type:1,receiverPublicKey:i,senderPublicKey:j},m=[],n=[];for(let a of d){if(!await a9({cacao:a,projectId:this.client.core.projectId})){e.setError(g.EVENT_CLIENT_AUTHENTICATE_ERRORS.invalid_cacao);let a=dj("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:c,topic:k,error:a,encodeOpts:l}),Error(a.message)}e.addTrace(g.EVENT_CLIENT_AUTHENTICATE_TRACES.cacaos_verified);let{p:b}=a,d=bg(b.resources),f=[a7(b.iss)],h=a8(b.iss);if(d){let a=be(d),b=bf(d);m.push(...a),f.push(...b)}for(let a of f)n.push(`${a}:${h}`)}let o=await this.client.core.crypto.generateSharedKey(j,i);if(e.addTrace(g.EVENT_CLIENT_AUTHENTICATE_TRACES.create_authenticated_session_topic),m?.length>0){b={topic:o,acknowledged:!0,self:{publicKey:j,metadata:this.client.metadata},peer:{publicKey:i,metadata:f.requester.metadata},controller:i,expiry:am(dI),authentication:d,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:f.pairingTopic,namespaces:df([...new Set(m)],[...new Set(n)]),transportType:h},e.addTrace(g.EVENT_CLIENT_AUTHENTICATE_TRACES.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(o,{transportType:h})}catch(a){throw e.setError(g.EVENT_CLIENT_AUTHENTICATE_ERRORS.subscribe_authenticated_session_topic_failure),a}e.addTrace(g.EVENT_CLIENT_AUTHENTICATE_TRACES.subscribe_authenticated_session_topic_success),await this.client.session.set(o,b),e.addTrace(g.EVENT_CLIENT_AUTHENTICATE_TRACES.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:f.requester.metadata})}e.addTrace(g.EVENT_CLIENT_AUTHENTICATE_TRACES.publishing_authenticated_session_approve);try{await this.sendResult({topic:k,id:c,result:{cacaos:d,responder:{publicKey:j,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(f.requester.metadata,h)})}catch(a){throw e.setError(g.EVENT_CLIENT_AUTHENTICATE_ERRORS.authenticated_session_approve_publish_failure),a}return await this.client.auth.requests.delete(c,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:f.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:e.eventId}),{session:b}}),dZ(this,"rejectSessionAuthenticate",async a=>{this.isInitialized();let{id:b,reason:c}=a,d=this.getPendingAuthRequest(b);if(!d)throw Error(`Could not find pending auth request with id ${b}`);d.transportType===g.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let e=d.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),h=c_(e);await this.sendError({id:b,topic:h,error:c,encodeOpts:{type:1,receiverPublicKey:e,senderPublicKey:f},rpcOpts:dJ.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(d.requester.metadata,d.transportType)}),await this.client.auth.requests.delete(b,{message:"rejected",code:0}),await this.client.proposal.delete(b,dj("USER_DISCONNECTED"))}),dZ(this,"formatAuthMessage",a=>{this.isInitialized();let{request:b,iss:c}=a;return ba(b,c)}),dZ(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{let a=this.relayMessageCache.shift();a&&await this.onRelayMessage(a)}catch(a){this.client.logger.error(a)}},50)}),dZ(this,"cleanupDuplicatePairings",async a=>{if(a.pairingTopic)try{let b=this.client.core.pairing.pairings.get(a.pairingTopic),c=this.client.core.pairing.pairings.getAll().filter(c=>{var d,e;return(null==(d=c.peerMetadata)?void 0:d.url)&&(null==(e=c.peerMetadata)?void 0:e.url)===a.peer.metadata.url&&c.topic&&c.topic!==b.topic});if(0===c.length)return;this.client.logger.info(`Cleaning up ${c.length} duplicate pairing(s)`),await Promise.all(c.map(a=>this.client.core.pairing.disconnect({topic:a.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(a){this.client.logger.error(a)}}),dZ(this,"deleteSession",async a=>{var b;let{topic:c,expirerHasDeleted:d=!1,emitEvent:e=!0,id:f=0}=a,{self:g}=this.client.session.get(c);await this.client.core.relayer.unsubscribe(c),await this.client.session.delete(c,dj("USER_DISCONNECTED")),this.addToRecentlyDeleted(c,"session"),this.client.core.crypto.keychain.has(g.publicKey)&&await this.client.core.crypto.deleteKeyPair(g.publicKey),this.client.core.crypto.keychain.has(c)&&await this.client.core.crypto.deleteSymKey(c),d||this.client.core.expirer.del(c),this.client.core.storage.removeItem(dG).catch(a=>this.client.logger.warn(a)),this.getPendingSessionRequests().forEach(a=>{a.topic===c&&this.deletePendingSessionRequest(a.id,dj("USER_DISCONNECTED"))}),c===(null==(b=this.sessionRequestQueue.queue[0])?void 0:b.topic)&&(this.sessionRequestQueue.state=dL.idle),e&&this.client.events.emit("session_delete",{id:f,topic:c})}),dZ(this,"deleteProposal",async(a,b)=>{if(b)try{let b=this.client.proposal.get(a),c=this.client.core.eventClient.getEvent({topic:b.pairingTopic});c?.setError(g.EVENT_CLIENT_SESSION_ERRORS.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(a,dj("USER_DISCONNECTED")),b?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"proposal")}),dZ(this,"deletePendingSessionRequest",async(a,b,c=!1)=>{await Promise.all([this.client.pendingRequest.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(b=>b.id!==a),c&&(this.sessionRequestQueue.state=dL.idle,this.client.events.emit("session_request_expire",{id:a}))}),dZ(this,"deletePendingAuthRequest",async(a,b,c=!1)=>{await Promise.all([this.client.auth.requests.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)])}),dZ(this,"setExpiry",async(a,b)=>{this.client.session.keys.includes(a)&&(this.client.core.expirer.set(a,b),await this.client.session.update(a,{expiry:b}))}),dZ(this,"setProposal",async(a,b)=>{this.client.core.expirer.set(a,am(dJ.wc_sessionPropose.req.ttl)),await this.client.proposal.set(a,b)}),dZ(this,"setAuthRequest",async(a,b)=>{let{request:c,pairingTopic:d,transportType:e=g.TRANSPORT_TYPES.relay}=b;this.client.core.expirer.set(a,c.expiryTimestamp),await this.client.auth.requests.set(a,{authPayload:c.authPayload,requester:c.requester,expiryTimestamp:c.expiryTimestamp,id:a,pairingTopic:d,verifyContext:c.verifyContext,transportType:e})}),dZ(this,"setPendingSessionRequest",async a=>{let{id:b,topic:c,params:d,verifyContext:e}=a,f=d.request.expiryTimestamp||am(dJ.wc_sessionRequest.req.ttl);this.client.core.expirer.set(b,f),await this.client.pendingRequest.set(b,{id:b,topic:c,params:d,verifyContext:e})}),dZ(this,"sendRequest",async b=>{let c,d,{topic:e,method:f,params:g,expiry:h,relayRpcId:i,clientRpcId:j,throwOnFailedPublish:k,appLink:l,tvf:m}=b,n=(0,dC.formatJsonRpcRequest)(f,g,j),o=!!l;try{let a=o?c$:cZ;c=await this.client.core.crypto.encode(e,n,{encoding:a})}catch(a){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${e} failed`),a}if(dN.includes(f)){let a=c0(JSON.stringify(n)),b=c0(c);d=await this.client.core.verify.register({id:b,decryptedId:a})}let p=dJ[f].req;if(p.attestation=d,h&&(p.ttl=h),i&&(p.id=i),this.client.core.history.set(e,n),o){let b=c1(l,e,c);await a.g.Linking.openURL(b,this.client.name)}else{let a=dJ[f].req;h&&(a.ttl=h),i&&(a.id=i),a.tvf=dY(dX({},m),{correlationId:n.id}),k?(a.internal=dY(dX({},a.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(e,c,a)):this.client.core.relayer.publish(e,c,a).catch(a=>this.client.logger.error(a))}return n.id}),dZ(this,"sendResult",async b=>{let c,d,e,{id:f,topic:g,result:h,throwOnFailedPublish:i,encodeOpts:j,appLink:k}=b,l=(0,dC.formatJsonRpcResult)(f,h),m=k&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a=m?c$:cZ;c=await this.client.core.crypto.encode(g,l,dY(dX({},j||{}),{encoding:a}))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${g} failed`),a}try{let a=(d=await this.client.core.history.get(g,f)).request;try{this.shouldSetTVF(a.method,a.params)&&(e=this.getTVFParams(f,a.params,h))}catch(a){this.client.logger.warn("sendResult() -> getTVFParams() failed",a)}}catch(a){throw this.client.logger.error(`sendResult() -> history.get(${g}, ${f}) failed`),a}if(m){let b=c1(k,g,c);await a.g.Linking.openURL(b,this.client.name)}else{let a=dJ[d.request.method].res;a.tvf=dY(dX({},e),{correlationId:f}),i?(a.internal=dY(dX({},a.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(g,c,a)):this.client.core.relayer.publish(g,c,a).catch(a=>this.client.logger.error(a))}await this.client.core.history.resolve(l)}),dZ(this,"sendError",async b=>{let c,d,{id:e,topic:f,error:g,encodeOpts:h,rpcOpts:i,appLink:j}=b,k=(0,dC.formatJsonRpcError)(e,g),l=j&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a=l?c$:cZ;c=await this.client.core.crypto.encode(f,k,dY(dX({},h||{}),{encoding:a}))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${f} failed`),a}try{d=await this.client.core.history.get(f,e)}catch(a){throw this.client.logger.error(`sendError() -> history.get(${f}, ${e}) failed`),a}if(l){let b=c1(j,f,c);await a.g.Linking.openURL(b,this.client.name)}else{let a=d.request.method,b=i||dJ[a].res;this.client.core.relayer.publish(f,c,b)}await this.client.core.history.resolve(k)}),dZ(this,"cleanup",async()=>{let a=[],b=[];this.client.session.getAll().forEach(b=>{let c=!1;an(b.expiry)&&(c=!0),this.client.core.crypto.keychain.has(b.topic)||(c=!0),c&&a.push(b.topic)}),this.client.proposal.getAll().forEach(a=>{an(a.expiryTimestamp)&&b.push(a.id)}),await Promise.all([...a.map(a=>this.deleteSession({topic:a})),...b.map(a=>this.deleteProposal(a))])}),dZ(this,"onProviderMessageEvent",async a=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(a):await this.onRelayMessage(a)}),dZ(this,"onRelayEventRequest",async a=>{this.requestQueue.queue.push(a),await this.processRequestsQueue()}),dZ(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===dL.active)return void this.client.logger.info("Request queue already active, skipping...");for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=dL.active;let a=this.requestQueue.queue.shift();if(a)try{await this.processRequest(a)}catch(a){this.client.logger.warn(a)}}this.requestQueue.state=dL.idle}),dZ(this,"processRequest",async a=>{let{topic:b,payload:c,attestation:d,transportType:e,encryptedId:f}=a,g=c.method;if(!this.shouldIgnorePairingRequest({topic:b,requestMethod:g}))switch(g){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:b,payload:c,attestation:d,encryptedId:f});case"wc_sessionSettle":return await this.onSessionSettleRequest(b,c);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(b,c);case"wc_sessionExtend":return await this.onSessionExtendRequest(b,c);case"wc_sessionPing":return await this.onSessionPingRequest(b,c);case"wc_sessionDelete":return await this.onSessionDeleteRequest(b,c);case"wc_sessionRequest":return await this.onSessionRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});case"wc_sessionEvent":return await this.onSessionEventRequest(b,c);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});default:return this.client.logger.info(`Unsupported request method ${g}`)}}),dZ(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c,transportType:d}=a,e=(await this.client.core.history.get(b,c.id)).request.method;switch(e){case"wc_sessionPropose":return this.onSessionProposeResponse(b,c,d);case"wc_sessionSettle":return this.onSessionSettleResponse(b,c);case"wc_sessionUpdate":return this.onSessionUpdateResponse(b,c);case"wc_sessionExtend":return this.onSessionExtendResponse(b,c);case"wc_sessionPing":return this.onSessionPingResponse(b,c);case"wc_sessionRequest":return this.onSessionRequestResponse(b,c);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(b,c);default:return this.client.logger.info(`Unsupported response method ${e}`)}}),dZ(this,"onRelayEventUnknownPayload",a=>{let{topic:b}=a,{message:c}=di("MISSING_OR_INVALID",`Decoded payload on topic ${b} is not identifiable as a JSON-RPC request or a response.`);throw Error(c)}),dZ(this,"shouldIgnorePairingRequest",a=>{let{topic:b,requestMethod:c}=a,d=this.expectedPairingMethodMap.get(b);return!(!d||d.includes(c))&&!!(d.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),dZ(this,"onSessionProposeRequest",async a=>{let{topic:b,payload:c,attestation:d,encryptedId:e}=a,{params:f,id:h}=c;try{let a=this.client.core.eventClient.getEvent({topic:b});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),a?.setError(g.EVENT_CLIENT_PAIRING_ERRORS.proposal_listener_not_found)),this.isValidConnect(dX({},c.params));let i=f.expiryTimestamp||am(dJ.wc_sessionPropose.req.ttl),j=dX({id:h,pairingTopic:b,expiryTimestamp:i},f);await this.setProposal(h,j);let k=await this.getVerifyContext({attestationId:d,hash:c0(JSON.stringify(c)),encryptedId:e,metadata:j.proposer.metadata});a?.addTrace(g.EVENT_CLIENT_PAIRING_TRACES.emit_session_proposal),this.client.events.emit("session_proposal",{id:h,params:j,verifyContext:k})}catch(a){await this.sendError({id:h,topic:b,error:a,rpcOpts:dJ.wc_sessionPropose.autoReject}),this.client.logger.error(a)}}),dZ(this,"onSessionProposeResponse",async(a,b,c)=>{let{id:d}=b;if((0,dB.isJsonRpcResult)(b)){let{result:e}=b;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:e});let f=this.client.proposal.get(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});let g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});let h=e.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});let i=await this.client.core.crypto.generateSharedKey(g,h);this.pendingSessions.set(d,{sessionTopic:i,pairingTopic:a,proposalId:d,publicKey:g});let j=await this.client.core.relayer.subscribe(i,{transportType:c});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:j}),await this.client.core.pairing.activate({topic:a})}else if((0,dB.isJsonRpcError)(b)){await this.client.proposal.delete(d,dj("USER_DISCONNECTED"));let a=ao("session_connect",d);if(0===this.events.listenerCount(a))throw Error(`emitting ${a} without any listeners, 954`);this.events.emit(a,{error:b.error})}}),dZ(this,"onSessionSettleRequest",async(a,b)=>{let{id:c,params:d}=b;try{this.isValidSessionSettleRequest(d);let{relay:c,controller:e,expiry:f,namespaces:h,sessionProperties:i,scopedProperties:j,sessionConfig:k}=b.params,l=[...this.pendingSessions.values()].find(b=>b.sessionTopic===a);if(!l)return this.client.logger.error(`Pending session not found for topic ${a}`);let m=this.client.proposal.get(l.proposalId),n=dY(dX(dX(dX({topic:a,relay:c,expiry:f,namespaces:h,acknowledged:!0,pairingTopic:l.pairingTopic,requiredNamespaces:m.requiredNamespaces,optionalNamespaces:m.optionalNamespaces,controller:e.publicKey,self:{publicKey:l.publicKey,metadata:this.client.metadata},peer:{publicKey:e.publicKey,metadata:e.metadata}},i&&{sessionProperties:i}),j&&{scopedProperties:j}),k&&{sessionConfig:k}),{transportType:g.TRANSPORT_TYPES.relay});await this.client.session.set(n.topic,n),await this.setExpiry(n.topic,n.expiry),await this.client.core.pairing.updateMetadata({topic:l.pairingTopic,metadata:n.peer.metadata}),this.client.events.emit("session_connect",{session:n}),this.events.emit(ao("session_connect",l.proposalId),{session:n}),this.pendingSessions.delete(l.proposalId),this.deleteProposal(l.proposalId,!1),this.cleanupDuplicatePairings(n),await this.sendResult({id:b.id,topic:a,result:!0,throwOnFailedPublish:!0})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),dZ(this,"onSessionSettleResponse",async(a,b)=>{let{id:c}=b;(0,dB.isJsonRpcResult)(b)?(await this.client.session.update(a,{acknowledged:!0}),this.events.emit(ao("session_approve",c),{})):(0,dB.isJsonRpcError)(b)&&(await this.client.session.delete(a,dj("USER_DISCONNECTED")),this.events.emit(ao("session_approve",c),{error:b.error}))}),dZ(this,"onSessionUpdateRequest",async(a,b)=>{let{params:c,id:d}=b;try{let b=`${a}_session_update`,e=dA.get(b);if(e&&this.isRequestOutOfSync(e,d)){this.client.logger.warn(`Discarding out of sync request - ${d}`),this.sendError({id:d,topic:a,error:dj("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(dX({topic:a},c));try{dA.set(b,d),await this.client.session.update(a,{namespaces:c.namespaces}),await this.sendResult({id:d,topic:a,result:!0,throwOnFailedPublish:!0})}catch(a){throw dA.delete(b),a}this.client.events.emit("session_update",{id:d,topic:a,params:c})}catch(b){await this.sendError({id:d,topic:a,error:b}),this.client.logger.error(b)}}),dZ(this,"isRequestOutOfSync",(a,b)=>b.toString().slice(0,-3)<a.toString().slice(0,-3)),dZ(this,"onSessionUpdateResponse",(a,b)=>{let{id:c}=b,d=ao("session_update",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,dB.isJsonRpcResult)(b)?this.events.emit(ao("session_update",c),{}):(0,dB.isJsonRpcError)(b)&&this.events.emit(ao("session_update",c),{error:b.error})}),dZ(this,"onSessionExtendRequest",async(a,b)=>{let{id:c}=b;try{this.isValidExtend({topic:a}),await this.setExpiry(a,am(dI)),await this.sendResult({id:c,topic:a,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),dZ(this,"onSessionExtendResponse",(a,b)=>{let{id:c}=b,d=ao("session_extend",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,dB.isJsonRpcResult)(b)?this.events.emit(ao("session_extend",c),{}):(0,dB.isJsonRpcError)(b)&&this.events.emit(ao("session_extend",c),{error:b.error})}),dZ(this,"onSessionPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult({id:c,topic:a,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),dZ(this,"onSessionPingResponse",(a,b)=>{let{id:c}=b,d=ao("session_ping",c);setTimeout(()=>{if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners 2176`);(0,dB.isJsonRpcResult)(b)?this.events.emit(ao("session_ping",c),{}):(0,dB.isJsonRpcError)(b)&&this.events.emit(ao("session_ping",c),{error:b.error})},500)}),dZ(this,"onSessionDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a,reason:b.params}),Promise.all([new Promise(b=>{this.client.core.relayer.once(g.RELAYER_EVENTS.publish,async()=>{b(await this.deleteSession({topic:a,id:c}))})}),this.sendResult({id:c,topic:a,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:a,error:dj("USER_DISCONNECTED")})]).catch(a=>this.client.logger.error(a))}catch(a){this.client.logger.error(a)}}),dZ(this,"onSessionRequest",async a=>{var b,c,d;let{topic:e,payload:f,attestation:h,encryptedId:i,transportType:j}=a,{id:k,params:l}=f;try{await this.isValidRequest(dX({topic:e},l));let a=this.client.session.get(e),f=await this.getVerifyContext({attestationId:h,hash:c0(JSON.stringify((0,dC.formatJsonRpcRequest)("wc_sessionRequest",l,k))),encryptedId:i,metadata:a.peer.metadata,transportType:j}),m={id:k,topic:e,params:l,verifyContext:f};await this.setPendingSessionRequest(m),j===g.TRANSPORT_TYPES.link_mode&&null!=(b=a.peer.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(null==(c=a.peer.metadata.redirect)?void 0:c.universal),null!=(d=this.client.signConfig)&&d.disableRequestQueue?this.emitSessionRequest(m):(this.addSessionRequestToSessionRequestQueue(m),this.processSessionRequestQueue())}catch(a){await this.sendError({id:k,topic:e,error:a}),this.client.logger.error(a)}}),dZ(this,"onSessionRequestResponse",(a,b)=>{let{id:c}=b,d=ao("session_request",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,dB.isJsonRpcResult)(b)?this.events.emit(ao("session_request",c),{result:b.result}):(0,dB.isJsonRpcError)(b)&&this.events.emit(ao("session_request",c),{error:b.error})}),dZ(this,"onSessionEventRequest",async(a,b)=>{let{id:c,params:d}=b;try{let b=`${a}_session_event_${d.event.name}`,e=dA.get(b);if(e&&this.isRequestOutOfSync(e,c))return void this.client.logger.info(`Discarding out of sync request - ${c}`);this.isValidEmit(dX({topic:a},d)),this.client.events.emit("session_event",{id:c,topic:a,params:d}),dA.set(b,c)}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),dZ(this,"onSessionAuthenticateResponse",(a,b)=>{let{id:c}=b;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:a,payload:b}),(0,dB.isJsonRpcResult)(b)?this.events.emit(ao("session_request",c),{result:b.result}):(0,dB.isJsonRpcError)(b)&&this.events.emit(ao("session_request",c),{error:b.error})}),dZ(this,"onSessionAuthenticateRequest",async a=>{var b;let{topic:c,payload:d,attestation:e,encryptedId:f,transportType:h}=a;try{let{requester:a,authPayload:i,expiryTimestamp:j}=d.params,k=await this.getVerifyContext({attestationId:e,hash:c0(JSON.stringify(d)),encryptedId:f,metadata:a.metadata,transportType:h}),l={requester:a,pairingTopic:c,id:d.id,authPayload:i,verifyContext:k,expiryTimestamp:j};await this.setAuthRequest(d.id,{request:l,pairingTopic:c,transportType:h}),h===g.TRANSPORT_TYPES.link_mode&&null!=(b=a.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(a.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:c,params:d.params,id:d.id,verifyContext:k})}catch(f){this.client.logger.error(f);let a=d.params.requester.publicKey,b=await this.client.core.crypto.generateKeyPair(),e=this.getAppLinkIfEnabled(d.params.requester.metadata,h);await this.sendError({id:d.id,topic:c,error:f,encodeOpts:{type:1,receiverPublicKey:a,senderPublicKey:b},rpcOpts:dJ.wc_sessionAuthenticate.autoReject,appLink:e})}}),dZ(this,"addSessionRequestToSessionRequestQueue",a=>{this.sessionRequestQueue.queue.push(a)}),dZ(this,"cleanupAfterResponse",a=>{this.deletePendingSessionRequest(a.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=dL.idle,this.processSessionRequestQueue()},(0,q.toMiliseconds)(this.requestQueueDelay))}),dZ(this,"cleanupPendingSentRequestsForTopic",({topic:a,error:b})=>{let c=this.client.core.history.pending;c.length>0&&c.filter(b=>b.topic===a&&"wc_sessionRequest"===b.request.method).forEach(a=>{let c=ao("session_request",a.request.id);if(0===this.events.listenerCount(c))throw Error(`emitting ${c} without any listeners`);this.events.emit(ao("session_request",a.request.id),{error:b})})}),dZ(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===dL.active)return void this.client.logger.info("session request queue is already active.");let a=this.sessionRequestQueue.queue[0];if(!a)return void this.client.logger.info("session request queue is empty.");try{this.sessionRequestQueue.state=dL.active,this.emitSessionRequest(a)}catch(a){this.client.logger.error(a)}}),dZ(this,"emitSessionRequest",a=>{this.client.events.emit("session_request",a)}),dZ(this,"onPairingCreated",a=>{if(a.methods&&this.expectedPairingMethodMap.set(a.topic,a.methods),a.active)return;let b=this.client.proposal.getAll().find(b=>b.pairingTopic===a.topic);b&&this.onSessionProposeRequest({topic:a.topic,payload:(0,dC.formatJsonRpcRequest)("wc_sessionPropose",dY(dX({},b),{requiredNamespaces:b.requiredNamespaces,optionalNamespaces:b.optionalNamespaces,relays:b.relays,proposer:b.proposer,sessionProperties:b.sessionProperties,scopedProperties:b.scopedProperties}),b.id)})}),dZ(this,"isValidConnect",async a=>{if(!dv(a)){let{message:b}=di("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(a)}`);throw Error(b)}let{pairingTopic:b,requiredNamespaces:c,optionalNamespaces:d,sessionProperties:e,scopedProperties:f,relays:g}=a;if(dm(b)||await this.isValidPairingTopic(b),!function(a,b){let c=!1;return b&&!a?c=!0:a&&dk(a)&&a.length&&a.forEach(a=>{c=du(a)}),c}(g,!0)){let{message:a}=di("MISSING_OR_INVALID",`connect() relays: ${g}`);throw Error(a)}if(!dm(c)&&0!==dl(c)){let a="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(a):this.client.logger.warn(a),this.validateNamespaces(c,"requiredNamespaces")}if(dm(d)||0===dl(d)||this.validateNamespaces(d,"optionalNamespaces"),dm(e)||this.validateSessionProps(e,"sessionProperties"),!dm(f)){this.validateSessionProps(f,"scopedProperties");let a=Object.keys(c||{}).concat(Object.keys(d||{}));if(!Object.keys(f).every(b=>a.includes(b)))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(f)}, required/optional namespaces: ${JSON.stringify(a)}`)}}),dZ(this,"validateNamespaces",(a,b)=>{let c=function(a,b,c){let d=null;if(a&&dl(a)){let e,f=ds(a,b);f&&(d=f);let g=(e=null,Object.entries(a).forEach(([a,d])=>{var f,g;let h;if(e)return;let i=(f=Z(a,d),g=`${b} ${c}`,h=null,dk(f)&&f.length?f.forEach(a=>{h||dq(a)||(h=dj("UNSUPPORTED_CHAINS",`${g}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):dq(a)||(h=dj("UNSUPPORTED_CHAINS",`${g}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),h);i&&(e=i)}),e);g&&(d=g)}else d=di("MISSING_OR_INVALID",`${b}, ${c} should be an object with data`);return d}(a,"connect()",b);if(c)throw Error(c.message)}),dZ(this,"isValidApprove",async a=>{if(!dv(a))throw Error(di("MISSING_OR_INVALID",`approve() params: ${a}`).message);let{id:b,namespaces:c,relayProtocol:d,sessionProperties:e,scopedProperties:f}=a;this.checkRecentlyDeleted(b),await this.isValidProposalId(b);let g=this.client.proposal.get(b),h=dt(c,"approve()");if(h)throw Error(h.message);let i=dx(g.requiredNamespaces,c,"approve()");if(i)throw Error(i.message);if(!dn(d,!0)){let{message:a}=di("MISSING_OR_INVALID",`approve() relayProtocol: ${d}`);throw Error(a)}if(dm(e)||this.validateSessionProps(e,"sessionProperties"),!dm(f)){this.validateSessionProps(f,"scopedProperties");let a=new Set(Object.keys(c));if(!Object.keys(f).every(b=>a.has(b)))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(f)}, approved namespaces: ${Array.from(a).join(", ")}`)}}),dZ(this,"isValidReject",async a=>{if(!dv(a)){let{message:b}=di("MISSING_OR_INVALID",`reject() params: ${a}`);throw Error(b)}let{id:b,reason:c}=a;if(this.checkRecentlyDeleted(b),await this.isValidProposalId(b),!function(a){return!(!a||"object"!=typeof a||!a.code||!dp(a.code,!1)||!a.message||!dn(a.message,!1))}(c)){let{message:a}=di("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(c)}`);throw Error(a)}}),dZ(this,"isValidSessionSettleRequest",a=>{if(!dv(a)){let{message:b}=di("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${a}`);throw Error(b)}let{relay:b,controller:c,namespaces:d,expiry:e}=a;if(!du(b)){let{message:a}=di("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw Error(a)}let f=function(a,b){let c=null;return dn(a?.publicKey,!1)||(c=di("MISSING_OR_INVALID",`${b} controller public key should be a string`)),c}(c,"onSessionSettleRequest()");if(f)throw Error(f.message);let g=dt(d,"onSessionSettleRequest()");if(g)throw Error(g.message);if(an(e)){let{message:a}=di("EXPIRED","onSessionSettleRequest()");throw Error(a)}}),dZ(this,"isValidUpdate",async a=>{if(!dv(a)){let{message:b}=di("MISSING_OR_INVALID",`update() params: ${a}`);throw Error(b)}let{topic:b,namespaces:c}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b);let d=this.client.session.get(b),e=dt(c,"update()");if(e)throw Error(e.message);let f=dx(d.requiredNamespaces,c,"update()");if(f)throw Error(f.message)}),dZ(this,"isValidExtend",async a=>{if(!dv(a)){let{message:b}=di("MISSING_OR_INVALID",`extend() params: ${a}`);throw Error(b)}let{topic:b}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b)}),dZ(this,"isValidRequest",async a=>{if(!dv(a)){let{message:b}=di("MISSING_OR_INVALID",`request() params: ${a}`);throw Error(b)}let{topic:b,request:c,chainId:d,expiry:e}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b);let{namespaces:f}=this.client.session.get(b);if(!dw(f,d)){let{message:a}=di("MISSING_OR_INVALID",`request() chainId: ${d}`);throw Error(a)}if(!function(a){return!(dm(a)||!dn(a.method,!1))}(c)){let{message:a}=di("MISSING_OR_INVALID",`request() ${JSON.stringify(c)}`);throw Error(a)}if(!function(a,b,c){return!!dn(c,!1)&&(function(a,b){let c=[];return Object.values(a).forEach(a=>{db(a.accounts).includes(b)&&c.push(...a.methods)}),c})(a,b).includes(c)}(f,d,c.method)){let{message:a}=di("MISSING_OR_INVALID",`request() method: ${c.method}`);throw Error(a)}if(e&&!function(a,b){return dp(a,!1)&&a<=b.max&&a>=b.min}(e,dK)){let{message:a}=di("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${dK.min} and ${dK.max}`);throw Error(a)}}),dZ(this,"isValidRespond",async a=>{var b;if(!dv(a)){let{message:b}=di("MISSING_OR_INVALID",`respond() params: ${a}`);throw Error(b)}let{topic:c,response:d}=a;try{await this.isValidSessionTopic(c)}catch(c){throw null!=(b=a?.response)&&b.id&&this.cleanupAfterResponse(a),c}if(!function(a){return!(dm(a)||dm(a.result)&&dm(a.error)||!dp(a.id,!1)||!dn(a.jsonrpc,!1))}(d)){let{message:a}=di("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(d)}`);throw Error(a)}}),dZ(this,"isValidPing",async a=>{if(!dv(a)){let{message:b}=di("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),dZ(this,"isValidEmit",async a=>{if(!dv(a)){let{message:b}=di("MISSING_OR_INVALID",`emit() params: ${a}`);throw Error(b)}let{topic:b,event:c,chainId:d}=a;await this.isValidSessionTopic(b);let{namespaces:e}=this.client.session.get(b);if(!dw(e,d)){let{message:a}=di("MISSING_OR_INVALID",`emit() chainId: ${d}`);throw Error(a)}if(!function(a){return!(dm(a)||!dn(a.name,!1))}(c)||!function(a,b,c){return!!dn(c,!1)&&(function(a,b){let c=[];return Object.values(a).forEach(a=>{db(a.accounts).includes(b)&&c.push(...a.events)}),c})(a,b).includes(c)}(e,d,c.name)){let{message:a}=di("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(c)}`);throw Error(a)}}),dZ(this,"isValidDisconnect",async a=>{if(!dv(a)){let{message:b}=di("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),dZ(this,"isValidAuthenticate",a=>{let{chains:b,uri:c,domain:d,nonce:e}=a;if(!Array.isArray(b)||0===b.length)throw Error("chains is required and must be a non-empty array");if(!dn(c,!1))throw Error("uri is required parameter");if(!dn(d,!1))throw Error("domain is required parameter");if(!dn(e,!1))throw Error("nonce is required parameter");if([...new Set(b.map(a=>Y(a).namespace))].length>1)throw Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:f}=Y(b[0]);if("eip155"!==f)throw Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),dZ(this,"getVerifyContext",async a=>{let{attestationId:b,hash:c,encryptedId:d,metadata:e,transportType:f}=a,h={verified:{verifyUrl:e.verifyUrl||g.VERIFY_SERVER,validation:"UNKNOWN",origin:e.url||""}};try{if(f===g.TRANSPORT_TYPES.link_mode){let a=this.getAppLinkIfEnabled(e,f);return h.verified.validation=a&&new URL(a).origin===new URL(e.url).origin?"VALID":"INVALID",h}let a=await this.client.core.verify.resolve({attestationId:b,hash:c,encryptedId:d,verifyUrl:e.verifyUrl});a&&(h.verified.origin=a.origin,h.verified.isScam=a.isScam,h.verified.validation=a.origin===new URL(e.url).origin?"VALID":"INVALID")}catch(a){this.client.logger.warn(a)}return this.client.logger.debug(`Verify context: ${JSON.stringify(h)}`),h}),dZ(this,"validateSessionProps",(a,b)=>{Object.values(a).forEach((c,d)=>{if(null==c){let{message:e}=di("MISSING_OR_INVALID",`${b} must contain an existing value for each key. Received: ${c} for key ${Object.keys(a)[d]}`);throw Error(e)}})}),dZ(this,"getPendingAuthRequest",a=>{let b=this.client.auth.requests.get(a);return"object"==typeof b?b:void 0}),dZ(this,"addToRecentlyDeleted",(a,b)=>{if(this.recentlyDeletedMap.set(a,b),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let a=0,b=this.recentlyDeletedLimit/2;for(let c of this.recentlyDeletedMap.keys()){if(a++>=b)break;this.recentlyDeletedMap.delete(c)}}}),dZ(this,"checkRecentlyDeleted",a=>{let b=this.recentlyDeletedMap.get(a);if(b){let{message:c}=di("MISSING_OR_INVALID",`Record was recently deleted - ${b}: ${a}`);throw Error(c)}}),dZ(this,"isLinkModeEnabled",(b,c)=>{var d,e,f,h,i,j,k,l,m;return!!b&&c===g.TRANSPORT_TYPES.link_mode&&(null==(e=null==(d=this.client.metadata)?void 0:d.redirect)?void 0:e.linkMode)===!0&&(null==(h=null==(f=this.client.metadata)?void 0:f.redirect)?void 0:h.universal)!==void 0&&(null==(j=null==(i=this.client.metadata)?void 0:i.redirect)?void 0:j.universal)!==""&&(null==(k=b?.redirect)?void 0:k.universal)!==void 0&&(null==(l=b?.redirect)?void 0:l.universal)!==""&&(null==(m=b?.redirect)?void 0:m.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(b.redirect.universal)&&"u">typeof(null==a.g?void 0:a.g.Linking)}),dZ(this,"getAppLinkIfEnabled",(a,b)=>{var c;return this.isLinkModeEnabled(a,b)?null==(c=a?.redirect)?void 0:c.universal:void 0}),dZ(this,"handleLinkModeMessage",({url:a})=>{if(!a||!a.includes("wc_ev")||!a.includes("topic"))return;let b=as(a,"topic")||"",c=decodeURIComponent(as(a,"wc_ev")||""),d=this.client.session.keys.includes(b);d&&this.client.session.update(b,{transportType:g.TRANSPORT_TYPES.link_mode}),this.client.core.dispatchEnvelope({topic:b,message:c,sessionExists:d})}),dZ(this,"registerLinkModeListeners",async()=>{var b;if("u">typeof process&&"true"===process.env.IS_VITEST||ai()&&null!=(b=this.client.metadata.redirect)&&b.linkMode){let b=null==a.g?void 0:a.g.Linking;if("u">typeof b){b.addEventListener("url",this.handleLinkModeMessage,this.client.name);let a=await b.getInitialURL();a&&setTimeout(()=>{this.handleLinkModeMessage({url:a})},50)}}}),dZ(this,"shouldSetTVF",(a,b)=>{if(!b||"wc_sessionRequest"!==a)return!1;let{request:c}=b;return Object.keys(dM).includes(c.method)}),dZ(this,"getTVFParams",(a,b,c)=>{var d,e;try{let f=b.request.method,g=this.extractTxHashesFromResult(f,c);return dY(dX({correlationId:a,rpcMethods:[f],chainId:b.chainId},this.isValidContractData(b.request.params)&&{contractAddresses:[null==(e=null==(d=b.request.params)?void 0:d[0])?void 0:e.to]}),{txHashes:g})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),dZ(this,"isValidContractData",a=>{var b;if(!a)return!1;try{let c=a?.data||(null==(b=a?.[0])?void 0:b.data);if(!c.startsWith("0x"))return!1;let d=c.slice(2);return!!/^[0-9a-fA-F]*$/.test(d)&&d.length%2==0}catch{}return!1}),dZ(this,"extractTxHashesFromResult",(a,b)=>{try{let c=dM[a];if("string"==typeof b)return[b];let d=b[c.key];if(dk(d))return"solana_signAllTransactions"===a?d.map(a=>(function(a){let b=atob(a),c=new Uint8Array(b.length);for(let a=0;a<b.length;a++)c[a]=b.charCodeAt(a);let d=c[0];if(0===d)throw Error("No signatures found");if(c.length<1+64*d)throw Error("Transaction data too short for claimed signature count");if(c.length<100)throw Error("Transaction too short");let e=Buffer.from(a,"base64").slice(1,65);return V.default.encode(e)})(a)):d;if("string"==typeof d)return[d]}catch(a){this.client.logger.warn("Error extracting tx hashes from result",a)}return[]})}async processPendingMessageEvents(){try{let a=this.client.session.keys,b=this.client.core.relayer.messages.getWithoutAck(a);for(let[a,c]of Object.entries(b))for(let b of c)try{await this.onProviderMessageEvent({topic:a,message:b,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${a}, message: ${b}`)}}catch(a){this.client.logger.warn("processPendingMessageEvents failed",a)}}isInitialized(){if(!this.initialized){let{message:a}=di("NOT_INITIALIZED",this.name);throw Error(a)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(g.RELAYER_EVENTS.message,a=>{this.onProviderMessageEvent(a)})}async onRelayMessage(a){let{topic:b,message:c,attestation:d,transportType:e}=a,{publicKey:f}=this.client.auth.authKeys.keys.includes(dP)?this.client.auth.authKeys.get(dP):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(b,c,{receiverPublicKey:f,encoding:e===g.TRANSPORT_TYPES.link_mode?c$:cZ});(0,dB.isJsonRpcRequest)(a)?(this.client.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a,attestation:d,transportType:e,encryptedId:c0(c)})):(0,dB.isJsonRpcResponse)(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a,transportType:e}),this.client.core.history.delete(b,a.id)):await this.onRelayEventUnknownPayload({topic:b,payload:a,transportType:e}),await this.client.core.relayer.messages.ack(b,c)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(g.EXPIRER_EVENTS.expired,async a=>{let{topic:b,id:c}=function(a){let[b,c]=a.split(":"),d={id:void 0,topic:void 0};if("topic"===b&&"string"==typeof c)d.topic=c;else if("id"===b&&Number.isInteger(Number(c)))d.id=Number(c);else throw Error(`Invalid target, expected id:number or topic:string, got ${b}:${c}`);return d}(a.target);return c&&this.client.pendingRequest.keys.includes(c)?await this.deletePendingSessionRequest(c,di("EXPIRED"),!0):c&&this.client.auth.requests.keys.includes(c)?await this.deletePendingAuthRequest(c,di("EXPIRED"),!0):void(b?this.client.session.keys.includes(b)&&(await this.deleteSession({topic:b,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:b})):c&&(await this.deleteProposal(c,!0),this.client.events.emit("proposal_expire",{id:c})))})}registerPairingEvents(){this.client.core.pairing.events.on(g.PAIRING_EVENTS.create,a=>this.onPairingCreated(a)),this.client.core.pairing.events.on(g.PAIRING_EVENTS.delete,a=>{this.addToRecentlyDeleted(a.topic,"pairing")})}isValidPairingTopic(a){if(!dn(a,!1)){let{message:b}=di("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.client.core.pairing.pairings.keys.includes(a)){let{message:b}=di("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(an(this.client.core.pairing.pairings.get(a).expiry)){let{message:b}=di("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}async isValidSessionTopic(a){if(!dn(a,!1)){let{message:b}=di("MISSING_OR_INVALID",`session topic should be a string: ${a}`);throw Error(b)}if(this.checkRecentlyDeleted(a),!this.client.session.keys.includes(a)){let{message:b}=di("NO_MATCHING_KEY",`session topic doesn't exist: ${a}`);throw Error(b)}if(an(this.client.session.get(a).expiry)){await this.deleteSession({topic:a});let{message:b}=di("EXPIRED",`session topic: ${a}`);throw Error(b)}if(!this.client.core.crypto.keychain.has(a)){let{message:b}=di("MISSING_OR_INVALID",`session topic does not exist in keychain: ${a}`);throw await this.deleteSession({topic:a}),Error(b)}}async isValidSessionOrPairingTopic(a){if(this.checkRecentlyDeleted(a),this.client.session.keys.includes(a))await this.isValidSessionTopic(a);else if(this.client.core.pairing.pairings.keys.includes(a))this.isValidPairingTopic(a);else if(dn(a,!1)){let{message:b}=di("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${a}`);throw Error(b)}else{let{message:b}=di("MISSING_OR_INVALID",`session or pairing topic should be a string: ${a}`);throw Error(b)}}async isValidProposalId(a){if("number"!=typeof a){let{message:b}=di("MISSING_OR_INVALID",`proposal id should be a number: ${a}`);throw Error(b)}if(!this.client.proposal.keys.includes(a)){let{message:b}=di("NO_MATCHING_KEY",`proposal id doesn't exist: ${a}`);throw Error(b)}if(an(this.client.proposal.get(a).expiryTimestamp)){await this.deleteProposal(a);let{message:b}=di("EXPIRED",`proposal id: ${a}`);throw Error(b)}}}class d_ extends g.Store{constructor(a,b){super(a,b,"proposal",dE),this.core=a,this.logger=b}}class d0 extends g.Store{constructor(a,b){super(a,b,"session",dE),this.core=a,this.logger=b}}class d1 extends g.Store{constructor(a,b){super(a,b,"request",dE,a=>a.id),this.core=a,this.logger=b}}class d2 extends g.Store{constructor(a,b){super(a,b,"authKeys",dO,()=>dP),this.core=a,this.logger=b}}class d3 extends g.Store{constructor(a,b){super(a,b,"pairingTopics",dO),this.core=a,this.logger=b}}class d4 extends g.Store{constructor(a,b){super(a,b,"requests",dO,a=>a.id),this.core=a,this.logger=b}}var d5=Object.defineProperty,d6=(a,b,c)=>((a,b,c)=>b in a?d5(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class d7{constructor(a,b){this.core=a,this.logger=b,d6(this,"authKeys"),d6(this,"pairingTopics"),d6(this,"requests"),this.authKeys=new d2(this.core,this.logger),this.pairingTopics=new d3(this.core,this.logger),this.requests=new d4(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var d8=Object.defineProperty,d9=(a,b,c)=>((a,b,c)=>b in a?d8(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class ea extends o{constructor(a){super(a),d9(this,"protocol","wc"),d9(this,"version",2),d9(this,"name",dF.name),d9(this,"metadata"),d9(this,"core"),d9(this,"logger"),d9(this,"events",new k.EventEmitter),d9(this,"engine"),d9(this,"session"),d9(this,"proposal"),d9(this,"pendingRequest"),d9(this,"auth"),d9(this,"signConfig"),d9(this,"on",(a,b)=>this.events.on(a,b)),d9(this,"once",(a,b)=>this.events.once(a,b)),d9(this,"off",(a,b)=>this.events.off(a,b)),d9(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),d9(this,"removeAllListeners",a=>this.events.removeAllListeners(a)),d9(this,"connect",async a=>{try{return await this.engine.connect(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"pair",async a=>{try{return await this.engine.pair(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"approve",async a=>{try{return await this.engine.approve(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"reject",async a=>{try{return await this.engine.reject(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"update",async a=>{try{return await this.engine.update(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"extend",async a=>{try{return await this.engine.extend(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"request",async a=>{try{return await this.engine.request(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"respond",async a=>{try{return await this.engine.respond(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"ping",async a=>{try{return await this.engine.ping(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"emit",async a=>{try{return await this.engine.emit(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"disconnect",async a=>{try{return await this.engine.disconnect(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"find",a=>{try{return this.engine.find(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(a){throw this.logger.error(a.message),a}}),d9(this,"authenticate",async(a,b)=>{try{return await this.engine.authenticate(a,b)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"formatAuthMessage",a=>{try{return this.engine.formatAuthMessage(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"approveSessionAuthenticate",async a=>{try{return await this.engine.approveSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),d9(this,"rejectSessionAuthenticate",async a=>{try{return await this.engine.rejectSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),this.name=a?.name||dF.name,this.metadata=function(a){var b,c;let d=(0,s.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]};try{let e,f;return null!=a&&a.url&&d.url&&new URL(a.url).host!==new URL(d.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${a.url} differs from the actual page url:${d.url}. This is probably unintended and can lead to issues.`),a.url=d.url),null!=(b=a?.icons)&&b.length&&a.icons.length>0&&(a.icons=a.icons.filter(a=>""!==a)),e=af(af({},d),a),f={url:a?.url||d.url,name:a?.name||d.name,description:a?.description||d.description,icons:null!=(c=a?.icons)&&c.length&&a.icons.length>0?a.icons:d.icons},_(e,aa(f))}catch(b){return console.warn("Error populating app metadata",b),a||d}}(a?.metadata),this.signConfig=a?.signConfig;let b="u">typeof a?.logger&&"string"!=typeof a?.logger?a.logger:(0,i.pino)((0,h.getDefaultLoggerOptions)({level:a?.logger||dF.logger}));this.core=a?.core||new g.Core(a),this.logger=(0,h.generateChildLogger)(b,this.name),this.session=new d0(this.core,this.logger),this.proposal=new d_(this.core,this.logger),this.pendingRequest=new d1(this.core,this.logger),this.engine=new d$(this),this.auth=new d7(this.core,this.logger)}static async init(a){let b=new ea(a);return await b.initialize(),b}get context(){return(0,h.getLoggerContext)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},(0,q.toMiliseconds)(q.ONE_SECOND))}catch(a){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(a.message),a}}}var eb=a.i(66814),ec=a.i(258699);let ed="error",ee="wc@2:universal_provider:",ef="https://rpc.walletconnect.org/v1/",eg="generic",eh=`${ef}bundler`,ei={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function ej(){}function ek(a){return null==a||"object"!=typeof a&&"function"!=typeof a}function el(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function em(a){return"object"==typeof a&&null!==a}function en(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function eo(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let ep="[object String]",eq="[object Number]",er="[object Boolean]",es="[object Arguments]";function et(a,b,c,d=new Map,e){let f=e?.(a,b,c,d);if(null!=f)return f;if(ek(a))return a;if(d.has(a))return d.get(a);if(Array.isArray(a)){let b=Array(a.length);d.set(a,b);for(let f=0;f<a.length;f++)b[f]=et(a[f],f,c,d,e);return Object.hasOwn(a,"index")&&(b.index=a.index),Object.hasOwn(a,"input")&&(b.input=a.input),b}if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp){let b=new RegExp(a.source,a.flags);return b.lastIndex=a.lastIndex,b}if(a instanceof Map){let b=new Map;for(let[f,g]of(d.set(a,b),a))b.set(f,et(g,f,c,d,e));return b}if(a instanceof Set){let b=new Set;for(let f of(d.set(a,b),a))b.add(et(f,void 0,c,d,e));return b}if("u">typeof Buffer&&Buffer.isBuffer(a))return a.subarray();if(el(a)){let b=new(Object.getPrototypeOf(a)).constructor(a.length);d.set(a,b);for(let f=0;f<a.length;f++)b[f]=et(a[f],f,c,d,e);return b}if(a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);if(a instanceof DataView){let b=new DataView(a.buffer.slice(0),a.byteOffset,a.byteLength);return d.set(a,b),eu(b,a,c,d,e),b}if("u">typeof File&&a instanceof File){let b=new File([a],a.name,{type:a.type});return d.set(a,b),eu(b,a,c,d,e),b}if(a instanceof Blob){let b=new Blob([a],{type:a.type});return d.set(a,b),eu(b,a,c,d,e),b}if(a instanceof Error){let b=new a.constructor;return d.set(a,b),b.message=a.message,b.name=a.name,b.stack=a.stack,b.cause=a.cause,eu(b,a,c,d,e),b}if("object"==typeof a&&function(a){switch(eo(a)){case es:case"[object Array]":case"[object ArrayBuffer]":case"[object DataView]":case er:case"[object Date]":case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Map]":case eq:case"[object Object]":case"[object RegExp]":case"[object Set]":case ep:case"[object Symbol]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return!0;default:return!1}}(a)){let b=Object.create(Object.getPrototypeOf(a));return d.set(a,b),eu(b,a,c,d,e),b}return a}function eu(a,b,c=a,d,e){let f=[...Object.keys(b),...en(b)];for(let g=0;g<f.length;g++){let h=f[g],i=Object.getOwnPropertyDescriptor(a,h);(null==i||i.writable)&&(a[h]=et(b[h],h,c,d,e))}}function ev(a){var b;return b=(b,c,d,e)=>{let f=void 0;if(null!=f)return f;if("object"==typeof a)switch(Object.prototype.toString.call(a)){case eq:case ep:case er:{let b=new a.constructor(a?.valueOf());return eu(b,a),b}case es:{let b={};return eu(b,a),b.length=a.length,b[Symbol.iterator]=a[Symbol.iterator],b}default:return}},et(a,void 0,a,new Map,b)}function ew(a){return null!==a&&"object"==typeof a&&"[object Arguments]"===eo(a)}var ex=Object.defineProperty,ey=Object.defineProperties,ez=Object.getOwnPropertyDescriptors,eA=Object.getOwnPropertySymbols,eB=Object.prototype.hasOwnProperty,eC=Object.prototype.propertyIsEnumerable,eD=(a,b,c)=>b in a?ex(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,eE=(a,b)=>{for(var c in b||(b={}))eB.call(b,c)&&eD(a,c,b[c]);if(eA)for(var c of eA(b))eC.call(b,c)&&eD(a,c,b[c]);return a},eF=(a,b)=>ey(a,ez(b));function eG(a,b,c){var d;let e=Y(a);return(null==(d=b.rpcMap)?void 0:d[e.reference])||`${ef}?chainId=${e.namespace}:${e.reference}&projectId=${c}`}function eH(a){return a.includes(":")?a.split(":")[1]:a}function eI(a){return a.map(a=>`${a.split(":")[0]}:${a.split(":")[1]}`)}function eJ(a={},b={}){return function(a,...b){return function(a,...b){let c=b.slice(0,-1),d=b[b.length-1],e=a;for(let a=0;a<c.length;a++)e=function a(b,c,d,e){if(ek(b)&&(b=Object(b)),null==c||"object"!=typeof c)return b;if(e.has(c))return function(a){if(ek(a))return a;if(Array.isArray(a)||el(a)||a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);let b=Object.getPrototypeOf(a),c=b.constructor;if(a instanceof Date||a instanceof Map||a instanceof Set)return new c(a);if(a instanceof RegExp){let b=new c(a);return b.lastIndex=a.lastIndex,b}if(a instanceof DataView)return new c(a.buffer.slice(0));if(a instanceof Error){let b=new c(a.message);return b.stack=a.stack,b.name=a.name,b.cause=a.cause,b}return"u">typeof File&&a instanceof File?new c([a],a.name,{type:a.type,lastModified:a.lastModified}):"object"==typeof a?Object.assign(Object.create(b),a):a}(e.get(c));if(e.set(c,b),Array.isArray(c)){c=c.slice();for(let a=0;a<c.length;a++)c[a]=c[a]??void 0}let f=[...Object.keys(c),...en(c)];for(let g=0;g<f.length;g++){let h=f[g],i=c[h],j=b[h];if(ew(i)&&(i={...i}),ew(j)&&(j={...j}),"u">typeof Buffer&&Buffer.isBuffer(i)&&(i=ev(i)),Array.isArray(i))if("object"==typeof j&&null!=j){let a=[],b=Reflect.ownKeys(j);for(let c=0;c<b.length;c++){let d=b[c];a[d]=j[d]}j=a}else j=[];let k=d(j,i,h,b,c,e);null!=k?b[h]=k:Array.isArray(i)||em(j)&&em(i)?b[h]=a(j,i,d,e):null==j&&function(a){if("object"!=typeof a||null==a)return!1;if(null===Object.getPrototypeOf(a))return!0;if("[object Object]"!==Object.prototype.toString.call(a)){let b=a[Symbol.toStringTag];return null!=b&&!!Object.getOwnPropertyDescriptor(a,Symbol.toStringTag)?.writable&&a.toString()===`[object ${b}]`}let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}(i)?b[h]=a({},i,d,e):null==j&&el(i)?b[h]=ev(i):(void 0===j||void 0!==i)&&(b[h]=i)}return b}(e,c[a],d,new Map);return e}(a,...b,ej)}(eK(a),eK(b))}function eK(a){var b,c,d,e,f;let g={};if(!dl(a))return g;for(let[h,i]of Object.entries(a)){let a=dc(h)?[h]:i.chains,j=i.methods||[],k=i.events||[],l=i.rpcMap||{},m=dd(h);g[m]=eF(eE(eE({},g[m]),i),{chains:ap(a,null==(b=g[m])?void 0:b.chains),methods:ap(j,null==(c=g[m])?void 0:c.methods),events:ap(k,null==(d=g[m])?void 0:d.events)}),(dl(l)||dl((null==(e=g[m])?void 0:e.rpcMap)||{}))&&(g[m].rpcMap=eE(eE({},l),null==(f=g[m])?void 0:f.rpcMap))}return g}function eL(a){return a.includes(":")?a.split(":")[2]:a}function eM(a){let b={};for(let[c,d]of Object.entries(a)){let a=d.methods||[],e=d.events||[],f=d.accounts||[],g=dc(c)?[c]:d.chains?d.chains:eI(d.accounts);b[c]={chains:g,methods:a,events:e,accounts:f}}return b}function eN(a){return"number"==typeof a?a:a.includes("0x")?parseInt(a,16):isNaN(Number(a=a.includes(":")?a.split(":")[1]:a))?a:Number(a)}let eO={},eP=a=>eO[a],eQ=(a,b)=>{eO[a]=b};var eR=Object.defineProperty,eS=(a,b,c)=>((a,b,c)=>b in a?eR(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class eT{constructor(a){eS(this,"name","polkadot"),eS(this,"client"),eS(this,"httpProviders"),eS(this,"events"),eS(this,"namespace"),eS(this,"chainId"),this.namespace=a.namespace,this.events=eP("events"),this.client=eP("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider().request(a.request)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(a,b),this.chainId=a,this.events.emit(ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${a}`)}getAccounts(){let a=this.namespace.accounts;return a&&a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2])||[]}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;let d=eH(b);a[d]=this.createHttpProvider(d,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getHttpProvider(){let a=`${this.name}:${this.chainId}`,b=this.httpProviders[a];if(typeof b>"u")throw Error(`JSON-RPC provider for ${a} not found`);return b}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||eG(a,this.namespace,this.client.core.projectId);return new ec.JsonRpcProvider(new eb.default(c,eP("disableProviderPing")))}}var eU=Object.defineProperty,eV=Object.defineProperties,eW=Object.getOwnPropertyDescriptors,eX=Object.getOwnPropertySymbols,eY=Object.prototype.hasOwnProperty,eZ=Object.prototype.propertyIsEnumerable,e$=(a,b,c)=>b in a?eU(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,e_=(a,b)=>{for(var c in b||(b={}))eY.call(b,c)&&e$(a,c,b[c]);if(eX)for(var c of eX(b))eZ.call(b,c)&&e$(a,c,b[c]);return a},e0=(a,b)=>eV(a,eW(b)),e1=(a,b,c)=>e$(a,"symbol"!=typeof b?b+"":b,c);class e2{constructor(a){e1(this,"name","eip155"),e1(this,"client"),e1(this,"chainId"),e1(this,"namespace"),e1(this,"httpProviders"),e1(this,"events"),this.namespace=a.namespace,this.events=eP("events"),this.client=eP("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(a){switch(a.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(a);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(a);case"wallet_getCallsStatus":return await this.getCallStatus(a)}return this.namespace.methods.includes(a.request.method)?await this.client.request(a):this.getHttpProvider().request(a.request)}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(parseInt(a),b),this.chainId=parseInt(a),this.events.emit(ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${a}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}createHttpProvider(a,b){let c=b||eG(`${this.name}:${a}`,this.namespace,this.client.core.projectId);return new ec.JsonRpcProvider(new eb.HttpConnection(c,eP("disableProviderPing")))}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;let d=parseInt(eH(b));a[d]=this.createHttpProvider(d,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}getHttpProvider(){let a=this.chainId,b=this.httpProviders[a];if(typeof b>"u")throw Error(`JSON-RPC provider for ${a} not found`);return b}async handleSwitchChain(a){var b,c;let d=a.request.params?null==(b=a.request.params[0])?void 0:b.chainId:"0x0",e=parseInt(d=d.startsWith("0x")?d:`0x${d}`,16);if(this.isChainApproved(e))this.setDefaultChain(`${e}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:a.topic,request:{method:a.request.method,params:[{chainId:d}]},chainId:null==(c=this.namespace.chains)?void 0:c[0]}),this.setDefaultChain(`${e}`);else throw Error(`Failed to switch to chain 'eip155:${e}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(a){return this.namespace.chains.includes(`${this.name}:${a}`)}async getCapabilities(a){var b,c,d,e,f;let g=null==(c=null==(b=a.request)?void 0:b.params)?void 0:c[0],h=(null==(e=null==(d=a.request)?void 0:d.params)?void 0:e[1])||[],i=`${g}${h.join(",")}`;if(!g)throw Error("Missing address parameter in `wallet_getCapabilities` request");let j=this.client.session.get(a.topic),k=(null==(f=j?.sessionProperties)?void 0:f.capabilities)||{};if(null!=k&&k[i])return k?.[i];let l=await this.client.request(a);try{await this.client.session.update(a.topic,{sessionProperties:e0(e_({},j.sessionProperties||{}),{capabilities:e0(e_({},k||{}),{[i]:l})})})}catch(a){console.warn("Failed to update session with capabilities",a)}return l}async getCallStatus(a){var b,c;let d=this.client.session.get(a.topic),e=null==(b=d.sessionProperties)?void 0:b.bundler_name;if(e){let b=this.getBundlerUrl(a.chainId,e);try{return await this.getUserOperationReceipt(b,a)}catch(a){console.warn("Failed to fetch call status from bundler",a,b)}}let f=null==(c=d.sessionProperties)?void 0:c.bundler_url;if(f)try{return await this.getUserOperationReceipt(f,a)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,f)}if(this.namespace.methods.includes(a.request.method))return await this.client.request(a);throw Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(a,b){var c;let d=new URL(a),e=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,dC.formatJsonRpcRequest)("eth_getUserOperationReceipt",[null==(c=b.request.params)?void 0:c[0]]))});if(!e.ok)throw Error(`Failed to fetch user operation receipt - ${e.status}`);return await e.json()}getBundlerUrl(a,b){return`${eh}?projectId=${this.client.core.projectId}&chainId=${a}&bundler=${b}`}}var e3=Object.defineProperty,e4=(a,b,c)=>((a,b,c)=>b in a?e3(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class e5{constructor(a){e4(this,"name","solana"),e4(this,"client"),e4(this,"httpProviders"),e4(this,"events"),e4(this,"namespace"),e4(this,"chainId"),this.namespace=a.namespace,this.events=eP("events"),this.client=eP("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}requestAccounts(){return this.getAccounts()}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider().request(a.request)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(a,b),this.chainId=a,this.events.emit(ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${a}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;let d=eH(b);a[d]=this.createHttpProvider(d,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getHttpProvider(){let a=`${this.name}:${this.chainId}`,b=this.httpProviders[a];if(typeof b>"u")throw Error(`JSON-RPC provider for ${a} not found`);return b}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||eG(a,this.namespace,this.client.core.projectId);return new ec.JsonRpcProvider(new eb.default(c,eP("disableProviderPing")))}}var e6=Object.defineProperty,e7=(a,b,c)=>((a,b,c)=>b in a?e6(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class e8{constructor(a){e7(this,"name","cosmos"),e7(this,"client"),e7(this,"httpProviders"),e7(this,"events"),e7(this,"namespace"),e7(this,"chainId"),this.namespace=a.namespace,this.events=eP("events"),this.client=eP("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider().request(a.request)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(a,b),this.chainId=a,this.events.emit(ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;let d=eH(b);a[d]=this.createHttpProvider(d,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getHttpProvider(){let a=`${this.name}:${this.chainId}`,b=this.httpProviders[a];if(typeof b>"u")throw Error(`JSON-RPC provider for ${a} not found`);return b}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||eG(a,this.namespace,this.client.core.projectId);return new ec.JsonRpcProvider(new eb.default(c,eP("disableProviderPing")))}}var e9=Object.defineProperty,fa=(a,b,c)=>((a,b,c)=>b in a?e9(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class fb{constructor(a){fa(this,"name","algorand"),fa(this,"client"),fa(this,"httpProviders"),fa(this,"events"),fa(this,"namespace"),fa(this,"chainId"),this.namespace=a.namespace,this.events=eP("events"),this.client=eP("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}requestAccounts(){return this.getAccounts()}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider().request(a.request)}setDefaultChain(a,b){if(!this.httpProviders[a]){let c=b||eG(`${this.name}:${a}`,this.namespace,this.client.core.projectId);this.setHttpProvider(a,c)}this.chainId=a,this.events.emit(ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;a[b]=this.createHttpProvider(b,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getHttpProvider(){let a=`${this.name}:${this.chainId}`,b=this.httpProviders[a];if(typeof b>"u")throw Error(`JSON-RPC provider for ${a} not found`);return b}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||eG(a,this.namespace,this.client.core.projectId);return typeof c>"u"?void 0:new ec.JsonRpcProvider(new eb.default(c,eP("disableProviderPing")))}}var fc=Object.defineProperty,fd=(a,b,c)=>((a,b,c)=>b in a?fc(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class fe{constructor(a){fd(this,"name","cip34"),fd(this,"client"),fd(this,"httpProviders"),fd(this,"events"),fd(this,"namespace"),fd(this,"chainId"),this.namespace=a.namespace,this.events=eP("events"),this.client=eP("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider().request(a.request)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(a,b),this.chainId=a,this.events.emit(ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{let c=this.getCardanoRPCUrl(b),d=eH(b);a[d]=this.createHttpProvider(d,c)}),a}getHttpProvider(){let a=`${this.name}:${this.chainId}`,b=this.httpProviders[a];if(typeof b>"u")throw Error(`JSON-RPC provider for ${a} not found`);return b}getCardanoRPCUrl(a){let b=this.namespace.rpcMap;if(b)return b[a]}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||this.getCardanoRPCUrl(a);if(!c)throw Error(`No RPC url provided for chainId: ${a}`);return new ec.JsonRpcProvider(new eb.default(c,eP("disableProviderPing")))}}var ff=Object.defineProperty,fg=(a,b,c)=>((a,b,c)=>b in a?ff(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class fh{constructor(a){fg(this,"name","elrond"),fg(this,"client"),fg(this,"httpProviders"),fg(this,"events"),fg(this,"namespace"),fg(this,"chainId"),this.namespace=a.namespace,this.events=eP("events"),this.client=eP("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}requestAccounts(){return this.getAccounts()}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider().request(a.request)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(a,b),this.chainId=a,this.events.emit(ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${a}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;let d=eH(b);a[d]=this.createHttpProvider(d,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getHttpProvider(){let a=`${this.name}:${this.chainId}`,b=this.httpProviders[a];if(typeof b>"u")throw Error(`JSON-RPC provider for ${a} not found`);return b}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||eG(a,this.namespace,this.client.core.projectId);return new ec.JsonRpcProvider(new eb.default(c,eP("disableProviderPing")))}}var fi=Object.defineProperty,fj=(a,b,c)=>((a,b,c)=>b in a?fi(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class fk{constructor(a){fj(this,"name","multiversx"),fj(this,"client"),fj(this,"httpProviders"),fj(this,"events"),fj(this,"namespace"),fj(this,"chainId"),this.namespace=a.namespace,this.events=eP("events"),this.client=eP("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}requestAccounts(){return this.getAccounts()}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider().request(a.request)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(a,b),this.chainId=a,this.events.emit(ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${a}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;let d=eH(b);a[d]=this.createHttpProvider(d,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getHttpProvider(){let a=`${this.name}:${this.chainId}`,b=this.httpProviders[a];if(typeof b>"u")throw Error(`JSON-RPC provider for ${a} not found`);return b}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||eG(a,this.namespace,this.client.core.projectId);return new ec.JsonRpcProvider(new eb.default(c,eP("disableProviderPing")))}}var fl=Object.defineProperty,fm=(a,b,c)=>((a,b,c)=>b in a?fl(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class fn{constructor(a){fm(this,"name","near"),fm(this,"client"),fm(this,"httpProviders"),fm(this,"events"),fm(this,"namespace"),fm(this,"chainId"),this.namespace=a.namespace,this.events=eP("events"),this.client=eP("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider().request(a.request)}setDefaultChain(a,b){if(this.chainId=a,!this.httpProviders[a]){let c=b||eG(`${this.name}:${a}`,this.namespace);this.setHttpProvider(a,c)}this.events.emit(ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let a=this.namespace.accounts;return a&&a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2])||[]}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;a[b]=this.createHttpProvider(b,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getHttpProvider(){let a=`${this.name}:${this.chainId}`,b=this.httpProviders[a];if(typeof b>"u")throw Error(`JSON-RPC provider for ${a} not found`);return b}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||eG(a,this.namespace);return typeof c>"u"?void 0:new ec.JsonRpcProvider(new eb.default(c,eP("disableProviderPing")))}}var fo=Object.defineProperty,fp=(a,b,c)=>((a,b,c)=>b in a?fo(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class fq{constructor(a){fp(this,"name","tezos"),fp(this,"client"),fp(this,"httpProviders"),fp(this,"events"),fp(this,"namespace"),fp(this,"chainId"),this.namespace=a.namespace,this.events=eP("events"),this.client=eP("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider().request(a.request)}setDefaultChain(a,b){if(this.chainId=a,!this.httpProviders[a]){let c=b||eG(`${this.name}:${a}`,this.namespace);this.setHttpProvider(a,c)}this.events.emit(ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){let a=this.namespace.accounts;return a&&a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2])||[]}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{a[b]=this.createHttpProvider(b)}),a}getHttpProvider(){let a=`${this.name}:${this.chainId}`,b=this.httpProviders[a];if(typeof b>"u")throw Error(`JSON-RPC provider for ${a} not found`);return b}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||eG(a,this.namespace);return typeof c>"u"?void 0:new ec.JsonRpcProvider(new eb.default(c))}}var fr=Object.defineProperty,fs=(a,b,c)=>((a,b,c)=>b in a?fr(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c);class ft{constructor(a){fs(this,"name",eg),fs(this,"client"),fs(this,"httpProviders"),fs(this,"events"),fs(this,"namespace"),fs(this,"chainId"),this.namespace=a.namespace,this.events=eP("events"),this.client=eP("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(a.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(a.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(a.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(a.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider(a.chainId).request(a.request)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(a,b),this.chainId=a,this.events.emit(ei.DEFAULT_CHAIN_CHANGED,`${this.name}:${a}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}createHttpProviders(){var a,b;let c={};return null==(b=null==(a=this.namespace)?void 0:a.accounts)||b.forEach(a=>{let b=Y(a);c[`${b.namespace}:${b.reference}`]=this.createHttpProvider(a)}),c}getHttpProvider(a){let b=this.httpProviders[a];if(typeof b>"u")throw Error(`JSON-RPC provider for ${a} not found`);return b}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||eG(a,this.namespace,this.client.core.projectId);return new ec.JsonRpcProvider(new eb.default(c,eP("disableProviderPing")))}}var fu=Object.defineProperty,fv=Object.defineProperties,fw=Object.getOwnPropertyDescriptors,fx=Object.getOwnPropertySymbols,fy=Object.prototype.hasOwnProperty,fz=Object.prototype.propertyIsEnumerable,fA=(a,b,c)=>b in a?fu(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,fB=(a,b)=>{for(var c in b||(b={}))fy.call(b,c)&&fA(a,c,b[c]);if(fx)for(var c of fx(b))fz.call(b,c)&&fA(a,c,b[c]);return a},fC=(a,b)=>fv(a,fw(b)),fD=(a,b,c)=>fA(a,"symbol"!=typeof b?b+"":b,c);class fE{constructor(a){fD(this,"client"),fD(this,"namespaces"),fD(this,"optionalNamespaces"),fD(this,"sessionProperties"),fD(this,"scopedProperties"),fD(this,"events",new k.default),fD(this,"rpcProviders",{}),fD(this,"session"),fD(this,"providerOpts"),fD(this,"logger"),fD(this,"uri"),fD(this,"disableProviderPing",!1),this.providerOpts=a,this.logger="u">typeof a?.logger&&"string"!=typeof a?.logger?a.logger:(0,i.pino)((0,h.getDefaultLoggerOptions)({level:a?.logger||ed})),this.disableProviderPing=a?.disableProviderPing||!1}static async init(a){let b=new fE(a);return await b.initialize(),b}async request(a,b,c){let[d,e]=this.validateChain(b);if(!this.session)throw Error("Please call connect() before request()");return await this.getProvider(d).request({request:fB({},a),chainId:`${d}:${e}`,topic:this.session.topic,expiry:c})}sendAsync(a,b,c,d){let e=new Date().getTime();this.request(a,c,d).then(a=>b(null,(0,dC.formatJsonRpcResult)(e,a))).catch(a=>b(a,void 0))}async enable(){if(!this.client)throw Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var a;if(!this.session)throw Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(a=this.session)?void 0:a.topic,reason:dj("USER_DISCONNECTED")}),await this.cleanup()}async connect(a){if(!this.client)throw Error("Sign Client not initialized");if(this.setNamespaces(a),await this.cleanupPendingPairings(),!a.skipPairing)return await this.pair(a.pairingTopic)}async authenticate(a,b){if(!this.client)throw Error("Sign Client not initialized");this.setNamespaces(a),await this.cleanupPendingPairings();let{uri:c,response:d}=await this.client.authenticate(a,b);c&&(this.uri=c,this.events.emit("display_uri",c));let e=await d();if(this.session=e.session,this.session){let a=eM(this.session.namespaces);this.namespaces=eJ(this.namespaces,a),await this.persist("namespaces",this.namespaces),this.onConnect()}return e}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}removeListener(a,b){this.events.removeListener(a,b)}off(a,b){this.events.off(a,b)}get isWalletConnect(){return!0}async pair(a){let{uri:b,approval:c}=await this.client.connect({pairingTopic:a,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});b&&(this.uri=b,this.events.emit("display_uri",b));let d=await c();this.session=d;let e=eM(d.namespaces);return this.namespaces=eJ(this.namespaces,e),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(a,b){try{if(!this.session)return;let[c,d]=this.validateChain(a),e=this.getProvider(c);e.name===eg?e.setDefaultChain(`${c}:${d}`,b):e.setDefaultChain(d,b)}catch(a){if(!/Please call connect/.test(a.message))throw a}}async cleanupPendingPairings(a={}){this.logger.info("Cleaning up inactive pairings...");let b=this.client.pairing.getAll();if(dk(b)){for(let c of b)a.deletePairings?this.client.core.expirer.set(c.topic,0):await this.client.core.relayer.subscriber.unsubscribe(c.topic);this.logger.info(`Inactive pairings cleared: ${b.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var a,b;if(this.client=this.providerOpts.client||await ea.init({core:this.providerOpts.core,logger:this.providerOpts.logger||ed,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(c){throw this.logger.error("Failed to get session",c),Error(`The provided session: ${null==(b=null==(a=this.providerOpts)?void 0:a.session)?void 0:b.topic} doesn't exist in the Sign client`)}else{let a=this.client.session.getAll();this.session=a[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw Error("Sign Client not initialized");if(!this.session)throw Error("Session not initialized. Please call connect() before enable()");let a=[...new Set(Object.keys(this.session.namespaces).map(a=>dd(a)))];eQ("client",this.client),eQ("events",this.events),eQ("disableProviderPing",this.disableProviderPing),a.forEach(a=>{if(!this.session)return;let b=function(a,b){let c=Object.keys(b.namespaces).filter(b=>b.includes(a));if(!c.length)return[];let d=[];return c.forEach(a=>{let c=b.namespaces[a].accounts;d.push(...c)}),d}(a,this.session),c=eI(b),d=fC(fB({},eJ(this.namespaces,this.optionalNamespaces)[a]),{accounts:b,chains:c});switch(a){case"eip155":this.rpcProviders[a]=new e2({namespace:d});break;case"algorand":this.rpcProviders[a]=new fb({namespace:d});break;case"solana":this.rpcProviders[a]=new e5({namespace:d});break;case"cosmos":this.rpcProviders[a]=new e8({namespace:d});break;case"polkadot":this.rpcProviders[a]=new eT({namespace:d});break;case"cip34":this.rpcProviders[a]=new fe({namespace:d});break;case"elrond":this.rpcProviders[a]=new fh({namespace:d});break;case"multiversx":this.rpcProviders[a]=new fk({namespace:d});break;case"near":this.rpcProviders[a]=new fn({namespace:d});break;case"tezos":this.rpcProviders[a]=new fq({namespace:d});break;default:this.rpcProviders[eg]?this.rpcProviders[eg].updateNamespace(d):this.rpcProviders[eg]=new ft({namespace:d})}})}registerEventListeners(){if(typeof this.client>"u")throw Error("Sign Client is not initialized");this.client.on("session_ping",a=>{var b;let{topic:c}=a;c===(null==(b=this.session)?void 0:b.topic)&&this.events.emit("session_ping",a)}),this.client.on("session_event",a=>{var b;let{params:c,topic:d}=a;if(d!==(null==(b=this.session)?void 0:b.topic))return;let{event:e}=c;if("accountsChanged"===e.name){let a=e.data;a&&dk(a)&&this.events.emit("accountsChanged",a.map(eL))}else if("chainChanged"===e.name){let a=c.chainId,b=c.event.data,d=dd(a),e=eN(a)!==eN(b)?`${d}:${eN(b)}`:a;this.onChainChanged(e)}else this.events.emit(e.name,e.data);this.events.emit("session_event",a)}),this.client.on("session_update",({topic:a,params:b})=>{var c,d;if(a!==(null==(c=this.session)?void 0:c.topic))return;let{namespaces:e}=b,f=null==(d=this.client)?void 0:d.session.get(a);this.session=fC(fB({},f),{namespaces:e}),this.onSessionUpdate(),this.events.emit("session_update",{topic:a,params:b})}),this.client.on("session_delete",async a=>{var b;a.topic===(null==(b=this.session)?void 0:b.topic)&&(await this.cleanup(),this.events.emit("session_delete",a),this.events.emit("disconnect",fC(fB({},dj("USER_DISCONNECTED")),{data:a.topic})))}),this.on(ei.DEFAULT_CHAIN_CHANGED,a=>{this.onChainChanged(a,!0)})}getProvider(a){return this.rpcProviders[a]||this.rpcProviders[eg]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(a=>{var b;this.getProvider(a).updateNamespace(null==(b=this.session)?void 0:b.namespaces[a])})}setNamespaces(a){let{namespaces:b={},optionalNamespaces:c={},sessionProperties:d,scopedProperties:e}=a;this.optionalNamespaces=eJ(b,c),this.sessionProperties=d,this.scopedProperties=e}validateChain(a){let[b,c]=a?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[b,c];if(b&&!Object.keys(this.namespaces||{}).map(a=>dd(a)).includes(b))throw Error(`Namespace '${b}' is not configured. Please call connect() first with namespace config.`);if(b&&c)return[b,c];let d=dd(Object.keys(this.namespaces)[0]),e=this.rpcProviders[d].getDefaultChain();return[d,e]}async requestAccounts(){let[a]=this.validateChain();return await this.getProvider(a).requestAccounts()}async onChainChanged(a,b=!1){if(!this.namespaces)return;let[c,d]=this.validateChain(a);if(!d)return;this.updateNamespaceChain(c,d),this.events.emit("chainChanged",d);let e=this.getProvider(c).getDefaultChain();b||this.getProvider(c).setDefaultChain(d),this.emitAccountsChangedOnChainChange({namespace:c,previousChainId:e,newChainId:a}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:a,previousChainId:b,newChainId:c}){var d,e;try{if(b===c)return;let f=null==(e=null==(d=this.session)?void 0:d.namespaces[a])?void 0:e.accounts;if(!f)return;let g=f.filter(a=>a.includes(`${c}:`)).map(eL);if(!dk(g))return;this.events.emit("accountsChanged",g)}catch(a){this.logger.warn("Failed to emit accountsChanged on chain change",a)}}updateNamespaceChain(a,b){if(!this.namespaces)return;let c=this.namespaces[a]?a:`${a}:${b}`;this.namespaces[c]?this.namespaces[c]&&(this.namespaces[c].defaultChain=b):this.namespaces[c]={chains:[],methods:[],events:[],defaultChain:b}}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(a,b){var c;let d=(null==(c=this.session)?void 0:c.topic)||"";await this.client.core.storage.setItem(`${ee}/${a}${d}`,b)}async getFromStore(a){var b;let c=(null==(b=this.session)?void 0:b.topic)||"";return await this.client.core.storage.getItem(`${ee}/${a}${c}`)}async deleteFromStore(a){var b;let c=(null==(b=this.session)?void 0:b.topic)||"";await this.client.core.storage.removeItem(`${ee}/${a}${c}`)}async cleanupStorage(){var a;try{if((null==(a=this.client)?void 0:a.session.length)>0)return;for(let a of(await this.client.core.storage.getKeys()))a.startsWith(ee)&&await this.client.core.storage.removeItem(a)}catch(a){this.logger.warn("Failed to cleanup storage",a)}}}var fF=a.i(432570),fG=a.i(660130);let fH={validateCaipAddress(a){if(a.split(":")?.length!==3)throw Error("Invalid CAIP Address");return a},parseCaipAddress(a){let b=a.split(":");if(3!==b.length)throw Error(`Invalid CAIP-10 address: ${a}`);let[c,d,e]=b;if(!c||!d||!e)throw Error(`Invalid CAIP-10 address: ${a}`);return{chainNamespace:c,chainId:d,address:e}},parseCaipNetworkId(a){let b=a.split(":");if(2!==b.length)throw Error(`Invalid CAIP-2 network id: ${a}`);let[c,d]=b;if(!c||!d)throw Error(`Invalid CAIP-2 network id: ${a}`);return{chainNamespace:c,chainId:d}}};var fI=a.i(36315),fJ=a.i(595489),fK=a.i(146214),fL=a.i(676178),fM=a.i(714977),fN=a.i(34688),fO=a.i(185851),fP=a.i(215425);let fQ={convertEVMChainIdToCoinType(a){if(a>=0x80000000)throw Error("Invalid chainId");return(0x80000000|a)>>>0}};var fR=a.i(83505),fS=a.i(152334),fT=a.i(71664);let fU=(0,fO.proxy)({suggestions:[],loading:!1}),fV=(0,fS.withErrorBoundary)({state:fU,subscribe:a=>(0,fO.subscribe)(fU,()=>a(fU)),subscribeKey:(a,b)=>(0,fP.subscribeKey)(fU,a,b),async resolveName(a){try{return await fL.BlockchainApiController.lookupEnsName(a)}catch(a){throw Error(a?.reasons?.[0]?.description||"Error resolving name")}},async isNameRegistered(a){try{return await fL.BlockchainApiController.lookupEnsName(a),!0}catch{return!1}},async getSuggestions(a){try{return fU.loading=!0,fU.suggestions=[],fU.suggestions=(await fL.BlockchainApiController.getEnsNameSuggestions(a)).suggestions.map(a=>({...a,name:a.name}))||[],fU.suggestions}catch(a){throw Error(fV.parseEnsApiError(a,"Error fetching name suggestions"))}finally{fU.loading=!1}},async getNamesForAddress(a){try{if(!fM.ChainController.state.activeCaipNetwork)return[];let b=fR.StorageUtil.getEnsFromCacheForAddress(a);if(b)return b;let c=await fL.BlockchainApiController.reverseLookupEnsName({address:a});return fR.StorageUtil.updateEnsCache({address:a,ens:c,timestamp:Date.now()}),c}catch(a){throw Error(fV.parseEnsApiError(a,"Error fetching names for address"))}},async registerName(a){let e=fM.ChainController.state.activeCaipNetwork;if(!e)throw Error("Network not found");let f=b.AccountController.state.address,g=d.ConnectorController.getAuthConnector();if(!f||!g)throw Error("Address or auth connector not found");fU.loading=!0;try{let d=JSON.stringify({name:a,attributes:{},timestamp:Math.floor(Date.now()/1e3)});fT.RouterController.pushTransactionStack({onCancel(){fT.RouterController.replace("RegisterAccountName")}});let g=await c.ConnectionController.signMessage(d);fU.loading=!1;let h=e.id;if(!h)throw Error("Network not found");let i=fQ.convertEVMChainIdToCoinType(Number(h));await fL.BlockchainApiController.registerEnsName({coinType:i,address:f,signature:g,message:d}),b.AccountController.setProfileName(a,e.chainNamespace),fT.RouterController.replace("RegisterAccountNameSuccess")}catch(c){let b=fV.parseEnsApiError(c,`Error registering name ${a}`);throw fT.RouterController.replace("RegisterAccountName"),Error(b)}finally{fU.loading=!1}},validateName:a=>/^[a-zA-Z0-9-]{4,}$/u.test(a),parseEnsApiError:(a,b)=>a?.reasons?.[0]?.description||b});var fW=a.i(903544),fX=a.i(584577);let fY={id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},fZ={id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},f$={providers:fN.ONRAMP_PROVIDERS,selectedProvider:null,error:null,purchaseCurrency:fY,paymentCurrency:fZ,purchaseCurrencies:[fY],paymentCurrencies:[],quotesLoading:!1},f_=(0,fO.proxy)(f$),f0=(0,fS.withErrorBoundary)({state:f_,subscribe:a=>(0,fO.subscribe)(f_,()=>a(f_)),subscribeKey:(a,b)=>(0,fP.subscribeKey)(f_,a,b),setSelectedProvider(a){if(a&&"meld"===a.name){let c=fM.ChainController.state.activeChain===fF.ConstantsUtil.CHAIN.SOLANA?"SOL":"USDC",d=b.AccountController.state.address??"",e=new URL(a.url);e.searchParams.append("publicKey",fN.MELD_PUBLIC_KEY),e.searchParams.append("destinationCurrencyCode",c),e.searchParams.append("walletAddress",d),e.searchParams.append("externalCustomerId",f.OptionsController.state.projectId),f_.selectedProvider={...a,url:e.toString()}}else f_.selectedProvider=a},setOnrampProviders(a){Array.isArray(a)&&a.every(a=>"string"==typeof a)?f_.providers=fN.ONRAMP_PROVIDERS.filter(b=>a.includes(b.name)):f_.providers=[]},setPurchaseCurrency(a){f_.purchaseCurrency=a},setPaymentCurrency(a){f_.paymentCurrency=a},setPurchaseAmount(a){f0.state.purchaseAmount=a},setPaymentAmount(a){f0.state.paymentAmount=a},async getAvailableCurrencies(){let a=await fL.BlockchainApiController.getOnrampOptions();f_.purchaseCurrencies=a.purchaseCurrencies,f_.paymentCurrencies=a.paymentCurrencies,f_.paymentCurrency=a.paymentCurrencies[0]||fZ,f_.purchaseCurrency=a.purchaseCurrencies[0]||fY,await fJ.ApiController.fetchCurrencyImages(a.paymentCurrencies.map(a=>a.id)),await fJ.ApiController.fetchTokenImages(a.purchaseCurrencies.map(a=>a.symbol))},async getQuote(){f_.quotesLoading=!0;try{let a=await fL.BlockchainApiController.getOnrampQuote({purchaseCurrency:f_.purchaseCurrency,paymentCurrency:f_.paymentCurrency,amount:f_.paymentAmount?.toString()||"0",network:f_.purchaseCurrency?.symbol});return f_.quotesLoading=!1,f_.purchaseAmount=Number(a?.purchaseAmount.amount),a}catch(a){return f_.error=a.message,f_.quotesLoading=!1,null}finally{f_.quotesLoading=!1}},resetState(){f_.selectedProvider=null,f_.error=null,f_.purchaseCurrency=fY,f_.paymentCurrency=fZ,f_.purchaseCurrencies=[fY],f_.paymentCurrencies=[],f_.paymentAmount=void 0,f_.purchaseAmount=void 0,f_.quotesLoading=!1}});var f1=a.i(473171),f2=a.i(390608),f3=a.i(957699),f4=a.i(259968),f5=a.i(879899);function f6(a,b){return d.ConnectorController.getConnectorId(a)===b}a.i(844926),a.i(854812);var f7=a.i(222123);a.i(546894);var f8=a.i(608884),f9=a.i(88830),ga=a.i(119147),gb=a.i(791550),gc=a.i(599587);function gd(a,b={}){let{key:c="fallback",name:d="Fallback",rank:e=!1,shouldThrow:f=ge,retryCount:g,retryDelay:h}=b;return({chain:b,pollingInterval:i=4e3,timeout:j,...k})=>{let l=a,m=()=>{},n=(0,gc.createTransport)({key:c,name:d,async request({method:a,params:c}){let d,e=async(g=0)=>{let h=l[g]({...k,chain:b,retryCount:0,timeout:j});try{let b=await h.request({method:a,params:c});return m({method:a,params:c,response:b,transport:h,status:"success"}),b}catch(i){if(m({error:i,method:a,params:c,transport:h,status:"error"}),f(i)||g===l.length-1||!(d??=l.slice(g+1).some(c=>{let{include:d,exclude:e}=c({chain:b}).config.methods||{};return d?d.includes(a):!e||!e.includes(a)})))throw i;return e(g+1)}};return e()},retryCount:g,retryDelay:h,type:"fallback"},{onResponse:a=>m=a,transports:l.map(a=>a({chain:b,retryCount:0}))});if(e){let a="object"==typeof e?e:{};!function({chain:a,interval:b=4e3,onTransports:c,ping:d,sampleCount:e=10,timeout:f=1e3,transports:g,weights:h={}}){let{stability:i=.7,latency:j=.3}=h,k=[],l=async()=>{let h=await Promise.all(g.map(async b=>{let c,e,g=b({chain:a,retryCount:0,timeout:f}),h=Date.now();try{await (d?d({transport:g}):g.request({method:"net_listening"})),e=1}catch{e=0}finally{c=Date.now()}return{latency:c-h,success:e}}));k.push(h),k.length>e&&k.shift();let m=Math.max(...k.map(a=>Math.max(...a.map(({latency:a})=>a))));c(g.map((a,b)=>{let c=k.map(a=>a[b].latency),d=c.reduce((a,b)=>a+b,0)/c.length,e=k.map(a=>a[b].success),f=e.reduce((a,b)=>a+b,0)/e.length;return 0===f?[0,b]:[j*(1-d/m)+i*f,b]}).sort((a,b)=>b[0]-a[0]).map(([,a])=>g[a])),await (0,gb.wait)(b),l()};l()}({chain:b,interval:a.interval??i,onTransports:a=>l=a,ping:a.ping,sampleCount:a.sampleCount,timeout:a.timeout,transports:l,weights:a.weights})}return n}}function ge(a){return!!("code"in a&&"number"==typeof a.code&&(a.code===ga.TransactionRejectedRpcError.code||a.code===ga.UserRejectedRequestError.code||f9.ExecutionRevertedError.nodeMessage.test(a.message)||5e3===a.code))}var gf=a.i(373005),gg=a.i(262474);let gh={ConnectorExplorerIds:{[fF.ConstantsUtil.CONNECTOR_ID.COINBASE]:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",[fF.ConstantsUtil.CONNECTOR_ID.COINBASE_SDK]:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",[fF.ConstantsUtil.CONNECTOR_ID.SAFE]:"225affb176778569276e484e1b92637ad061b01e13a048b35a9d280c3b58970f",[fF.ConstantsUtil.CONNECTOR_ID.LEDGER]:"19177a98252e07ddfc9af2083ba8e07ef627cb6103467ffebb3f8f4205fd7927",[fF.ConstantsUtil.CONNECTOR_ID.OKX]:"971e689d0a5be527bac79629b4ee9b925e82208e5168b733496a09c0faed0709",[gg.ConstantsUtil.METMASK_CONNECTOR_NAME]:"c57ca95b47569778a828d19178114f4db188b89b763c899ba0be274e97267d96",[gg.ConstantsUtil.TRUST_CONNECTOR_NAME]:"4622a2b2d6af1c9844944291e5e7351a6aa24cd7b23099efac1b2fd875da31a0",[gg.ConstantsUtil.SOLFLARE_CONNECTOR_NAME]:"1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79",[gg.ConstantsUtil.PHANTOM_CONNECTOR_NAME]:"a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393",[gg.ConstantsUtil.COIN98_CONNECTOR_NAME]:"2a3c89040ac3b723a1972a33a125b1db11e258a6975d3a61252cd64e6ea5ea01",[gg.ConstantsUtil.MAGIC_EDEN_CONNECTOR_NAME]:"8b830a2b724a9c3fbab63af6f55ed29c9dfa8a55e732dc88c80a196a2ba136c6",[gg.ConstantsUtil.BACKPACK_CONNECTOR_NAME]:"2bd8c14e035c2d48f184aaa168559e86b0e3433228d3c4075900a221785019b0",[gg.ConstantsUtil.BITGET_CONNECTOR_NAME]:"38f5d18bd8522c244bdd70cb4a68e0e718865155811c043f052fb9f1c51de662",[gg.ConstantsUtil.FRONTIER_CONNECTOR_NAME]:"85db431492aa2e8672e93f4ea7acf10c88b97b867b0d373107af63dc4880f041",[gg.ConstantsUtil.XVERSE_CONNECTOR_NAME]:"2a87d74ae02e10bdd1f51f7ce6c4e1cc53cd5f2c0b6b5ad0d7b3007d2b13de7b",[gg.ConstantsUtil.LEATHER_CONNECTOR_NAME]:"483afe1df1df63daf313109971ff3ef8356ddf1cc4e45877d205eee0b7893a13"},NetworkImageIds:{1:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",42161:"3bff954d-5cb0-47a0-9a23-d20192e74600",43114:"30c46e53-e989-45fb-4549-be3bd4eb3b00",56:"93564157-2e8e-4ce7-81df-b264dbee9b00",250:"06b26297-fe0c-4733-5d6b-ffa5498aac00",10:"ab9c186a-c52f-464b-2906-ca59d760a400",137:"41d04d42-da3b-4453-8506-668cc0727900",5e3:"e86fae9b-b770-4eea-e520-150e12c81100",295:"6a97d510-cac8-4e58-c7ce-e8681b044c00",0xaa36a7:"e909ea0a-f92a-4512-c8fc-748044ea6800",84532:"a18a7ecd-e307-4360-4746-283182228e00",1301:"4eeea7ef-0014-4649-5d1d-07271a80f600",130:"2257980a-3463-48c6-cbac-a42d2a956e00",10143:"0a728e83-bacb-46db-7844-948f05434900",100:"02b53f6a-e3d4-479e-1cb4-21178987d100",9001:"f926ff41-260d-4028-635e-91913fc28e00",324:"b310f07f-4ef7-49f3-7073-2a0a39685800",314:"5a73b3dd-af74-424e-cae0-0de859ee9400",4689:"34e68754-e536-40da-c153-6ef2e7188a00",1088:"3897a66d-40b9-4833-162f-a2c90531c900",1284:"161038da-44ae-4ec7-1208-0ea569454b00",1285:"f1d73bb6-5450-4e18-38f7-fb6484264a00",7777777:"845c60df-d429-4991-e687-91ae45791600",42220:"ab781bbc-ccc6-418d-d32d-789b15da1f00",8453:"7289c336-3981-4081-c5f4-efc26ac64a00",0x4e454152:"3ff73439-a619-4894-9262-4470c773a100",2020:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",2021:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",80094:"e329c2c9-59b0-4a02-83e4-212ff3779900",2741:"fc2427d1-5af9-4a9c-8da5-6f94627cd900","5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":"a1b58899-f671-4276-6a5e-56ca5bd59700","4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":"a1b58899-f671-4276-6a5e-56ca5bd59700",EtWTRABZaYq6iMfeYKouRu166VU2xqa1:"a1b58899-f671-4276-6a5e-56ca5bd59700","000000000019d6689c085ae165831e93":"0b4838db-0161-4ffe-022d-532bf03dba00","000000000933ea01ad0ee984209779ba":"39354064-d79b-420b-065d-f980c4b78200"},ConnectorImageIds:{[fF.ConstantsUtil.CONNECTOR_ID.COINBASE]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[fF.ConstantsUtil.CONNECTOR_ID.COINBASE_SDK]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[fF.ConstantsUtil.CONNECTOR_ID.SAFE]:"461db637-8616-43ce-035a-d89b8a1d5800",[fF.ConstantsUtil.CONNECTOR_ID.LEDGER]:"54a1aa77-d202-4f8d-0fb2-5d2bb6db0300",[fF.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT]:"ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",[fF.ConstantsUtil.CONNECTOR_ID.INJECTED]:"07ba87ed-43aa-4adf-4540-9e6a2b9cae00"},ConnectorNamesMap:{[fF.ConstantsUtil.CONNECTOR_ID.INJECTED]:"Browser Wallet",[fF.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT]:"WalletConnect",[fF.ConstantsUtil.CONNECTOR_ID.COINBASE]:"Coinbase",[fF.ConstantsUtil.CONNECTOR_ID.COINBASE_SDK]:"Coinbase",[fF.ConstantsUtil.CONNECTOR_ID.LEDGER]:"Ledger",[fF.ConstantsUtil.CONNECTOR_ID.SAFE]:"Safe"},ConnectorTypesMap:{[fF.ConstantsUtil.CONNECTOR_ID.INJECTED]:"INJECTED",[fF.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT]:"WALLET_CONNECT",[fF.ConstantsUtil.CONNECTOR_ID.EIP6963]:"ANNOUNCED",[fF.ConstantsUtil.CONNECTOR_ID.AUTH]:"AUTH"},WalletConnectRpcChainIds:[1,5,0xaa36a7,10,420,42161,421613,137,80001,42220,0x4e454152,0x4e454153,56,97,43114,43113,100,8453,84531,7777777,999,324,280]};function gi(a,b){let c=new URL("https://rpc.walletconnect.org/v1/");return c.searchParams.set("chainId",a),c.searchParams.set("projectId",b),c.toString()}let gj=["near:mainnet","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","eip155:1101","eip155:56","eip155:42161","eip155:7777777","eip155:59144","eip155:324","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1","eip155:5000","solana:4sgjmw1sunhzsxgspuhpqldx6wiyjntz","eip155:80084","eip155:5003","eip155:100","eip155:8453","eip155:42220","eip155:1313161555","eip155:17000","eip155:1","eip155:300","eip155:1313161554","eip155:1329","eip155:84532","eip155:421614","eip155:11155111","eip155:8217","eip155:43114","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","eip155:999999999","eip155:11155420","eip155:80002","eip155:97","eip155:43113","eip155:137","eip155:10","eip155:1301","bip122:000000000019d6689c085ae165831e93","bip122:000000000933ea01ad0ee984209779ba"],gk={extendRpcUrlWithProjectId(a,b){let c=!1;try{c="rpc.walletconnect.org"===new URL(a).host}catch(a){c=!1}if(c){let c=new URL(a);return c.searchParams.has("projectId")||c.searchParams.set("projectId",b),c.toString()}return a},isCaipNetwork:a=>"chainNamespace"in a&&"caipNetworkId"in a,getChainNamespace(a){return this.isCaipNetwork(a)?a.chainNamespace:fF.ConstantsUtil.CHAIN.EVM},getCaipNetworkId(a){return this.isCaipNetwork(a)?a.caipNetworkId:`${fF.ConstantsUtil.CHAIN.EVM}:${a.id}`},getDefaultRpcUrl(a,b,c){let d=a.rpcUrls?.default?.http?.[0];return gj.includes(b)?gi(b,c):d||""},extendCaipNetwork(a,{customNetworkImageUrls:b,projectId:c,customRpcUrls:d}){let e=this.getChainNamespace(a),f=this.getCaipNetworkId(a),g=a.rpcUrls.default.http?.[0],h=this.getDefaultRpcUrl(a,f,c),i=a?.rpcUrls?.chainDefault?.http?.[0]||g,j=d?.[f]?.map(a=>a.url)||[],k=[...j,h],l=[...j];return i&&!l.includes(i)&&l.push(i),{...a,chainNamespace:e,caipNetworkId:f,assets:{imageId:gh.NetworkImageIds[a.id],imageUrl:b?.[a.id]},rpcUrls:{...a.rpcUrls,default:{http:k},chainDefault:{http:l}}}},extendCaipNetworks:(a,{customNetworkImageUrls:b,projectId:c,customRpcUrls:d})=>a.map(a=>gk.extendCaipNetwork(a,{customNetworkImageUrls:b,customRpcUrls:d,projectId:c})),getViemTransport(a,b,c){let d=[];return c?.forEach(a=>{d.push((0,gf.http)(a.url,a.config))}),gj.includes(a.caipNetworkId)&&d.push((0,gf.http)(gi(a.caipNetworkId,b),{fetchOptions:{headers:{"Content-Type":"text/plain"}}})),a?.rpcUrls?.default?.http?.forEach(a=>{d.push((0,gf.http)(a))}),gd(d)},extendWagmiTransports(a,b,c){if(gj.includes(a.caipNetworkId)){let d=this.getDefaultRpcUrl(a,a.caipNetworkId,b);return gd([c,(0,gf.http)(d)])}return c},getUnsupportedNetwork:a=>({id:a.split(":")[1],caipNetworkId:a,name:fF.ConstantsUtil.UNSUPPORTED_NETWORK_NAME,chainNamespace:a.split(":")[0],nativeCurrency:{name:"",decimals:0,symbol:""},rpcUrls:{default:{http:[]}}}),getCaipNetworkFromStorage(a){let b=fR.StorageUtil.getActiveCaipNetworkId(),c=fM.ChainController.getAllRequestedCaipNetworks(),d=Array.from(fM.ChainController.state.chains?.keys()||[]),e=b?.split(":")[0],f=!!e&&d.includes(e),g=c?.find(a=>a.caipNetworkId===b);return f&&!g&&b?this.getUnsupportedNetwork(b):g||a||c?.[0]}},gl=(new AbortController,{UniversalProviderErrors:{UNAUTHORIZED_DOMAIN_NOT_ALLOWED:{message:"Unauthorized: origin not allowed",alertErrorKey:"INVALID_APP_CONFIGURATION"},JWT_VALIDATION_ERROR:{message:"JWT validation error: JWT Token is not yet valid",alertErrorKey:"JWT_TOKEN_NOT_VALID"},INVALID_KEY:{message:"Unauthorized: invalid key",alertErrorKey:"INVALID_PROJECT_ID"}},ALERT_ERRORS:{SWITCH_NETWORK_NOT_FOUND:{shortMessage:"Network Not Found",longMessage:"Network not found - please make sure it is included in 'networks' array in createAppKit function"},INVALID_APP_CONFIGURATION:{shortMessage:"Invalid App Configuration",longMessage:()=>"Origin unknown not found on Allowlist - update configuration on cloud.reown.com"},IFRAME_LOAD_FAILED:{shortMessage:"Network Error - Could not load embedded wallet",longMessage:()=>"There was an issue loading the embedded wallet. Please try again later."},IFRAME_REQUEST_TIMEOUT:{shortMessage:"Embedded Wallet Request Timed Out",longMessage:()=>"There was an issue doing the request to the embedded wallet. Please try again later."},UNVERIFIED_DOMAIN:{shortMessage:"Invalid App Configuration",longMessage:()=>"There was an issue loading the embedded wallet. Please verify that your domain is allowed at cloud.reown.com"},JWT_TOKEN_NOT_VALID:{shortMessage:"Session Expired",longMessage:"Invalid session found on UniversalProvider - please check your time settings and connect again"},INVALID_PROJECT_ID:{shortMessage:"Invalid App Configuration",longMessage:"Invalid Project ID - update configuration"},PROJECT_ID_NOT_CONFIGURED:{shortMessage:"Project ID Not Configured",longMessage:"Project ID Not Configured - update configuration on cloud.reown.com"}}});var gm=a.i(676587);let gn={createLogger(a,b="error"){let c=(0,h.getDefaultLoggerOptions)({level:b}),{logger:d}=(0,h.generatePlatformLogger)({opts:c});return d.error=(...b)=>{for(let c of b)if(c instanceof Error)return void a(c,...b);a(void 0,...b)},d}},go={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0},gp=(0,fO.proxy)({providers:{...go},providerIds:{...go}}),gq={state:gp,subscribeKey:(a,b)=>(0,fP.subscribeKey)(gp,a,b),subscribe:a=>(0,fO.subscribe)(gp,()=>{a(gp)}),subscribeProviders:a=>(0,fO.subscribe)(gp.providers,()=>a(gp.providers)),setProvider(a,b){b&&(gp.providers[a]=(0,fO.ref)(b))},getProvider:a=>gp.providers[a],setProviderId(a,b){b&&(gp.providerIds[a]=b)},getProviderId(a){if(a)return gp.providerIds[a]},reset(){gp.providers={...go},gp.providerIds={...go}},resetChain(a){gp.providers[a]=void 0,gp.providerIds[a]=void 0}};var gr=a.i(15650);let gs={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603,DEFAULT_ALLOWED_ANCESTORS:["http://localhost:*","https://*.pages.dev","https://*.vercel.app","https://*.ngrok-free.app","https://secure-mobile.walletconnect.com","https://secure-mobile.walletconnect.org"]};function gt(a){return{formatters:void 0,fees:void 0,serializers:void 0,...a}}let gu=gt({id:"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",name:"Solana",network:"solana-mainnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!1,chainNamespace:"solana",caipNetworkId:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",deprecatedCaipNetworkId:"solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ"}),gv=gt({id:"EtWTRABZaYq6iMfeYKouRu166VU2xqa1",name:"Solana Devnet",network:"solana-devnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",deprecatedCaipNetworkId:"solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"});gt({id:"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",name:"Solana Testnet",network:"solana-testnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"}),gt({id:"000000000019d6689c085ae165831e93",caipNetworkId:"bip122:000000000019d6689c085ae165831e93",chainNamespace:"bip122",name:"Bitcoin",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}}),gt({id:"000000000933ea01ad0ee984209779ba",caipNetworkId:"bip122:000000000933ea01ad0ee984209779ba",chainNamespace:"bip122",name:"Bitcoin Testnet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});let gw={solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},gx={getMethodsByChainNamespace:a=>gw[a]||[],createDefaultNamespace(a){return{methods:this.getMethodsByChainNamespace(a),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(a,b){if(!b)return{...a};let c={...a},d=new Set;if(b.methods&&Object.keys(b.methods).forEach(a=>d.add(a)),b.chains&&Object.keys(b.chains).forEach(a=>d.add(a)),b.events&&Object.keys(b.events).forEach(a=>d.add(a)),b.rpcMap&&Object.keys(b.rpcMap).forEach(a=>{let[b]=a.split(":");b&&d.add(b)}),d.forEach(a=>{c[a]||(c[a]=this.createDefaultNamespace(a))}),b.methods&&Object.entries(b.methods).forEach(([a,b])=>{c[a]&&(c[a].methods=b)}),b.chains&&Object.entries(b.chains).forEach(([a,b])=>{c[a]&&(c[a].chains=b)}),b.events&&Object.entries(b.events).forEach(([a,b])=>{c[a]&&(c[a].events=b)}),b.rpcMap){let a=new Set;Object.entries(b.rpcMap).forEach(([b,d])=>{let[e,f]=b.split(":");e&&f&&c[e]&&(c[e].rpcMap||(c[e].rpcMap={}),a.has(e)||(c[e].rpcMap={},a.add(e)),c[e].rpcMap[f]=d)})}return c},createNamespaces(a,b){let c=a.reduce((a,b)=>{let{id:c,chainNamespace:d,rpcUrls:e}=b,f=e.default.http[0];a[d]||(a[d]=this.createDefaultNamespace(d));let g=`${d}:${c}`,h=a[d];switch(h.chains.push(g),g){case gu.caipNetworkId:h.chains.push(gu.deprecatedCaipNetworkId);break;case gv.caipNetworkId:h.chains.push(gv.deprecatedCaipNetworkId)}return h?.rpcMap&&f&&(h.rpcMap[c]=f),a},{});return this.applyNamespaceOverrides(c,b)},resolveReownName:async a=>{let b=await fV.resolveName(a),c=Object.values(b?.addresses)||[];return c[0]?.address||!1},getChainsFromNamespaces:(a={})=>Object.values(a).flatMap(a=>Array.from(new Set([...a.chains||[],...a.accounts.map(a=>{let[b,c]=a.split(":");return`${b}:${c}`})]))),isSessionEventData:a=>"object"==typeof a&&null!==a&&"id"in a&&"topic"in a&&"params"in a&&"object"==typeof a.params&&null!==a.params&&"chainId"in a.params&&"event"in a.params&&"object"==typeof a.params.event&&null!==a.params.event,isOriginAllowed(a,b,c){for(let d of[...b,...c])if(d.includes("*")){let b=d.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&");if(RegExp(`^${b.replace(/\\\*/gu,".*")}$`,"u").test(a))return!0}else try{if(new URL(d).origin===a)return!0}catch(b){if(d===a)return!0}return!1}};class gy{constructor({provider:a,namespace:b}){this.id=fF.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT,this.name=gh.ConnectorNamesMap[fF.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT],this.type="WALLET_CONNECT",this.imageId=gh.ConnectorImageIds[fF.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT],this.getCaipNetworks=fM.ChainController.getCaipNetworks.bind(fM.ChainController),this.caipNetworks=this.getCaipNetworks(),this.provider=a,this.chain=b}get chains(){return this.getCaipNetworks()}async connectWalletConnect(){if(!await this.authenticate()){let a=this.getCaipNetworks(),b=f.OptionsController.state.universalProviderConfigOverride,c=gx.createNamespaces(a,b);await this.provider.connect({optionalNamespaces:c})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){let a=this.chains.map(a=>a.caipNetworkId);return f2.SIWXUtil.universalProviderAuthenticate({universalProvider:this.provider,chains:a,methods:gz})}}let gz=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"];class gA{constructor(a){this.availableConnectors=[],this.eventListeners=new Map,this.getCaipNetworks=a=>fM.ChainController.getCaipNetworks(a),a&&this.construct(a)}construct(a){this.projectId=a.projectId,this.namespace=a.namespace,this.adapterType=a.adapterType}get connectors(){return this.availableConnectors}get networks(){return this.getCaipNetworks(this.namespace)}setAuthProvider(a){this.addConnector({id:fF.ConstantsUtil.CONNECTOR_ID.AUTH,type:"AUTH",name:fF.ConstantsUtil.CONNECTOR_NAMES.AUTH,provider:a,imageId:gh.ConnectorImageIds[fF.ConstantsUtil.CONNECTOR_ID.AUTH],chain:this.namespace,chains:[]})}addConnector(...a){let b=new Set;this.availableConnectors=[...a,...this.availableConnectors].filter(a=>!b.has(a.id)&&(b.add(a.id),!0)),this.emit("connectors",this.availableConnectors)}setStatus(a,c){b.AccountController.setStatus(a,c)}on(a,b){this.eventListeners.has(a)||this.eventListeners.set(a,new Set),this.eventListeners.get(a)?.add(b)}off(a,b){let c=this.eventListeners.get(a);c&&c.delete(b)}removeAllEventListeners(){this.eventListeners.forEach(a=>{a.clear()})}emit(a,b){let c=this.eventListeners.get(a);c&&c.forEach(a=>a(b))}async connectWalletConnect(a){let b=this.getWalletConnectConnector();return{clientId:(await b.connectWalletConnect()).clientId}}async switchNetwork(a){let{caipNetwork:c,providerType:d}=a;if(!a.provider)return;let e="provider"in a.provider?a.provider.provider:a.provider;if("WALLET_CONNECT"===d)return void e.setDefaultChain(c.caipNetworkId);if(e&&"AUTH"===d){let a=b.AccountController.state.preferredAccountTypes?.[c.chainNamespace];await e.switchNetwork(c.caipNetworkId);let d=await e.getUser({chainId:c.caipNetworkId,preferredAccountType:a});this.emit("switchNetwork",d)}}getWalletConnectConnector(){let a=this.connectors.find(a=>a instanceof gy);if(!a)throw Error("WalletConnectConnector not found");return a}}class gB extends gA{setUniversalProvider(a){this.addConnector(new gy({provider:a,caipNetworks:this.getCaipNetworks(),namespace:this.namespace}))}async connect(a){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(a.chainId),provider:this.provider,address:""})}async disconnect(){try{let a=this.getWalletConnectConnector();await a.disconnect()}catch(a){console.warn("UniversalAdapter:disconnect - error",a)}}async getAccounts({namespace:a}){let b=this.provider;return Promise.resolve({accounts:(b?.session?.namespaces?.[a]?.accounts?.map(a=>{let[,,b]=a.split(":");return b}).filter((a,b,c)=>c.indexOf(a)===b)||[]).map(b=>e.CoreHelperUtil.createAccount(a,b,"bip122"===a?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(a){if(!(a.caipNetwork&&fN.ConstantsUtil.BALANCE_SUPPORTED_CHAINS.includes(a.caipNetwork?.chainNamespace))||a.caipNetwork?.testnet)return{balance:"0.00",symbol:a.caipNetwork?.nativeCurrency.symbol||""};if(b.AccountController.state.balanceLoading&&a.chainId===fM.ChainController.state.activeCaipNetwork?.id)return{balance:b.AccountController.state.balance||"0.00",symbol:b.AccountController.state.balanceSymbol||""};let c=(await b.AccountController.fetchTokenBalance()).find(b=>b.chainId===`${a.caipNetwork?.chainNamespace}:${a.chainId}`&&b.symbol===a.caipNetwork?.nativeCurrency.symbol);return{balance:c?.quantity.numeric||"0.00",symbol:c?.symbol||a.caipNetwork?.nativeCurrency.symbol||""}}async signMessage(a){let{provider:b,message:c,address:d}=a;if(!b)throw Error("UniversalAdapter:signMessage - provider is undefined");return{signature:fM.ChainController.state.activeCaipNetwork?.chainNamespace===fF.ConstantsUtil.CHAIN.SOLANA?(await b.request({method:"solana_signMessage",params:{message:V.default.encode(new TextEncoder().encode(c)),pubkey:d}},fM.ChainController.state.activeCaipNetwork?.caipNetworkId)).signature:await b.request({method:"personal_sign",params:[c,d]},fM.ChainController.state.activeCaipNetwork?.caipNetworkId)}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(a){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}parseUnits(){return 0n}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(a){let{caipNetwork:b}=a,c=this.getWalletConnectConnector();if(b.chainNamespace===fF.ConstantsUtil.CHAIN.EVM)try{await c.provider?.request({method:"wallet_switchEthereumChain",params:[{chainId:(0,gr.toHex)(b.id)}]})}catch(a){if(a.code===gs.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||a.code===gs.ERROR_INVALID_CHAIN_ID||a.code===gs.ERROR_CODE_DEFAULT||a?.data?.originalError?.code===gs.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{await c.provider?.request({method:"wallet_addEthereumChain",params:[{chainId:(0,gr.toHex)(b.id),rpcUrls:[b?.rpcUrls.chainDefault?.http],chainName:b.name,nativeCurrency:b.nativeCurrency,blockExplorerUrls:[b.blockExplorers?.default.url]}]})}catch(a){throw Error("Chain is not supported")}}c.provider.setDefaultChain(b.caipNetworkId)}getWalletConnectProvider(){let a=this.connectors.find(a=>"WALLET_CONNECT"===a.type);return a?.provider}}let gC=["email","socials","swaps","onramp","activity","reownBranding"],gD={email:{apiFeatureName:"social_login",localFeatureName:"email",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>{if(!a?.config)return!1;let b=a.config;return!!a.isEnabled&&b.includes("email")},processFallback:a=>void 0===a?fN.ConstantsUtil.DEFAULT_REMOTE_FEATURES.email:!!a},socials:{apiFeatureName:"social_login",localFeatureName:"socials",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>{if(!a?.config)return!1;let b=a.config;return!!a.isEnabled&&b.length>0&&b.filter(a=>"email"!==a)},processFallback:a=>void 0===a?fN.ConstantsUtil.DEFAULT_REMOTE_FEATURES.socials:"boolean"==typeof a?!!a&&fN.ConstantsUtil.DEFAULT_REMOTE_FEATURES.socials:a},swaps:{apiFeatureName:"swap",localFeatureName:"swaps",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>{if(!a?.config)return!1;let b=a.config;return!!a.isEnabled&&b.length>0&&b},processFallback:a=>void 0===a?fN.ConstantsUtil.DEFAULT_REMOTE_FEATURES.swaps:"boolean"==typeof a?!!a&&fN.ConstantsUtil.DEFAULT_REMOTE_FEATURES.swaps:a},onramp:{apiFeatureName:"onramp",localFeatureName:"onramp",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>{if(!a?.config)return!1;let b=a.config;return!!a.isEnabled&&b.length>0&&b},processFallback:a=>void 0===a?fN.ConstantsUtil.DEFAULT_REMOTE_FEATURES.onramp:"boolean"==typeof a?!!a&&fN.ConstantsUtil.DEFAULT_REMOTE_FEATURES.onramp:a},activity:{apiFeatureName:"activity",localFeatureName:"history",returnType:!1,isLegacy:!0,isAvailableOnBasic:!1,processApi:a=>!!a.isEnabled,processFallback:a=>void 0===a?fN.ConstantsUtil.DEFAULT_REMOTE_FEATURES.activity:!!a},reownBranding:{apiFeatureName:"reown_branding",localFeatureName:"reownBranding",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>!!a.isEnabled,processFallback:a=>void 0===a?fN.ConstantsUtil.DEFAULT_REMOTE_FEATURES.reownBranding:!!a}},gE={localSettingsOverridden:new Set,getApiConfig:(a,b)=>b?.find(b=>b.id===a),addWarning(a,b){if(void 0!==a){let a=gD[b],c=a.isLegacy?`"features.${a.localFeatureName}" (now "${b}")`:`"features.${b}"`;this.localSettingsOverridden.add(c)}},processFeature(a,b,c,d,e){let f=gD[a],g=b[f.localFeatureName];if(e&&!f.isAvailableOnBasic)return!1;if(d){let b=this.getApiConfig(f.apiFeatureName,c);return b?.config===null?this.processFallbackFeature(a,g):!!b?.config&&(void 0!==g&&this.addWarning(g,a),this.processApiFeature(a,b))}return this.processFallbackFeature(a,g)},processApiFeature:(a,b)=>gD[a].processApi(b),processFallbackFeature:(a,b)=>gD[a].processFallback(b),async fetchRemoteFeatures(a){let b=a.basic??!1,c=a.features||{};this.localSettingsOverridden.clear();let d=null,e=!1;try{e=null!=(d=await fJ.ApiController.fetchProjectConfig())}catch(a){console.warn("[Reown Config] Failed to fetch remote project configuration. Using local/default values.",a)}let f=e&&!b?fN.ConstantsUtil.DEFAULT_REMOTE_FEATURES:fN.ConstantsUtil.DEFAULT_REMOTE_FEATURES_DISABLED;try{for(let a of gC){let g=this.processFeature(a,c,d,e,b);Object.assign(f,{[a]:g})}}catch(a){return console.warn("[Reown Config] Failed to process the configuration from Cloud. Using default values.",a),fN.ConstantsUtil.DEFAULT_REMOTE_FEATURES}if(e&&this.localSettingsOverridden.size>0){let a=`Your local configuration for ${Array.from(this.localSettingsOverridden).join(", ")} was ignored because a remote configuration was successfully fetched. Please manage these features via your project dashboard on dashboard.reown.com.`;fI.AlertController.open({shortMessage:"Local configuration ignored",longMessage:`[Reown Config Notice] ${a}`},"warning")}return f}};class gF{constructor(a){this.chainNamespaces=[],this.remoteFeatures={},this.reportedAlertErrors={},this.getCaipNetwork=(a,b)=>{if(a){let c=fM.ChainController.getNetworkData(a)?.requestedCaipNetworks?.find(a=>a.id===b);if(c)return c;let d=fM.ChainController.getNetworkData(a)?.caipNetwork;if(d)return d;let e=fM.ChainController.getRequestedCaipNetworks(a);return e.filter(b=>b.chainNamespace===a)?.[0]}return fM.ChainController.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{let a=this.getCaipNetwork();if(a)return a.id},this.getCaipNetworks=a=>fM.ChainController.getCaipNetworks(a),this.getActiveChainNamespace=()=>fM.ChainController.state.activeChain,this.setRequestedCaipNetworks=(a,b)=>{fM.ChainController.setRequestedCaipNetworks(a,b)},this.getApprovedCaipNetworkIds=()=>fM.ChainController.getAllApprovedCaipNetworkIds(),this.getCaipAddress=a=>fM.ChainController.state.activeChain!==a&&a?fM.ChainController.getAccountProp("caipAddress",a):fM.ChainController.state.activeCaipAddress,this.setClientId=a=>{fL.BlockchainApiController.setClientId(a)},this.getProvider=a=>gq.getProvider(a),this.getProviderType=a=>gq.getProviderId(a),this.getPreferredAccountType=a=>b.AccountController.state.preferredAccountTypes?.[a],this.setCaipAddress=(a,c)=>{b.AccountController.setCaipAddress(a,c),a&&f.OptionsController.state.enableEmbedded&&this.close()},this.setBalance=(a,c,d)=>{b.AccountController.setBalance(a,c,d)},this.setProfileName=(a,c)=>{b.AccountController.setProfileName(a,c)},this.setProfileImage=(a,c)=>{b.AccountController.setProfileImage(a,c)},this.setUser=(a,c)=>{b.AccountController.setUser(a,c)},this.resetAccount=a=>{b.AccountController.resetAccount(a)},this.setCaipNetwork=a=>{fM.ChainController.setActiveCaipNetwork(a)},this.setCaipNetworkOfNamespace=(a,b)=>{fM.ChainController.setChainNetworkData(b,{caipNetwork:a})},this.setAllAccounts=(a,c)=>{b.AccountController.setAllAccounts(a,c),f.OptionsController.setHasMultipleAddresses(a?.length>1)},this.setStatus=(a,c)=>{b.AccountController.setStatus(a,c),d.ConnectorController.isConnected()?fR.StorageUtil.setConnectionStatus("connected"):fR.StorageUtil.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=a=>fM.ChainController.getAccountProp("address",a),this.setConnectors=a=>{let b=[...d.ConnectorController.state.allConnectors,...a];d.ConnectorController.setConnectors(b)},this.setConnections=(a,b)=>{c.ConnectionController.setConnections(a,b)},this.fetchIdentity=a=>fL.BlockchainApiController.fetchIdentity(a),this.getReownName=a=>fV.getNamesForAddress(a),this.getConnectors=()=>d.ConnectorController.getConnectors(),this.getConnectorImage=a=>fK.AssetUtil.getConnectorImage(a),this.setConnectedWalletInfo=(a,c)=>{let d=gq.getProviderId(c),e=a?{...a,type:d}:void 0;b.AccountController.setConnectedWalletInfo(e,c)},this.getIsConnectedState=()=>!!fM.ChainController.state.activeCaipAddress,this.addAddressLabel=(a,c,d)=>{b.AccountController.addAddressLabel(a,c,d)},this.removeAddressLabel=(a,c)=>{b.AccountController.removeAddressLabel(a,c)},this.getAddress=a=>fM.ChainController.state.activeChain!==a&&a?fM.ChainController.getAccountProp("address",a):b.AccountController.state.address,this.setApprovedCaipNetworksData=a=>fM.ChainController.setApprovedCaipNetworksData(a),this.resetNetwork=a=>{fM.ChainController.resetNetwork(a)},this.addConnector=a=>{d.ConnectorController.addConnector(a)},this.resetWcConnection=()=>{c.ConnectionController.resetWcConnection()},this.setAddressExplorerUrl=(a,c)=>{b.AccountController.setAddressExplorerUrl(a,c)},this.setSmartAccountDeployed=(a,c)=>{b.AccountController.setSmartAccountDeployed(a,c)},this.setSmartAccountEnabledNetworks=(a,b)=>{fM.ChainController.setSmartAccountEnabledNetworks(a,b)},this.setPreferredAccountType=(a,c)=>{b.AccountController.setPreferredAccountType(a,c)},this.setEIP6963Enabled=a=>{f.OptionsController.setEIP6963Enabled(a)},this.handleUnsafeRPCRequest=()=>{this.isOpen()?this.isTransactionStackEmpty()||this.redirect("ApproveTransaction"):this.open({view:"ApproveTransaction"})},this.options=a,this.version=a.sdkVersion,this.caipNetworks=this.extendCaipNetworks(a),this.chainNamespaces=this.getChainNamespacesSet(a.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(a),this.chainAdapters=this.createAdapters(a.adapters),this.readyPromise=this.initialize(a)}getChainNamespacesSet(a,b){let c=a?.map(a=>a.namespace).filter(a=>!!a);return c?.length?[...new Set(c)]:[...new Set(b?.map(a=>a.chainNamespace))]}async initialize(a){this.initializeProjectSettings(a),this.initControllers(a),await this.initChainAdapters(),this.sendInitializeEvent(a),await this.syncExistingConnection(),this.remoteFeatures=await gE.fetchRemoteFeatures(a),f.OptionsController.setRemoteFeatures(this.remoteFeatures),this.remoteFeatures.onramp&&f0.setOnrampProviders(this.remoteFeatures.onramp),(f.OptionsController.state.remoteFeatures?.email||Array.isArray(f.OptionsController.state.remoteFeatures?.socials)&&f.OptionsController.state.remoteFeatures?.socials.length>0)&&await this.checkAllowedOrigins()}async checkAllowedOrigins(){let a=await fJ.ApiController.fetchAllowedOrigins();if(a&&e.CoreHelperUtil.isClient()){let b=window.location.origin;gx.isOriginAllowed(b,a,gs.DEFAULT_ALLOWED_ANCESTORS)||fI.AlertController.open(gl.ALERT_ERRORS.INVALID_APP_CONFIGURATION,"error")}else fI.AlertController.open(gl.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error")}sendInitializeEvent(a){let{...b}=a;delete b.adapters,delete b.universalProvider,fW.EventsController.sendEvent({type:"track",event:"INITIALIZE",properties:{...b,networks:a.networks.map(a=>a.id),siweConfig:{options:a.siweConfig?.options||{}}}})}initControllers(a){this.initializeOptionsController(a),this.initializeChainController(a),this.initializeThemeController(a),this.initializeConnectionController(a),this.initializeConnectorController()}initializeThemeController(a){a.themeMode&&f5.ThemeController.setThemeMode(a.themeMode),a.themeVariables&&f5.ThemeController.setThemeVariables(a.themeVariables)}initializeChainController(a){if(!this.connectionControllerClient||!this.networkControllerClient)throw Error("ConnectionControllerClient and NetworkControllerClient must be set");fM.ChainController.initialize(a.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient,networkControllerClient:this.networkControllerClient});let b=this.getDefaultNetwork();b&&fM.ChainController.setActiveCaipNetwork(b)}initializeConnectionController(a){c.ConnectionController.setWcBasic(a.basic??!1)}initializeConnectorController(){d.ConnectorController.initialize(this.chainNamespaces)}initializeProjectSettings(a){f.OptionsController.setProjectId(a.projectId),f.OptionsController.setSdkVersion(a.sdkVersion)}initializeOptionsController(a){f.OptionsController.setDebug(!1!==a.debug),f.OptionsController.setEnableWalletConnect(!1!==a.enableWalletConnect),f.OptionsController.setEnableWalletGuide(!1!==a.enableWalletGuide),f.OptionsController.setEnableWallets(!1!==a.enableWallets),f.OptionsController.setEIP6963Enabled(!1!==a.enableEIP6963),f.OptionsController.setEnableNetworkSwitch(!1!==a.enableNetworkSwitch),f.OptionsController.setEnableAuthLogger(!1!==a.enableAuthLogger),f.OptionsController.setCustomRpcUrls(a.customRpcUrls),f.OptionsController.setEnableEmbedded(a.enableEmbedded),f.OptionsController.setAllWallets(a.allWallets),f.OptionsController.setIncludeWalletIds(a.includeWalletIds),f.OptionsController.setExcludeWalletIds(a.excludeWalletIds),f.OptionsController.setFeaturedWalletIds(a.featuredWalletIds),f.OptionsController.setTokens(a.tokens),f.OptionsController.setTermsConditionsUrl(a.termsConditionsUrl),f.OptionsController.setPrivacyPolicyUrl(a.privacyPolicyUrl),f.OptionsController.setCustomWallets(a.customWallets),f.OptionsController.setFeatures(a.features),f.OptionsController.setAllowUnsupportedChain(a.allowUnsupportedChain),f.OptionsController.setUniversalProviderConfigOverride(a.universalProviderConfigOverride),f.OptionsController.setPreferUniversalLinks(a.experimental_preferUniversalLinks),f.OptionsController.setDefaultAccountTypes(a.defaultAccountTypes);let c=fR.StorageUtil.getPreferredAccountTypes()||{},d={...f.OptionsController.state.defaultAccountTypes,...c};b.AccountController.setPreferredAccountTypes(d);let e=this.getDefaultMetaData();if(!a.metadata&&e&&(a.metadata=e),f.OptionsController.setMetadata(a.metadata),f.OptionsController.setDisableAppend(a.disableAppend),f.OptionsController.setEnableEmbedded(a.enableEmbedded),f.OptionsController.setSIWX(a.siwx),!a.projectId)return void fI.AlertController.open(gl.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");if(a.adapters?.find(a=>a.namespace===fF.ConstantsUtil.CHAIN.EVM)&&a.siweConfig){if(a.siwx)throw Error("Cannot set both `siweConfig` and `siwx` options");f.OptionsController.setSIWX(a.siweConfig.mapToSIWX())}}getDefaultMetaData(){return e.CoreHelperUtil.isClient()?{name:document.getElementsByTagName("title")?.[0]?.textContent||"",description:document.querySelector('meta[property="og:description"]')?.content||"",url:window.location.origin,icons:[document.querySelector('link[rel~="icon"]')?.href||""]}:null}setUnsupportedNetwork(a){let b=this.getActiveChainNamespace();if(b){let c=gk.getUnsupportedNetwork(`${b}:${a}`);fM.ChainController.setActiveCaipNetwork(c)}}getDefaultNetwork(){return gk.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(a,b){return gk.extendCaipNetwork(a,{customNetworkImageUrls:b.chainImages,projectId:b.projectId})}extendCaipNetworks(a){return gk.extendCaipNetworks(a.networks,{customNetworkImageUrls:a.chainImages,customRpcUrls:a.customRpcUrls,projectId:a.projectId})}extendDefaultCaipNetwork(a){let b=a.networks.find(b=>b.id===a.defaultNetwork?.id);return b?gk.extendCaipNetwork(b,{customNetworkImageUrls:a.chainImages,customRpcUrls:a.customRpcUrls,projectId:a.projectId}):void 0}async disconnectNamespace(a){try{let b=this.getAdapter(a),c=gq.getProvider(a),e=gq.getProviderId(a),{caipAddress:f}=fM.ChainController.getAccountData(a)||{};this.setLoading(!0,a),f&&b?.disconnect&&await b.disconnect({provider:c,providerType:e}),fR.StorageUtil.removeConnectedNamespace(a),gq.resetChain(a),this.setUser(void 0,a),this.setStatus("disconnected",a),this.setConnectedWalletInfo(void 0,a),d.ConnectorController.removeConnectorId(a),fM.ChainController.resetAccount(a),fM.ChainController.resetNetwork(a),this.setLoading(!1,a)}catch(b){throw this.setLoading(!1,a),Error(`Failed to disconnect chain ${a}: ${b.message}`)}}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{let a=fM.ChainController.state.activeChain,b=this.getAdapter(a),c=this.getCaipNetwork(a)?.id;if(!b)throw Error("Adapter not found");let e=await b.connectWalletConnect(c);this.close(),this.setClientId(e?.clientId||null),fR.StorageUtil.setConnectedNamespaces([...fM.ChainController.state.chains.keys()]),this.chainNamespaces.forEach(a=>{d.ConnectorController.setConnectorId(gg.ConstantsUtil.CONNECTOR_TYPE_WALLET_CONNECT,a)}),await this.syncWalletConnectAccount()},connectExternal:async({id:a,info:c,type:d,provider:e,chain:f,caipNetwork:g,socialUri:h})=>{let i=fM.ChainController.state.activeChain,j=f||i,k=this.getAdapter(j);if(f&&f!==i&&!g){let a=this.getCaipNetworks().find(a=>a.chainNamespace===f);a&&this.setCaipNetwork(a)}if(!k)throw Error("Adapter not found");let l=this.getCaipNetwork(j),m=await k.connect({id:a,info:c,type:d,provider:e,socialUri:h,chainId:g?.id||l?.id,rpcUrl:g?.rpcUrls?.default?.http?.[0]||l?.rpcUrls?.default?.http?.[0]});if(!m)return;fR.StorageUtil.addConnectedNamespace(j),this.syncProvider({...m,chainNamespace:j});let n=b.AccountController.state.allAccounts,{accounts:o}=n?.length>0?{accounts:[...n]}:await k.getAccounts({namespace:j,id:a});this.setAllAccounts(o,j),this.setStatus("connected",j),this.syncConnectedWalletInfo(j)},reconnectExternal:async({id:a,info:b,type:c,provider:d})=>{let e=fM.ChainController.state.activeChain,f=this.getAdapter(e);f?.reconnect&&(await f?.reconnect({id:a,info:b,type:c,provider:d,chainId:this.getCaipNetwork()?.id}),fR.StorageUtil.addConnectedNamespace(e),this.syncConnectedWalletInfo(e))},disconnect:async a=>{let b=function(a){let b=Array.from(fM.ChainController.state.chains.keys()),c=[];return a?(c.push([a,fM.ChainController.state.chains.get(a)]),f6(a,fF.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT)?b.forEach(b=>{b!==a&&f6(b,fF.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT)&&c.push([b,fM.ChainController.state.chains.get(b)])}):f6(a,fF.ConstantsUtil.CONNECTOR_ID.AUTH)&&b.forEach(b=>{b!==a&&f6(b,fF.ConstantsUtil.CONNECTOR_ID.AUTH)&&c.push([b,fM.ChainController.state.chains.get(b)])})):c=Array.from(fM.ChainController.state.chains.entries()),c}(a);try{let e=await Promise.allSettled(b.map(async([a])=>this.disconnectNamespace(a)));f3.SendController.resetSend(),c.ConnectionController.resetWcConnection(),await f2.SIWXUtil.clearSessions(),d.ConnectorController.setFilterByNamespace(void 0);let f=e.filter(a=>"rejected"===a.status);if(f.length>0)throw Error(f.map(a=>a.reason.message).join(", "));fR.StorageUtil.deleteConnectedSocialProvider(),fW.EventsController.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:a||"all"}})}catch(a){throw Error(`Failed to disconnect chains: ${a.message}`)}},checkInstalled:a=>a?a.some(a=>!!window.ethereum?.[String(a)]):!!window.ethereum,signMessage:async a=>{let c=this.getAdapter(fM.ChainController.state.activeChain),d=await c?.signMessage({message:a,address:b.AccountController.state.address,provider:gq.getProvider(fM.ChainController.state.activeChain)});return d?.signature||""},sendTransaction:async a=>{let b=a.chainNamespace;if(fN.ConstantsUtil.SEND_SUPPORTED_NAMESPACES.includes(b)){let c=this.getAdapter(fM.ChainController.state.activeChain),d=gq.getProvider(b),e=await c?.sendTransaction({...a,caipNetwork:this.getCaipNetwork(),provider:d});return e?.hash||""}return""},estimateGas:async a=>{if(a.chainNamespace===fF.ConstantsUtil.CHAIN.EVM){let b=this.getAdapter(fM.ChainController.state.activeChain),c=gq.getProvider(fM.ChainController.state.activeChain),d=this.getCaipNetwork();if(!d)throw Error("CaipNetwork is undefined");let e=await b?.estimateGas({...a,provider:c,caipNetwork:d});return e?.gas||0n}return 0n},getEnsAvatar:async()=>(await this.syncIdentity({address:b.AccountController.state.address,chainId:Number(this.getCaipNetwork()?.id),chainNamespace:fM.ChainController.state.activeChain}),b.AccountController.state.profileImage||!1),getEnsAddress:async a=>await gx.resolveReownName(a),writeContract:async a=>{let b=this.getAdapter(fM.ChainController.state.activeChain),c=this.getCaipNetwork(),d=this.getCaipAddress(),e=gq.getProvider(fM.ChainController.state.activeChain);if(!c||!d)throw Error("CaipNetwork or CaipAddress is undefined");let f=await b?.writeContract({...a,caipNetwork:c,provider:e,caipAddress:d});return f?.hash},parseUnits:(a,b)=>{let c=this.getAdapter(fM.ChainController.state.activeChain);return c?.parseUnits({value:a,decimals:b})??0n},formatUnits:(a,b)=>{let c=this.getAdapter(fM.ChainController.state.activeChain);return c?.formatUnits({value:a,decimals:b})??"0"},getCapabilities:async a=>{let b=this.getAdapter(fM.ChainController.state.activeChain);return await b?.getCapabilities(a)},grantPermissions:async a=>{let b=this.getAdapter(fM.ChainController.state.activeChain);return await b?.grantPermissions(a)},revokePermissions:async a=>{let b=this.getAdapter(fM.ChainController.state.activeChain);return b?.revokePermissions?await b.revokePermissions(a):"0x"},walletGetAssets:async a=>{let b=this.getAdapter(fM.ChainController.state.activeChain);return await b?.walletGetAssets(a)??{}},updateBalance:a=>{let c=this.getCaipNetwork(a);c&&b.AccountController.state.address&&this.updateNativeBalance(b.AccountController.state.address,c?.id,a)}},this.networkControllerClient={switchCaipNetwork:async a=>await this.switchCaipNetwork(a),getApprovedCaipNetworksData:async()=>this.getApprovedCaipNetworksData()},c.ConnectionController.setClient(this.connectionControllerClient)}getApprovedCaipNetworksData(){if(gq.getProviderId(fM.ChainController.state.activeChain)===gg.ConstantsUtil.CONNECTOR_TYPE_WALLET_CONNECT){let a=this.universalProvider?.session?.namespaces;return{supportsAllNetworks:this.universalProvider?.session?.peer?.metadata.name==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(a)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(a){if(!a)return;let b=a.chainNamespace;if(this.getAddressByChainNamespace(a.chainNamespace)){let c=gq.getProvider(b),d=gq.getProviderId(b);if(a.chainNamespace===fM.ChainController.state.activeChain){let e=this.getAdapter(b);await e?.switchNetwork({caipNetwork:a,provider:c,providerType:d})}else if(this.setCaipNetwork(a),d===gg.ConstantsUtil.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{let c=this.getAddressByChainNamespace(b);c&&this.syncAccount({address:c,chainId:a.id,chainNamespace:b})}}else this.setCaipNetwork(a)}getChainsFromNamespaces(a={}){return Object.values(a).flatMap(a=>Array.from(new Set([...a.chains||[],...a.accounts.map(a=>{let{chainId:b,chainNamespace:c}=fH.parseCaipAddress(a);return`${c}:${b}`})])))}createAdapters(a){return this.createClients(),this.chainNamespaces.reduce((b,c)=>{let d=a?.find(a=>a.namespace===c);return d?(d.construct({namespace:c,projectId:this.options?.projectId,networks:this.getCaipNetworks()}),b[c]=d):b[c]=new gB({namespace:c,networks:this.getCaipNetworks()}),b},{})}async initChainAdapter(a){this.onConnectors(a),this.listenAdapter(a),await this.chainAdapters?.[a].syncConnectors(this.options,this),await this.createUniversalProviderForAdapter(a)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async a=>{await this.initChainAdapter(a)}))}onConnectors(a){let b=this.getAdapter(a);b?.on("connectors",this.setConnectors.bind(this))}listenAdapter(a){let c=this.getAdapter(a);if(!c)return;let d=fR.StorageUtil.getConnectionStatus();"connected"===d?this.setStatus("connecting",a):("disconnected"===d&&fR.StorageUtil.clearAddressCache(),this.setStatus(d,a)),c.on("switchNetwork",({address:b,chainId:c})=>{let d=this.getCaipNetworks().find(a=>a.id===c||a.caipNetworkId===c),e=fM.ChainController.state.activeChain===a,f=fM.ChainController.getAccountProp("address",a);if(d){let c=e&&b?b:f;c&&this.syncAccount({address:c,chainId:d.id,chainNamespace:a})}else this.setUnsupportedNetwork(c)}),c.on("disconnect",this.disconnect.bind(this,a)),c.on("connections",b=>{this.setConnections(b,a)}),c.on("pendingTransactions",()=>{let a=b.AccountController.state.address,c=fM.ChainController.state.activeCaipNetwork;a&&c?.id&&this.updateNativeBalance(a,c.id,c.chainNamespace)}),c.on("accountChanged",({address:b,chainId:c})=>{let d=fM.ChainController.state.activeChain===a;d&&c?this.syncAccount({address:b,chainId:c,chainNamespace:a}):d&&fM.ChainController.state.activeCaipNetwork?.id?this.syncAccount({address:b,chainId:fM.ChainController.state.activeCaipNetwork?.id,chainNamespace:a}):this.syncAccountInfo(b,c,a),this.syncAllAccounts(a)})}async createUniversalProviderForAdapter(a){await this.getUniversalProvider(),this.universalProvider&&this.chainAdapters?.[a]?.setUniversalProvider?.(this.universalProvider)}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(a=>this.syncNamespaceConnection(a)))}async syncNamespaceConnection(a){try{a===fF.ConstantsUtil.CHAIN.EVM&&e.CoreHelperUtil.isSafeApp()&&d.ConnectorController.setConnectorId(fF.ConstantsUtil.CONNECTOR_ID.SAFE,a);let b=d.ConnectorController.getConnectorId(a);switch(this.setStatus("connecting",a),b){case fF.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT:await this.syncWalletConnectAccount();break;case fF.ConstantsUtil.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(a)}}catch(b){console.warn("AppKit couldn't sync existing connection",b),this.setStatus("disconnected",a)}}async syncAdapterConnection(a){let b=this.getAdapter(a),c=d.ConnectorController.getConnectorId(a),f=this.getCaipNetwork(a),g=d.ConnectorController.getConnectors(a).find(a=>a.id===c);try{if(!b||!g)throw Error(`Adapter or connector not found for namespace ${a}`);if(!f?.id)throw Error("CaipNetwork not found");let c=await b?.syncConnection({namespace:a,id:g.id,chainId:f.id,rpcUrl:f?.rpcUrls?.default?.http?.[0]});if(c){let d=await b?.getAccounts({namespace:a,id:g.id});d&&d.accounts.length>0?this.setAllAccounts(d.accounts,a):this.setAllAccounts([e.CoreHelperUtil.createAccount(a,c.address,"eoa")],a),this.syncProvider({...c,chainNamespace:a}),await this.syncAccount({...c,chainNamespace:a}),this.setStatus("connected",a)}else this.setStatus("disconnected",a)}catch(b){this.setStatus("disconnected",a)}}async syncWalletConnectAccount(){let a=this.chainNamespaces.map(async a=>{let b=this.getAdapter(a),c=this.universalProvider?.session?.namespaces?.[a]?.accounts||[],e=fM.ChainController.state.activeCaipNetwork?.id,f=c.find(a=>{let{chainId:b}=fH.parseCaipAddress(a);return b===e?.toString()})||c[0];if(f){let c=fH.validateCaipAddress(f),{chainId:e,address:g}=fH.parseCaipAddress(c);if(gq.setProviderId(a,gg.ConstantsUtil.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&fM.ChainController.state.activeCaipNetwork&&b?.namespace!==fF.ConstantsUtil.CHAIN.EVM){let c=b?.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:fM.ChainController.state.activeCaipNetwork});gq.setProvider(a,c)}else gq.setProvider(a,this.universalProvider);d.ConnectorController.setConnectorId(fF.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT,a),fR.StorageUtil.addConnectedNamespace(a),this.syncWalletConnectAccounts(a),await this.syncAccount({address:g,chainId:e,chainNamespace:a})}else this.setStatus("disconnected",a);this.syncConnectedWalletInfo(a),await fM.ChainController.setApprovedCaipNetworksData(a)});await Promise.all(a)}syncWalletConnectAccounts(a){let b=this.universalProvider?.session?.namespaces?.[a]?.accounts?.map(a=>{let{address:b}=fH.parseCaipAddress(a);return b}).filter((a,b,c)=>c.indexOf(a)===b);b&&this.setAllAccounts(b.map(b=>e.CoreHelperUtil.createAccount(a,b,"bip122"===a?"payment":"eoa")),a)}syncProvider({type:a,provider:b,id:c,chainNamespace:e}){gq.setProviderId(e,a),gq.setProvider(e,b),d.ConnectorController.setConnectorId(c,e)}async syncAllAccounts(a){let b=d.ConnectorController.getConnectorId(a);if(!b)return;let c=this.getAdapter(a),e=await c?.getAccounts({namespace:a,id:b});e&&e.accounts.length>0&&this.setAllAccounts(e.accounts,a)}async syncAccount(a){let c=a.chainNamespace===fM.ChainController.state.activeChain,d=fM.ChainController.getCaipNetworkByNamespace(a.chainNamespace,a.chainId),{address:e,chainId:g,chainNamespace:h}=a,{chainId:i}=fR.StorageUtil.getActiveNetworkProps(),j=g||i,k=fM.ChainController.state.activeCaipNetwork?.name===fF.ConstantsUtil.UNSUPPORTED_NETWORK_NAME,l=fM.ChainController.getNetworkProp("supportsAllNetworks",h);if(this.setStatus("connected",h),(!k||l)&&j){let a=this.getCaipNetworks().find(a=>a.id.toString()===j.toString()),g=this.getCaipNetworks().find(a=>a.chainNamespace===h);if(!l&&!a&&!g){let b=this.getApprovedCaipNetworkIds()||[],c=b.find(a=>fH.parseCaipNetworkId(a)?.chainId===j.toString()),d=b.find(a=>fH.parseCaipNetworkId(a)?.chainNamespace===h);a=this.getCaipNetworks().find(a=>a.caipNetworkId===c),g=this.getCaipNetworks().find(a=>a.caipNetworkId===d||"deprecatedCaipNetworkId"in a&&a.deprecatedCaipNetworkId===d)}let i=a||g;i?.chainNamespace===fM.ChainController.state.activeChain?f.OptionsController.state.enableNetworkSwitch&&!f.OptionsController.state.allowUnsupportedChain&&fM.ChainController.state.activeCaipNetwork?.name===fF.ConstantsUtil.UNSUPPORTED_NETWORK_NAME?fM.ChainController.showUnsupportedChainUI():this.setCaipNetwork(i):!c&&d&&this.setCaipNetworkOfNamespace(d,h),this.syncConnectedWalletInfo(h),gm.HelpersUtil.isLowerCaseMatch(e,b.AccountController.state.address)||this.syncAccountInfo(e,i?.id,h),c?await this.syncBalance({address:e,chainId:i?.id,chainNamespace:h}):await this.syncBalance({address:e,chainId:d?.id,chainNamespace:h})}}async syncAccountInfo(a,b,c){let d=this.getCaipAddress(c),e=b||d?.split(":")[1];if(!e)return;let f=`${c}:${e}:${a}`;this.setCaipAddress(f,c),await this.syncIdentity({address:a,chainId:e,chainNamespace:c})}async syncReownName(a,b){try{let c=await this.getReownName(a);if(c[0]){let a=c[0];this.setProfileName(a.name,b)}else this.setProfileName(null,b)}catch{this.setProfileName(null,b)}}syncConnectedWalletInfo(a){let b=d.ConnectorController.getConnectorId(a),c=gq.getProviderId(a);if(c===gg.ConstantsUtil.CONNECTOR_TYPE_ANNOUNCED||c===gg.ConstantsUtil.CONNECTOR_TYPE_INJECTED){if(b){let c=this.getConnectors().find(a=>a.id===b);if(c){let{info:b,name:d,imageUrl:e}=c,f=e||this.getConnectorImage(c);this.setConnectedWalletInfo({name:d,icon:f,...b},a)}}}else if(c===gg.ConstantsUtil.CONNECTOR_TYPE_WALLET_CONNECT){let b=gq.getProvider(a);b?.session&&this.setConnectedWalletInfo({...b.session.peer.metadata,name:b.session.peer.metadata.name,icon:b.session.peer.metadata.icons?.[0]},a)}else if(b&&b===fF.ConstantsUtil.CONNECTOR_ID.COINBASE){let b=this.getConnectors().find(a=>a.id===fF.ConstantsUtil.CONNECTOR_ID.COINBASE);this.setConnectedWalletInfo({name:"Coinbase Wallet",icon:this.getConnectorImage(b)},a)}}async syncBalance(a){fG.NetworkUtil.getNetworksByNamespace(this.getCaipNetworks(),a.chainNamespace).find(b=>b.id.toString()===a.chainId?.toString())&&a.chainId&&await this.updateNativeBalance(a.address,a.chainId,a.chainNamespace)}async ready(){await this.readyPromise}async updateNativeBalance(a,b,c){let d=this.getAdapter(c),e=fM.ChainController.getCaipNetworkByNamespace(c,b);if(d){let f=await d.getBalance({address:a,chainId:b,caipNetwork:e,tokens:this.options.tokens});return this.setBalance(f.balance,f.symbol,c),f}}async initializeUniversalAdapter(){let a=gn.createLogger((a,...b)=>{a&&this.handleAlertError(a),console.error(...b)}),b={projectId:this.options?.projectId,metadata:{name:this.options?.metadata?this.options?.metadata.name:"",description:this.options?.metadata?this.options?.metadata.description:"",url:this.options?.metadata?this.options?.metadata.url:"",icons:this.options?.metadata?this.options?.metadata.icons:[""]},logger:a};f.OptionsController.setManualWCControl(!!this.options?.manualWCControl),this.universalProvider=this.options.universalProvider??await fE.init(b),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&(this.universalProvider.on("display_uri",a=>{c.ConnectionController.setUri(a)}),this.universalProvider.on("connect",c.ConnectionController.finalizeWcConnection),this.universalProvider.on("disconnect",()=>{this.chainNamespaces.forEach(a=>{this.resetAccount(a)}),c.ConnectionController.resetWcConnection()}),this.universalProvider.on("chainChanged",a=>{let b=this.getCaipNetworks().find(b=>b.id==a),c=this.getCaipNetwork();if(!b)return void this.setUnsupportedNetwork(a);c?.id!==b?.id&&this.setCaipNetwork(b)}),this.universalProvider.on("session_event",a=>{if(gx.isSessionEventData(a)){let{name:b,data:c}=a.params.event;"accountsChanged"===b&&Array.isArray(c)&&e.CoreHelperUtil.isCaipAddress(c[0])&&this.syncAccount(fH.parseCaipAddress(c[0]))}}))}createUniversalProvider(){return!this.universalProviderInitPromise&&e.CoreHelperUtil.isClient()&&this.options?.projectId&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(a){fW.EventsController.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:a instanceof Error?a.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",a)}return this.universalProvider}handleAlertError(a){let[b,c]=Object.entries(gl.UniversalProviderErrors).find(([,{message:b}])=>a.message.includes(b))??[],{message:d,alertErrorKey:e}=c??{};if(b&&d&&!this.reportedAlertErrors[b]){let a=gl.ALERT_ERRORS[e];a&&(fI.AlertController.open(a,"error"),this.reportedAlertErrors[b]=!0)}}getAdapter(a){if(a)return this.chainAdapters?.[a]}createAdapter(a){if(!a)return;let b=a.namespace;b&&(this.createClients(),a.namespace=b,a.construct({namespace:b,projectId:this.options?.projectId,networks:this.getCaipNetworks()}),this.chainNamespaces.includes(b)||this.chainNamespaces.push(b),this.chainAdapters&&(this.chainAdapters[b]=a))}async open(a){return(await this.injectModalUi(),a?.uri&&c.ConnectionController.setUri(a.uri),a?.arguments&&a?.view==="Swap")?fX.ModalController.open({...a,data:{swap:a.arguments}}):fX.ModalController.open(a)}async close(){await this.injectModalUi(),fX.ModalController.close()}setLoading(a,b){fX.ModalController.setLoading(a,b)}async disconnect(a){await c.ConnectionController.disconnect(a)}getSIWX(){return f.OptionsController.state.siwx}getError(){return""}getChainId(){return fM.ChainController.state.activeCaipNetwork?.id}async switchNetwork(a){let b=this.getCaipNetworks().find(b=>b.id===a.id);if(!b)return void fI.AlertController.open(gl.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error");await fM.ChainController.switchActiveNetwork(b)}getWalletProvider(){return fM.ChainController.state.activeChain?gq.state.providers[fM.ChainController.state.activeChain]:null}getWalletProviderType(){return gq.getProviderId(fM.ChainController.state.activeChain)}subscribeProviders(a){return gq.subscribeProviders(a)}getThemeMode(){return f5.ThemeController.state.themeMode}getThemeVariables(){return f5.ThemeController.state.themeVariables}setThemeMode(a){f5.ThemeController.setThemeMode(a),(0,f8.setColorTheme)(f5.ThemeController.state.themeMode)}setTermsConditionsUrl(a){f.OptionsController.setTermsConditionsUrl(a)}setPrivacyPolicyUrl(a){f.OptionsController.setPrivacyPolicyUrl(a)}setThemeVariables(a){f5.ThemeController.setThemeVariables(a),(0,f8.setThemeVariables)(f5.ThemeController.state.themeVariables)}subscribeTheme(a){return f5.ThemeController.subscribe(a)}getWalletInfo(){return b.AccountController.state.connectedWalletInfo}getAccount(a){let b=d.ConnectorController.getAuthConnector(a),c=fM.ChainController.getAccountData(a),f=fM.ChainController.state.activeChain,g=fR.StorageUtil.getConnectedConnectorId(a||f);if(c)return{allAccounts:c.allAccounts,caipAddress:c.caipAddress,address:e.CoreHelperUtil.getPlainAddress(c.caipAddress),isConnected:!!c.caipAddress,status:c.status,embeddedWalletInfo:b&&g===fF.ConstantsUtil.CONNECTOR_ID.AUTH?{user:c.user?{...c.user,username:fR.StorageUtil.getConnectedSocialUsername()}:void 0,authProvider:c.socialProvider||"email",accountType:c.preferredAccountTypes?.[a||f],isSmartAccountDeployed:!!c.smartAccountDeployed}:void 0}}subscribeAccount(a,b){let c=()=>{let c=this.getAccount(b);c&&a(c)};b?fM.ChainController.subscribeChainProp("accountState",c,b):fM.ChainController.subscribe(c),d.ConnectorController.subscribe(c)}subscribeNetwork(a){return fM.ChainController.subscribe(({activeCaipNetwork:b})=>{a({caipNetwork:b,chainId:b?.id,caipNetworkId:b?.caipNetworkId})})}subscribeWalletInfo(a){return b.AccountController.subscribeKey("connectedWalletInfo",a)}subscribeShouldUpdateToAddress(a){b.AccountController.subscribeKey("shouldUpdateToAddress",a)}subscribeCaipNetworkChange(a){fM.ChainController.subscribeKey("activeCaipNetwork",a)}getState(){return f1.PublicStateController.state}subscribeState(a){return f1.PublicStateController.subscribe(a)}showErrorMessage(a){f4.SnackController.showError(a)}showSuccessMessage(a){f4.SnackController.showSuccess(a)}getEvent(){return{...fW.EventsController.state}}subscribeEvents(a){return fW.EventsController.subscribe(a)}replace(a){fT.RouterController.replace(a)}redirect(a){fT.RouterController.push(a)}popTransactionStack(a){fT.RouterController.popTransactionStack(a)}isOpen(){return fX.ModalController.state.open}isTransactionStackEmpty(){return 0===fT.RouterController.state.transactionStack.length}static getInstance(){return this.instance}updateFeatures(a){f.OptionsController.setFeatures(a)}updateRemoteFeatures(a){f.OptionsController.setRemoteFeatures(a)}updateOptions(a){let b={...f.OptionsController.state||{},...a};f.OptionsController.setOptions(b)}setConnectMethodsOrder(a){f.OptionsController.setConnectMethodsOrder(a)}setWalletFeaturesOrder(a){f.OptionsController.setWalletFeaturesOrder(a)}setCollapseWallets(a){f.OptionsController.setCollapseWallets(a)}setSocialsOrder(a){f.OptionsController.setSocialsOrder(a)}getConnectMethodsOrder(){return f7.WalletUtil.getConnectOrderMethod(f.OptionsController.state.features,d.ConnectorController.getConnectors())}addNetwork(a,b){if(this.chainAdapters&&!this.chainAdapters[a])throw Error(`Adapter for namespace ${a} doesn't exist`);let c=this.extendCaipNetwork(b,this.options);this.getCaipNetworks().find(a=>a.id===c.id)||fM.ChainController.addNetwork(c)}removeNetwork(a,b){if(this.chainAdapters&&!this.chainAdapters[a])throw Error(`Adapter for namespace ${a} doesn't exist`);this.getCaipNetworks().find(a=>a.id===b)&&fM.ChainController.removeNetwork(a,b)}}let gG=!1;class gH extends gF{async open(a){d.ConnectorController.isConnected()||await super.open(a)}async close(){await super.close(),this.options.manualWCControl&&c.ConnectionController.finalizeWcConnection()}async syncIdentity(a){return Promise.resolve()}async syncBalance(a){return Promise.resolve()}async injectModalUi(){if(!gG&&e.CoreHelperUtil.isClient()){if(await a.A(110288),await a.A(602696),!document.querySelector("w3m-modal")){let a=document.createElement("w3m-modal");f.OptionsController.state.disableAppend||f.OptionsController.state.enableEmbedded||document.body.insertAdjacentElement("beforeend",a)}gG=!0}}}function gI(a){return new gH({...a,basic:!0,sdkVersion:"html-core-1.7.8"})}a.i(255431)}];

//# sourceMappingURL=c35cb_%40reown_appkit_dist_esm_exports_core_eeafc7f7.js.map