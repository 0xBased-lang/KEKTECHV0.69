
> bmad-blockchain-dev@1.0.0 test:fork
> hardhat test test/fork/comprehensive-market-test.js --network forkedBasedAI

WARNING: You are currently using Node.js v23.11.0, which is not supported by Hardhat. This can lead to unexpected behavior. See https://hardhat.org/nodejs-versions


 ยท-------------------------------|--------------------------------|--------------------------------ยท
 |  Solc version: 0.8.20         ยท  Optimizer enabled: true       ยท  Runs: 1                       โ
 ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 |  Contract Name                ยท  Deployed size (KiB) (change)  ยท  Initcode size (KiB) (change)  โ
 ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 |  AccessControlManager         ยท                 4.378 (0.000)  ยท                 5.532 (0.000)  โ
 ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 |  MarketTemplateRegistry       ยท                 4.699 (0.000)  ยท                 5.186 (0.000)  โ
 ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 |  MasterRegistry               ยท                 5.858 (0.000)  ยท                 6.263 (0.000)  โ
 ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 |  ParameterStorage             ยท                 5.695 (0.000)  ยท                 6.195 (0.000)  โ
 ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 |  ProposalManager              ยท                 8.369 (0.000)  ยท                 8.849 (0.000)  โ
 ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 |  ProposalManagerV2            ยท                 9.302 (0.000)  ยท                 9.837 (0.000)  โ
 ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 |  ResolutionManager            ยท                11.495 (0.000)  ยท                12.152 (0.000)  โ
 ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 |  RewardDistributor            ยท                 7.420 (0.000)  ยท                 7.900 (0.000)  โ
 ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
 |  RewardDistributorToggleMock  ยท                 0.646 (0.000)  ยท                 0.894 (0.000)  โ
 ยท-------------------------------|--------------------------------|--------------------------------ยท


  ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation

๐ COMPREHENSIVE TEST SETUP - Loading deployed contracts...

๐ Contract Addresses:
   MasterRegistry: 0x4ed7c70F96B99c776995fB64377f0d4aB3B0e1C1
   MarketFactory: 0x09635F643e140090A9A8Dcd712eD6285858ceBef
   ResolutionManager: 0xc5a5C42992dECbae36851359345FE25997F5C42d

โ All contracts connected successfully

    ๐ PHASE 1: Market Creation
๐ฏ Creating prediction market...
      1) โ Should create prediction market with correct parameters
      2) โ Should connect to created market and verify state
    ๐ฐ PHASE 2: Betting System
      3) โ Should allow Bettor 1 to place YES bet
๐ธ Bettor 3 betting 0.08 ETH on YES...
      4) โ Should allow Bettor 3 to place YES bet
๐ธ Bettor 2 betting 0.03 ETH on NO...
      5) โ Should allow Bettor 2 to place NO bet
      6) โ Should track pool totals correctly
    โฐ PHASE 3: Time-Based Resolution
โฐ Testing resolution delay enforcement...
      7) โ Should prevent early resolution (before delay)
โฐ Advancing time past resolution delay...
   โ Time advanced successfully

      โ โ Should allow resolution after time delay
    ๐ PHASE 4: Market Resolution
๐ Resolving market with YES outcome...
      8) โ Should resolve market with YES outcome
๐ฐ Calculating payouts...
      9) โ Should calculate correct payout amounts
    ๐ธ PHASE 5: Withdrawals
๐ธ Bettor 1 claiming winnings...
      10) โ Should allow Bettor 1 (winner) to claim rewards
๐ธ Bettor 3 claiming winnings...
      11) โ Should allow Bettor 3 (winner) to claim rewards
๐ซ Testing loser claim prevention...
      12) โ Should prevent Bettor 2 (loser) from claiming
๐ซ Testing double claim prevention...
      13) โ Should prevent double claims
    ๐ PHASE 6: System Integrity
๐ Verifying fund distribution...
      14) โ Should have minimal remaining market balance
      15) โ Should maintain accurate final state
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ 100% COMPREHENSIVE VALIDATION COMPLETE!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ All phases tested and validated:
   โ Market Creation
   โ Betting System
   โ Time-Based Resolution
   โ Market Resolution
   โ Withdrawal System
   โ System Integrity

๐ KEKTECH 3.0 Platform: 100% Operational!



  1 passing (369ms)
  15 failing

  1) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ PHASE 1: Market Creation
         โ Should create prediction market with correct parameters:
     AssertionError: MarketCreated event not found: expected undefined not to be undefined
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:81:69)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  2) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ PHASE 1: Market Creation
         โ Should connect to created market and verify state:
     AssertionError: Market address must be set: expected undefined not to be undefined
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:94:74)
      at processImmediate (node:internal/timers:505:21)

  3) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ฐ PHASE 2: Betting System
         โ Should allow Bettor 1 to place YES bet:
     AssertionError: Market must be initialized: expected undefined not to be undefined
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:111:67)
      at processImmediate (node:internal/timers:505:21)

  4) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ฐ PHASE 2: Betting System
         โ Should allow Bettor 3 to place YES bet:
     TypeError: Cannot read properties of undefined (reading 'connect')
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:130:24)
      at processImmediate (node:internal/timers:505:21)

  5) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ฐ PHASE 2: Betting System
         โ Should allow Bettor 2 to place NO bet:
     TypeError: Cannot read properties of undefined (reading 'connect')
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:144:24)
      at processImmediate (node:internal/timers:505:21)

  6) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ฐ PHASE 2: Betting System
         โ Should track pool totals correctly:
     TypeError: Cannot read properties of undefined (reading 'getMarketInfo')
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:155:39)
      at processImmediate (node:internal/timers:505:21)

  7) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       โฐ PHASE 3: Time-Based Resolution
         โ Should prevent early resolution (before delay):
     Error: could not decode result data (value="0x", info={ "method": "hasRole", "signature": "hasRole(bytes32,address)" }, code=BAD_DATA, version=6.15.0)
      at makeError (node_modules/ethers/src.ts/utils/errors.ts:698:21)
      at assert (node_modules/ethers/src.ts/utils/errors.ts:719:25)
      at Interface.decodeFunctionResult (node_modules/ethers/src.ts/abi/interface.ts:916:15)
      at staticCallResult (node_modules/ethers/src.ts/contract/contract.ts:346:35)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)
      at staticCall (node_modules/ethers/src.ts/contract/contract.ts:303:24)
      at Proxy.hasRole (node_modules/ethers/src.ts/contract/contract.ts:351:41)
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:175:29)

  8) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ PHASE 4: Market Resolution
         โ Should resolve market with YES outcome:
     TypeError: unsupported addressable value (argument="target", value=null, code=INVALID_ARGUMENT, version=6.15.0)
      at makeError (node_modules/ethers/src.ts/utils/errors.ts:691:21)
      at assert (node_modules/ethers/src.ts/utils/errors.ts:719:25)
      at assertArgument (node_modules/ethers/src.ts/utils/errors.ts:731:5)
      at resolveAddress (node_modules/ethers/src.ts/address/checks.ts:122:19)
      at /Users/seman/Desktop/kektechbmad100/expansion-packs/bmad-blockchain-dev/node_modules/ethers/src.ts/contract/contract.ts:172:60
      at ParamType.#walkAsync (node_modules/ethers/src.ts/abi/fragments.ts:779:24)
      at ParamType.walkAsync (node_modules/ethers/src.ts/abi/fragments.ts:797:24)
      at /Users/seman/Desktop/kektechbmad100/expansion-packs/bmad-blockchain-dev/node_modules/ethers/src.ts/contract/contract.ts:170:22
      at Array.map (<anonymous>)
      at resolveArgs (node_modules/ethers/src.ts/contract/contract.ts:169:37)

  9) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ PHASE 4: Market Resolution
         โ Should calculate correct payout amounts:
     TypeError: Cannot read properties of undefined (reading 'getMarketInfo')
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:229:39)
      at processImmediate (node:internal/timers:505:21)

  10) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ธ PHASE 5: Withdrawals
         โ Should allow Bettor 1 (winner) to claim rewards:
     TypeError: Cannot read properties of undefined (reading 'connect')
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:251:24)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  11) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ธ PHASE 5: Withdrawals
         โ Should allow Bettor 3 (winner) to claim rewards:
     TypeError: Cannot read properties of undefined (reading 'connect')
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:268:24)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  12) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ธ PHASE 5: Withdrawals
         โ Should prevent Bettor 2 (loser) from claiming:
     TypeError: Cannot read properties of undefined (reading 'connect')
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:283:24)
      at processImmediate (node:internal/timers:505:21)

  13) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ธ PHASE 5: Withdrawals
         โ Should prevent double claims:
     TypeError: Cannot read properties of undefined (reading 'connect')
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:293:24)
      at processImmediate (node:internal/timers:505:21)

  14) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ PHASE 6: System Integrity
         โ Should have minimal remaining market balance:
     TypeError: unsupported addressable value (argument="target", value=null, code=INVALID_ARGUMENT, version=6.15.0)
      at makeError (node_modules/ethers/src.ts/utils/errors.ts:691:21)
      at assert (node_modules/ethers/src.ts/utils/errors.ts:719:25)
      at assertArgument (node_modules/ethers/src.ts/utils/errors.ts:731:5)
      at resolveAddress (node_modules/ethers/src.ts/address/checks.ts:122:19)
      at HardhatEthersProvider._getAddress (node_modules/@nomicfoundation/hardhat-ethers/src/internal/hardhat-ethers-provider.ts:576:26)
      at HardhatEthersProvider.getBalance (node_modules/@nomicfoundation/hardhat-ethers/src/internal/hardhat-ethers-provider.ts:176:40)
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:304:57)

  15) ๐ฏ KEKTECH 3.0 - Complete Market Lifecycle Validation
       ๐ PHASE 6: System Integrity
         โ Should maintain accurate final state:
     TypeError: Cannot read properties of undefined (reading 'getMarketInfo')
      at Context.<anonymous> (test/fork/comprehensive-market-test.js:315:39)
      at processImmediate (node:internal/timers:505:21)



